<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BaseUIComponent å‹•ä½œç¢ºèªãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-button {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #005a9e;
        }
        .results {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 4px;
            margin-top: 15px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
        }
        .success { color: #27ae60; }
        .error { color: #e74c3c; }
        .info { color: #3498db; }
    </style>
</head>
<body>
    <h1>ğŸ—ï¸ BaseUIComponent å‹•ä½œç¢ºèªãƒ†ã‚¹ãƒˆ</h1>
    
    <div class="test-container">
        <h2>ğŸ“Š åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h2>
        <button class="test-button" id="test-creation">ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä½œæˆ</button>
        <button class="test-button" id="test-mount">ãƒã‚¦ãƒ³ãƒˆ</button>
        <button class="test-button" id="test-show">è¡¨ç¤º</button>
        <button class="test-button" id="test-hide">éè¡¨ç¤º</button>
        <button class="test-button" id="test-expand">å±•é–‹</button>
        <button class="test-button" id="test-collapse">ç¸®å°</button>
        <button class="test-button" id="test-destroy">ç ´æ£„</button>
    </div>
    
    <div class="test-container">
        <h2>ğŸ¯ Intenté€šä¿¡ãƒ†ã‚¹ãƒˆ</h2>
        <button class="test-button" id="test-intent-send">Intenté€ä¿¡</button>
        <button class="test-button" id="test-intent-receive">Intentå—ä¿¡ãƒ†ã‚¹ãƒˆ</button>
        <button class="test-button" id="test-state-sync">çŠ¶æ…‹åŒæœŸ</button>
    </div>
    
    <div class="test-container">
        <h2>ğŸ–±ï¸ UIæ“ä½œãƒ†ã‚¹ãƒˆ</h2>
        <button class="test-button" id="test-drag">ãƒ‰ãƒ©ãƒƒã‚°æœ‰åŠ¹åŒ–</button>
        <button class="test-button" id="test-resize">ãƒªã‚µã‚¤ã‚ºæœ‰åŠ¹åŒ–</button>
        <button class="test-button" id="test-focus">ãƒ•ã‚©ãƒ¼ã‚«ã‚¹</button>
        <button class="test-button" id="test-move">ä½ç½®å¤‰æ›´</button>
    </div>
    
    <div class="test-container">
        <h2>ğŸ“‹ ãƒ†ã‚¹ãƒˆçµæœ</h2>
        <div id="test-results" class="results">
            <div class="info">ğŸ“ ãƒ†ã‚¹ãƒˆé–‹å§‹æº–å‚™å®Œäº†ã€‚ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚</div>
        </div>
    </div>

    <script type="module">
        import { BaseUIComponent } from './js/ui-components/BaseUIComponent.js'
        
        // ==========================================
        // ãƒ†ã‚¹ãƒˆç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        // ==========================================
        
        let testComponent = null
        const results = document.getElementById('test-results')
        
        function logResult(message, type = 'info', data = null) {
            const timestamp = new Date().toLocaleTimeString()
            const resultDiv = document.createElement('div')
            resultDiv.className = type
            resultDiv.innerHTML = `[${timestamp}] ${message}`
            
            if (data) {
                const dataDiv = document.createElement('div')
                dataDiv.style.marginLeft = '20px'
                dataDiv.style.color = '#666'
                dataDiv.innerHTML = JSON.stringify(data, null, 2)
                resultDiv.appendChild(dataDiv)
            }
            
            results.appendChild(resultDiv)
            results.scrollTop = results.scrollHeight
        }
        
        // ãƒ¢ãƒƒã‚¯PluginNodeä½œæˆ
        const mockPluginNode = {
            id: 'test-plugin-node',
            intentHandler: {
                sendIntent: (type, data) => {
                    logResult(`ğŸ“¤ Intenté€ä¿¡: ${type}`, 'info', data)
                },
                addIntentListener: (type, handler) => {
                    logResult(`ğŸ‘‚ Intent listenerè¿½åŠ : ${type}`, 'info')
                    return `listener-${Date.now()}`
                },
                removeIntentListener: (listenerId) => {
                    logResult(`ğŸ—‘ï¸ Intent listenerå‰Šé™¤: ${listenerId}`, 'info')
                }
            }
        }
        
        // ==========================================
        // ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å®Ÿè£…
        // ==========================================
        
        // åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
        document.getElementById('test-creation').onclick = () => {
            try {
                testComponent = new BaseUIComponent(mockPluginNode, {
                    type: 'test-component',
                    initialState: { testValue: 'hello' },
                    position: { x: 200, y: 150 },
                    size: { width: 400, height: 300 }
                })
                
                logResult('âœ… BaseUIComponentä½œæˆæˆåŠŸ', 'success', {
                    id: testComponent.id,
                    type: testComponent.type,
                    state: testComponent.state
                })
            } catch (error) {
                logResult('âŒ BaseUIComponentä½œæˆå¤±æ•—', 'error', { error: error.message })
            }
        }
        
        document.getElementById('test-mount').onclick = () => {
            if (!testComponent) {
                logResult('âš ï¸ å…ˆã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã—ã¦ãã ã•ã„', 'error')
                return
            }
            
            try {
                // åŸºæœ¬çš„ãªãƒ†ã‚¹ãƒˆç”¨DOMæ§‹é€ ä½œæˆ
                testComponent.render = function() {
                    const element = this.createBaseElement()
                    element.innerHTML = `
                        <div style="padding: 15px; height: 100%;">
                            <h3 style="margin: 0 0 10px 0; color: #333;">ğŸ§ª ãƒ†ã‚¹ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ</h3>
                            <p style="color: #666; margin: 10px 0;">
                                ID: ${this.id}<br>
                                Type: ${this.type}<br>
                                State: ${JSON.stringify(this.state)}
                            </p>
                            <div style="position: absolute; bottom: 10px; left: 15px; right: 15px;">
                                <button onclick="this.closest('.charm-ui-component').testComponent.log('ãƒ†ã‚¹ãƒˆãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯')" 
                                        style="background: #27ae60; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer;">
                                    ğŸ“ ãƒ­ã‚°ãƒ†ã‚¹ãƒˆ
                                </button>
                            </div>
                        </div>
                    `
                    
                    // ãƒ†ã‚¹ãƒˆç”¨å‚ç…§è¿½åŠ 
                    element.testComponent = this
                    
                    // ãƒ‰ãƒ©ãƒƒã‚°æ©Ÿèƒ½è¨­å®š
                    this.setupDragging(element.querySelector('h3'))
                    
                    // ãƒªã‚µã‚¤ã‚ºæ©Ÿèƒ½è¨­å®š
                    this.setupResizing()
                    
                    return element
                }
                
                const mountedElement = testComponent.mount()
                logResult('âœ… ãƒã‚¦ãƒ³ãƒˆæˆåŠŸ', 'success', {
                    elementId: mountedElement.id,
                    isMounted: testComponent.state.isMounted
                })
            } catch (error) {
                logResult('âŒ ãƒã‚¦ãƒ³ãƒˆå¤±æ•—', 'error', { error: error.message })
            }
        }
        
        document.getElementById('test-show').onclick = () => {
            if (!testComponent) {
                logResult('âš ï¸ å…ˆã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã—ã¦ãã ã•ã„', 'error')
                return
            }
            
            testComponent.show()
            logResult('ğŸ‘ï¸ è¡¨ç¤ºå®Ÿè¡Œ', 'success', { isVisible: testComponent.state.isVisible })
        }
        
        document.getElementById('test-hide').onclick = () => {
            if (!testComponent) {
                logResult('âš ï¸ å…ˆã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã—ã¦ãã ã•ã„', 'error')
                return
            }
            
            testComponent.hide()
            logResult('ğŸ™ˆ éè¡¨ç¤ºå®Ÿè¡Œ', 'success', { isVisible: testComponent.state.isVisible })
        }
        
        document.getElementById('test-expand').onclick = () => {
            if (!testComponent) {
                logResult('âš ï¸ å…ˆã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã—ã¦ãã ã•ã„', 'error')
                return
            }
            
            testComponent.expand()
            logResult('ğŸ“ˆ å±•é–‹å®Ÿè¡Œ', 'success', { isExpanded: testComponent.state.isExpanded })
        }
        
        document.getElementById('test-collapse').onclick = () => {
            if (!testComponent) {
                logResult('âš ï¸ å…ˆã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã—ã¦ãã ã•ã„', 'error')
                return
            }
            
            testComponent.collapse()
            logResult('ğŸ“‰ ç¸®å°å®Ÿè¡Œ', 'success', { isExpanded: testComponent.state.isExpanded })
        }
        
        document.getElementById('test-destroy').onclick = () => {
            if (!testComponent) {
                logResult('âš ï¸ å…ˆã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã—ã¦ãã ã•ã„', 'error')
                return
            }
            
            testComponent.destroy()
            logResult('ğŸ’¥ ç ´æ£„å®Ÿè¡Œ', 'success', { isDestroyed: testComponent.isDestroyed })
            testComponent = null
        }
        
        // Intenté€šä¿¡ãƒ†ã‚¹ãƒˆ
        document.getElementById('test-intent-send').onclick = () => {
            if (!testComponent) {
                logResult('âš ï¸ å…ˆã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã—ã¦ãã ã•ã„', 'error')
                return
            }
            
            testComponent.sendIntent('test.intent.example', {
                message: 'Hello from BaseUIComponent!',
                timestamp: Date.now()
            })
            logResult('ğŸ“¤ Intenté€ä¿¡ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ', 'success')
        }
        
        document.getElementById('test-intent-receive').onclick = () => {
            if (!testComponent) {
                logResult('âš ï¸ å…ˆã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã—ã¦ãã ã•ã„', 'error')
                return
            }
            
            testComponent.addIntentListener('test.intent.receive', (data) => {
                logResult('ğŸ“¨ Intentå—ä¿¡ãƒ†ã‚¹ãƒˆæˆåŠŸ', 'success', data)
            })
            
            // å—ä¿¡ãƒ†ã‚¹ãƒˆç”¨Intenté€ä¿¡
            setTimeout(() => {
                mockPluginNode.intentHandler.triggerIntent = mockPluginNode.intentHandler.triggerIntent || (() => {})
                testComponent.sendIntent('test.intent.receive', {
                    testMessage: 'Intentå—ä¿¡ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿'
                })
            }, 100)
            
            logResult('ğŸ‘‚ Intentå—ä¿¡ãƒªã‚¹ãƒŠãƒ¼è¨­å®š', 'success')
        }
        
        document.getElementById('test-state-sync').onclick = () => {
            if (!testComponent) {
                logResult('âš ï¸ å…ˆã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã—ã¦ãã ã•ã„', 'error')
                return
            }
            
            const newState = {
                testValue: 'updated value',
                timestamp: Date.now(),
                updateCount: (testComponent.state.updateCount || 0) + 1
            }
            
            testComponent.updateState(newState)
            logResult('ğŸ”„ çŠ¶æ…‹åŒæœŸãƒ†ã‚¹ãƒˆå®Ÿè¡Œ', 'success', testComponent.state)
        }
        
        // UIæ“ä½œãƒ†ã‚¹ãƒˆ
        document.getElementById('test-drag').onclick = () => {
            if (!testComponent || !testComponent.element) {
                logResult('âš ï¸ å…ˆã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆãƒ»ãƒã‚¦ãƒ³ãƒˆã—ã¦ãã ã•ã„', 'error')
                return
            }
            
            logResult('ğŸ–±ï¸ ãƒ‰ãƒ©ãƒƒã‚°æ©Ÿèƒ½ã¯æ—¢ã«æœ‰åŠ¹ã§ã™ã€‚h3éƒ¨åˆ†ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ã¿ã¦ãã ã•ã„', 'info')
        }
        
        document.getElementById('test-resize').onclick = () => {
            if (!testComponent || !testComponent.element) {
                logResult('âš ï¸ å…ˆã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆãƒ»ãƒã‚¦ãƒ³ãƒˆã—ã¦ãã ã•ã„', 'error')
                return
            }
            
            logResult('ğŸ“ ãƒªã‚µã‚¤ã‚ºæ©Ÿèƒ½ã¯æ—¢ã«æœ‰åŠ¹ã§ã™ã€‚å³ä¸‹è§’ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ã¿ã¦ãã ã•ã„', 'info')
        }
        
        document.getElementById('test-focus').onclick = () => {
            if (!testComponent) {
                logResult('âš ï¸ å…ˆã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã—ã¦ãã ã•ã„', 'error')
                return
            }
            
            testComponent.focus()
            logResult('ğŸ¯ ãƒ•ã‚©ãƒ¼ã‚«ã‚¹å®Ÿè¡Œ', 'success')
        }
        
        document.getElementById('test-move').onclick = () => {
            if (!testComponent) {
                logResult('âš ï¸ å…ˆã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã—ã¦ãã ã•ã„', 'error')
                return
            }
            
            const randomX = Math.floor(Math.random() * 400) + 100
            const randomY = Math.floor(Math.random() * 300) + 100
            
            testComponent.move({ x: randomX, y: randomY })
            logResult('ğŸ“ ä½ç½®å¤‰æ›´å®Ÿè¡Œ', 'success', { x: randomX, y: randomY })
        }
        
        // ==========================================
        // åˆæœŸåŒ–
        // ==========================================
        
        logResult('ğŸš€ BaseUIComponent ãƒ†ã‚¹ãƒˆç’°å¢ƒåˆæœŸåŒ–å®Œäº†', 'success')
        logResult('ğŸ“ æ‰‹é †: 1.ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä½œæˆ â†’ 2.ãƒã‚¦ãƒ³ãƒˆ â†’ 3.è¡¨ç¤º â†’ å„ç¨®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ', 'info')
        
    </script>
</body>
</html>