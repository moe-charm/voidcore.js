// core/CoreBulletinBoard.js
export class CoreBulletinBoard {
  constructor() {
    this.board = new Map();
    this.subscribers = [];
  }

  provide(key, value) {
    this.board.set(key, value);
    this._notify();
  }

  retract(key) {
    this.board.delete(key);
    this._notify();
  }

  observe(key) {
    return this.board.get(key);
  }

  _notify() {
    for (const fn of this.subscribers) fn();
  }

  onChange(fn) {
    this.subscribers.push(fn);
  }
}





// core/AutonomousPlugin.js
export class AutonomousPlugin {
  constructor(board, capabilityName) {
    this.board = board;
    this.capabilityName = capabilityName;
    this.alive = true;

    // è‡ªå·±æ²ç¤ºï¼ˆãƒ‡ãƒ“ãƒ¥ãƒ¼ï¼‰
    this.board.provide(this.capabilityName, this);
    console.log(`${capabilityName}: æä¾›é–‹å§‹`);
  }

  // è‡ªå·±è¦³æ¸¬ãƒ˜ãƒ«ãƒ‘ãƒ¼
  observe(name) {
    return this.board.observe(name);
  }

  // è‡ªå·±æ¶ˆæ»…ï¼ˆå¼•é€€ï¼‰
  retire() {
    if (this.alive) {
      this.board.retract(this.capabilityName);
      this.alive = false;
      console.log(`${this.capabilityName}: å¼•é€€ã—ã¾ã—ãŸ`);
    }
  }
}

âœ… ç¶™æ‰¿ã—ã¦ä½¿ã†å´ï¼ˆãƒ—ãƒ©ã‚°ã‚¤ãƒ³å´ï¼‰ã¯ã“ã†ã«ã‚ƒï¼š

// plugins/LoggerPlugin.js
import { AutonomousPlugin } from "../core/AutonomousPlugin.js";

export class LoggerPlugin extends AutonomousPlugin {
  constructor(board) {
    super(board, "log.write"); // è‡ªå‹•ã§ provide

    // ä¾‹ãˆã°èª°ã‹ã®ãƒ­ã‚°å‡ºåŠ›ã‚’è¦³æ¸¬ã™ã‚‹
    const timePlugin = this.observe("time.now");
    if (timePlugin) {
      console.log(`Logger: ç¾åœ¨æ™‚åˆ»ã¯ ${timePlugin.getTime()}`);
    }

    // æ•°ç§’å¾Œã«å¼•é€€ã™ã‚‹ãƒ‡ãƒ¢
    setTimeout(() => this.retire(), 3000);
  }

  log(message) {
    console.log(`ğŸ“ ${message}`);
  }
}

