<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ› VoidFlow Phase 4 - ãƒ‡ãƒãƒƒã‚°ã‚·ã‚¹ãƒ†ãƒ çµ±åˆãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            background: #1a1a1a;
            color: #ffffff;
            font-family: 'Courier New', monospace;
            margin: 20px;
        }
        .test-panel {
            background: #2a2a2a;
            border: 1px solid #4a90e2;
            border-radius: 8px;
            padding: 20px;
            margin: 10px 0;
        }
        .test-result {
            margin: 5px 0;
            padding: 8px;
            border-radius: 4px;
            border-left: 4px solid #4a90e2;
        }
        .success { background: rgba(0, 255, 136, 0.2); border-left-color: #00ff88; }
        .error { background: rgba(255, 107, 107, 0.2); border-left-color: #ff6b6b; }
        .pending { background: rgba(255, 193, 7, 0.2); border-left-color: #ffc107; }
        .plugin { background: rgba(138, 43, 226, 0.2); border-left-color: #8a2be2; }
        .debug { background: rgba(255, 165, 0, 0.2); border-left-color: #ffa500; }
        
        button {
            background: #4a90e2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-family: 'Courier New', monospace;
        }
        button:hover { background: #357abd; }
        button:disabled { background: #666; cursor: not-allowed; }
        
        .debug-btn { background: #ff6b35; }
        .debug-btn:hover { background: #e55a2b; }
        .plugin-btn { background: #8a2be2; }
        .plugin-btn:hover { background: #7a1dd2; }
        .intent-btn { background: #00d4aa; }
        .intent-btn:hover { background: #00b8a0; }
        
        #console-output {
            background: #000;
            border: 1px solid #333;
            padding: 10px;
            height: 500px;
            overflow-y: auto;
            font-size: 12px;
            white-space: pre-wrap;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
        
        .stat-card {
            background: #333;
            padding: 15px;
            border-radius: 4px;
            text-align: center;
            border: 1px solid #555;
        }
        
        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: #4a90e2;
        }
        
        .debug-feature {
            background: #2a2a2a;
            border: 1px solid #ff6b35;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .feature-section {
            background: #333;
            padding: 10px;
            margin: 8px 0;
            border-radius: 4px;
            border-left: 3px solid #ff6b35;
        }
        
        .code-snippet {
            background: #000;
            border: 1px solid #444;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            color: #00ff88;
        }
        
        .phase-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .phase-header h1 {
            margin: 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body>
    <div class="phase-header">
        <h1>ğŸ› VoidFlow Phase 4 - ãƒ‡ãƒãƒƒã‚°ã‚·ã‚¹ãƒ†ãƒ çµ±åˆãƒ†ã‚¹ãƒˆ</h1>
        <p>VoidCore v14.0æº–æ‹  VoidFlowDebugPlugin + VoidFlowCoreçµ±åˆ</p>
    </div>
    
    <!-- ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ -->
    <div class="test-panel">
        <h2>ğŸš€ ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ</h2>
        <div id="init-results">
            <div class="test-result pending">ğŸ”„ ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ä¸­...</div>
        </div>
        <button onclick="runInitializationTests()" class="plugin-btn">åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
        <button onclick="checkSystemStatus()" class="debug-btn">ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ç¢ºèª</button>
        <button onclick="getSystemStats()">çµ±è¨ˆæƒ…å ±å–å¾—</button>
    </div>
    
    <!-- VoidCoreãƒ—ãƒ©ã‚°ã‚¤ãƒ³çµ±åˆãƒ†ã‚¹ãƒˆ -->
    <div class="test-panel">
        <h2>ğŸ§© VoidCoreãƒ—ãƒ©ã‚°ã‚¤ãƒ³çµ±åˆãƒ†ã‚¹ãƒˆ</h2>
        <div id="plugin-results">
            <div class="test-result pending">ğŸ”„ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æº–å‚™ä¸­...</div>
        </div>
        <button onclick="runPluginIntegrationTests()" class="plugin-btn">ãƒ—ãƒ©ã‚°ã‚¤ãƒ³çµ±åˆãƒ†ã‚¹ãƒˆ</button>
        <button onclick="testPluginLifecycle()" class="plugin-btn">ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒ†ã‚¹ãƒˆ</button>
        <button onclick="testVoidCoreRegistration()">VoidCoreç™»éŒ²ç¢ºèª</button>
        <button onclick="getRegisteredPlugins()">ç™»éŒ²ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ä¸€è¦§</button>
    </div>
    
    <!-- Intentå‡¦ç†ãƒ†ã‚¹ãƒˆ -->
    <div class="test-panel">
        <h2>ğŸ¯ Intentå‡¦ç†ãƒ†ã‚¹ãƒˆ</h2>
        <div class="debug-feature">
            <h3>ãƒ‡ãƒãƒƒã‚°Intentå‡¦ç†</h3>
            <div class="feature-section">
                <button onclick="testDebugIntents()" class="intent-btn">ãƒ‡ãƒãƒƒã‚°Intentå…¨ãƒ†ã‚¹ãƒˆ</button>
                <button onclick="sendTraceStartIntent()" class="debug-btn">ãƒˆãƒ¬ãƒ¼ã‚¹é–‹å§‹Intent</button>
                <button onclick="sendStateCaptureIntent()" class="debug-btn">çŠ¶æ…‹ã‚­ãƒ£ãƒ—ãƒãƒ£Intent</button>
                <button onclick="sendStatsIntent()" class="debug-btn">çµ±è¨ˆIntent</button>
            </div>
        </div>
        <div id="intent-results"></div>
    </div>
    
    <!-- ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ -->
    <div class="test-panel">
        <h2>ğŸ” ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h2>
        <div class="debug-feature">
            <h3>ãƒˆãƒ¬ãƒ¼ã‚¹æ©Ÿèƒ½</h3>
            <div class="feature-section">
                <button onclick="enableTracing()" class="debug-btn">ãƒˆãƒ¬ãƒ¼ã‚¹æœ‰åŠ¹åŒ–</button>
                <button onclick="disableTracing()" class="debug-btn">ãƒˆãƒ¬ãƒ¼ã‚¹ç„¡åŠ¹åŒ–</button>
                <button onclick="getTraceHistory()" class="debug-btn">ãƒˆãƒ¬ãƒ¼ã‚¹å±¥æ­´ç¢ºèª</button>
                <button onclick="clearTraceHistory()" class="debug-btn">å±¥æ­´ã‚¯ãƒªã‚¢</button>
            </div>
        </div>
        
        <div class="debug-feature">
            <h3>çŠ¶æ…‹ç®¡ç†æ©Ÿèƒ½</h3>
            <div class="feature-section">
                <button onclick="captureSystemState()" class="debug-btn">çŠ¶æ…‹ã‚­ãƒ£ãƒ—ãƒãƒ£</button>
                <button onclick="dumpSystemState()" class="debug-btn">çŠ¶æ…‹ãƒ€ãƒ³ãƒ—</button>
                <button onclick="getStateHistory()" class="debug-btn">çŠ¶æ…‹å±¥æ­´</button>
            </div>
        </div>
        
        <div class="debug-feature">
            <h3>ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ©Ÿèƒ½</h3>
            <div class="feature-section">
                <button onclick="runPerformanceTests()" class="debug-btn">ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ</button>
                <button onclick="runBenchmarkSuite()" class="debug-btn">ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯å®Ÿè¡Œ</button>
                <button onclick="getPerformanceStats()" class="debug-btn">ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çµ±è¨ˆ</button>
            </div>
        </div>
    </div>
    
    <!-- ã‚·ã‚¹ãƒ†ãƒ çµ±è¨ˆæƒ…å ± -->
    <div class="test-panel">
        <h2>ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ çµ±è¨ˆæƒ…å ±</h2>
        <div class="stats-grid" id="stats-grid">
            <div class="stat-card">
                <div>VoidFlowCoreçŠ¶æ…‹</div>
                <div class="stat-value" id="core-status">æœªåˆæœŸåŒ–</div>
            </div>
            <div class="stat-card">
                <div>DebugPluginçŠ¶æ…‹</div>
                <div class="stat-value" id="plugin-status">æœªåˆæœŸåŒ–</div>
            </div>
            <div class="stat-card">
                <div>å‡¦ç†Intentæ•°</div>
                <div class="stat-value" id="intent-count">0</div>
            </div>
            <div class="stat-card">
                <div>å®Ÿè¡Œãƒ†ã‚¹ãƒˆæ•°</div>
                <div class="stat-value" id="test-count">0</div>
            </div>
        </div>
        <button onclick="updateAllStats()" class="debug-btn">çµ±è¨ˆæ›´æ–°</button>
        <button onclick="exportDebugData()" class="debug-btn">ãƒ‡ãƒãƒƒã‚°ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
        <button onclick="resetAllDebugData()" class="debug-btn">ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆ</button>
    </div>
    
    <!-- ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ³ã‚½ãƒ¼ãƒ« -->
    <div class="test-panel">
        <h2>ğŸ”§ ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ³ã‚½ãƒ¼ãƒ«</h2>
        <p>ãƒ–ãƒ©ã‚¦ã‚¶é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã§ãã¾ã™ï¼š</p>
        
        <div class="code-snippet">
<strong>ğŸŒŸ VoidFlowCoreåˆ¶å¾¡:</strong>
debugVoidFlow.core()                    // VoidFlowCoreã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å–å¾—
debugVoidFlow.debugPlugin()             // VoidFlowDebugPluginå–å¾—
debugVoidFlow.getStats()                // ã‚·ã‚¹ãƒ†ãƒ çµ±è¨ˆå–å¾—

<strong>ğŸ› ãƒ‡ãƒãƒƒã‚°ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ç›´æ¥åˆ¶å¾¡:</strong>
voidflowDebug.trace('voidflow.*')       // ãƒˆãƒ¬ãƒ¼ã‚¹é–‹å§‹
voidflowDebug.stopTrace()               // ãƒˆãƒ¬ãƒ¼ã‚¹åœæ­¢
voidflowDebug.stats()                   // ã‚·ã‚¹ãƒ†ãƒ çµ±è¨ˆ
voidflowDebug.benchmark('test', 100)    // ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯å®Ÿè¡Œ

<strong>ğŸ¯ Intenté€ä¿¡ãƒ†ã‚¹ãƒˆ:</strong>
debugVoidFlow.startTrace(['*'], 'detailed')
debugVoidFlow.dumpState('json')
debugVoidFlow.export()

<strong>ğŸ“Š è©³ç´°åˆ†æ:</strong>
testPage.getSystemAnalysis()           // ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“åˆ†æ
testPage.getTestResults()              // ãƒ†ã‚¹ãƒˆçµæœã‚µãƒãƒªãƒ¼
testPage.runAllTests()                 // å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        </div>
    </div>
    
    <!-- ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ› -->
    <div class="test-panel">
        <h2>ğŸ–¥ï¸ ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›</h2>
        <div id="console-output"></div>
        <button onclick="clearConsole()">ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚¯ãƒªã‚¢</button>
        <button onclick="exportConsoleLog()">ãƒ­ã‚°ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
    </div>

    <script type="module">
        import { VoidFlowCore } from './voidflow/js/voidflow-core.js'
        
        let voidFlowCore = null
        let debugPlugin = null
        let testCount = 0
        let intentCount = 0
        
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°å®šç¾©
        window.runInitializationTests = runInitializationTests
        window.runPluginIntegrationTests = runPluginIntegrationTests
        window.testPluginLifecycle = testPluginLifecycle
        window.testVoidCoreRegistration = testVoidCoreRegistration
        window.getRegisteredPlugins = getRegisteredPlugins
        window.testDebugIntents = testDebugIntents
        window.sendTraceStartIntent = sendTraceStartIntent
        window.sendStateCaptureIntent = sendStateCaptureIntent
        window.sendStatsIntent = sendStatsIntent
        window.enableTracing = enableTracing
        window.disableTracing = disableTracing
        window.getTraceHistory = getTraceHistory
        window.clearTraceHistory = clearTraceHistory
        window.captureSystemState = captureSystemState
        window.dumpSystemState = dumpSystemState
        window.getStateHistory = getStateHistory
        window.runPerformanceTests = runPerformanceTests
        window.runBenchmarkSuite = runBenchmarkSuite
        window.getPerformanceStats = getPerformanceStats
        window.checkSystemStatus = checkSystemStatus
        window.getSystemStats = getSystemStats
        window.updateAllStats = updateAllStats
        window.exportDebugData = exportDebugData
        window.resetAllDebugData = resetAllDebugData
        window.clearConsole = clearConsole
        window.exportConsoleLog = exportConsoleLog
        
        // ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ãƒ˜ãƒ«ãƒ‘ãƒ¼
        window.testPage = {
            getSystemAnalysis: getSystemAnalysis,
            getTestResults: getTestResults,
            runAllTests: runAllTests,
            getVoidFlowCore: () => voidFlowCore,
            getDebugPlugin: () => debugPlugin
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', async function() {
            log('ğŸŒŸ VoidFlow Phase 4 ãƒ‡ãƒãƒƒã‚°ã‚·ã‚¹ãƒ†ãƒ çµ±åˆãƒ†ã‚¹ãƒˆé–‹å§‹...')
            
            try {
                // VoidFlowCoreåˆæœŸåŒ–
                voidFlowCore = new VoidFlowCore({
                    enableDebug: true,
                    enableStats: true,
                    intentTraceLevel: 'detailed'
                })
                
                // åˆæœŸåŒ–å®Œäº†ã¾ã§å¾…æ©Ÿ
                await voidFlowCore.initPromise
                
                // DebugPluginå‚ç…§å–å¾—
                debugPlugin = voidFlowCore.debugPlugin
                
                // ã‚°ãƒ­ãƒ¼ãƒãƒ«å‚ç…§è¨­å®š
                window.voidFlowCore = voidFlowCore
                window.debugPlugin = debugPlugin
                
                log('âœ… VoidFlowCore + VoidFlowDebugPlugin åˆæœŸåŒ–å®Œäº†ï¼')
                updateTestResult('init-results', 'âœ… ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†', 'success')
                
                // çµ±è¨ˆæƒ…å ±æ›´æ–°
                updateAllStats()
                
            } catch (error) {
                log(`âŒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`)
                updateTestResult('init-results', `âŒ åˆæœŸåŒ–å¤±æ•—: ${error.message}`, 'error')
                updateAllStats()
            }
        })
        
        // åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ
        async function runInitializationTests() {
            log('ğŸš€ ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆé–‹å§‹...')
            updateTestResult('init-results', 'ğŸ”„ åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...', 'pending')
            
            const tests = [
                { name: 'VoidFlowCoreåˆæœŸåŒ–ç¢ºèª', test: testVoidFlowCoreInit },
                { name: 'VoidCoreçµ±åˆç¢ºèª', test: testVoidCoreIntegration },
                { name: 'DebugPluginç™»éŒ²ç¢ºèª', test: testDebugPluginRegistration },
                { name: 'Intentå‡¦ç†æ©Ÿèƒ½ç¢ºèª', test: testIntentProcessing },
                { name: 'ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ç¢ºèª', test: testGlobalFunctions }
            ]
            
            let passed = 0
            let failed = 0
            
            for (const test of tests) {
                try {
                    log(`ğŸ” ${test.name}ãƒ†ã‚¹ãƒˆé–‹å§‹...`)
                    await test.test()
                    log(`âœ… ${test.name}ãƒ†ã‚¹ãƒˆæˆåŠŸ`)
                    passed++
                    testCount++
                } catch (error) {
                    log(`âŒ ${test.name}ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`)
                    failed++
                    testCount++
                }
            }
            
            const result = `åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆå®Œäº†: ${passed}æˆåŠŸ, ${failed}å¤±æ•—`
            const status = failed === 0 ? 'success' : 'error'
            log(`ğŸ‰ ${result}`)
            updateTestResult('init-results', result, status)
            updateAllStats()
        }
        
        // å€‹åˆ¥åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ
        async function testVoidFlowCoreInit() {
            if (!voidFlowCore || !voidFlowCore.isInitialized) {
                throw new Error('VoidFlowCore not initialized')
            }
        }
        
        async function testVoidCoreIntegration() {
            if (!voidFlowCore.voidCore) {
                throw new Error('VoidCore integration failed')
            }
            
            const stats = voidFlowCore.voidCore.getStats()
            if (!stats) {
                throw new Error('VoidCore stats not available')
            }
        }
        
        async function testDebugPluginRegistration() {
            if (!debugPlugin) {
                throw new Error('DebugPlugin not available')
            }
            
            const plugins = voidFlowCore.voidCore.getPlugins()
            const found = plugins.find(p => p.id === debugPlugin.id)
            if (!found) {
                throw new Error('DebugPlugin not registered in VoidCore')
            }
        }
        
        async function testIntentProcessing() {
            const result = await voidFlowCore.sendIntent('voidflow.debug.stats.get')
            if (!result || result.status !== 'success') {
                throw new Error('Intent processing failed')
            }
            intentCount++
        }
        
        async function testGlobalFunctions() {
            if (!window.debugVoidFlow || !window.voidflowDebug) {
                throw new Error('Global debug functions not available')
            }
        }
        
        // ãƒ—ãƒ©ã‚°ã‚¤ãƒ³çµ±åˆãƒ†ã‚¹ãƒˆ
        async function runPluginIntegrationTests() {
            log('ğŸ§© VoidCoreãƒ—ãƒ©ã‚°ã‚¤ãƒ³çµ±åˆãƒ†ã‚¹ãƒˆé–‹å§‹...')
            updateTestResult('plugin-results', 'ğŸ”„ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...', 'pending')
            
            const tests = [
                { name: 'IPluginç¶™æ‰¿ç¢ºèª', test: testIPluginInheritance },
                { name: 'ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«', test: testPluginLifecycleInternal },
                { name: 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç†', test: testPluginMessageProcessing },
                { name: 'Intentå‡¦ç†', test: testPluginIntentHandling },
                { name: 'VoidCoreé€£æº', test: testPluginVoidCoreIntegration }
            ]
            
            let passed = 0
            let failed = 0
            
            for (const test of tests) {
                try {
                    log(`ğŸ” ${test.name}ãƒ†ã‚¹ãƒˆé–‹å§‹...`)
                    await test.test()
                    log(`âœ… ${test.name}ãƒ†ã‚¹ãƒˆæˆåŠŸ`)
                    passed++
                    testCount++
                } catch (error) {
                    log(`âŒ ${test.name}ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`)
                    failed++
                    testCount++
                }
            }
            
            const result = `ãƒ—ãƒ©ã‚°ã‚¤ãƒ³çµ±åˆãƒ†ã‚¹ãƒˆå®Œäº†: ${passed}æˆåŠŸ, ${failed}å¤±æ•—`
            const status = failed === 0 ? 'success' : 'error'
            log(`ğŸ‰ ${result}`)
            updateTestResult('plugin-results', result, status)
            updateAllStats()
        }
        
        // ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å€‹åˆ¥ãƒ†ã‚¹ãƒˆ
        async function testIPluginInheritance() {
            const requiredMethods = ['onActivated', 'onDeactivated', 'processMessage', 'handleIntent']
            for (const method of requiredMethods) {
                if (typeof debugPlugin[method] !== 'function') {
                    throw new Error(`Required method ${method} not found`)
                }
            }
        }
        
        async function testPluginLifecycleInternal() {
            const deactivateResult = await debugPlugin.onDeactivated()
            if (!deactivateResult || deactivateResult.status !== 'deactivated') {
                throw new Error('Plugin deactivation failed')
            }
            
            const activateResult = await debugPlugin.onActivated()
            if (!activateResult || activateResult.status !== 'activated') {
                throw new Error('Plugin activation failed')
            }
        }
        
        async function testPluginMessageProcessing() {
            const testMessage = {
                type: 'debug.stats.get',
                payload: { test: true }
            }
            
            const result = await debugPlugin.processMessage(testMessage)
            if (!result) {
                throw new Error('Message processing failed')
            }
        }
        
        async function testPluginIntentHandling() {
            const testIntent = {
                intent: 'voidflow.debug.stats.get',
                payload: { test: true }
            }
            
            const result = await debugPlugin.handleIntent(testIntent)
            if (!result || result.status !== 'success') {
                throw new Error('Intent handling failed')
            }
            intentCount++
        }
        
        async function testPluginVoidCoreIntegration() {
            if (!debugPlugin.voidFlowCore) {
                throw new Error('VoidFlowCore integration missing')
            }
            
            if (debugPlugin.voidFlowCore !== voidFlowCore) {
                throw new Error('VoidFlowCore reference mismatch')
            }
        }
        
        // Intentå‡¦ç†ãƒ†ã‚¹ãƒˆ
        async function testDebugIntents() {
            log('ğŸ¯ ãƒ‡ãƒãƒƒã‚°Intentå‡¦ç†ãƒ†ã‚¹ãƒˆé–‹å§‹...')
            
            const intents = [
                'voidflow.debug.stats.get',
                'voidflow.debug.trace.start',
                'voidflow.debug.trace.stop',
                'voidflow.debug.state.capture',
                'voidflow.debug.state.dump'
            ]
            
            for (const intent of intents) {
                try {
                    const payload = intent.includes('trace.start') ? { patterns: ['test.*'], level: 'basic' } : {}
                    const result = await voidFlowCore.sendIntent(intent, payload)
                    logPlugin(`âœ… ${intent} å‡¦ç†æˆåŠŸ`, result)
                    intentCount++
                } catch (error) {
                    log(`âŒ ${intent} å‡¦ç†å¤±æ•—: ${error.message}`)
                }
            }
            
            updateAllStats()
        }
        
        async function sendTraceStartIntent() {
            try {
                const result = await voidFlowCore.sendIntent('voidflow.debug.trace.start', {
                    patterns: ['voidflow.*'],
                    level: 'detailed'
                })
                logPlugin('ğŸ” ãƒˆãƒ¬ãƒ¼ã‚¹é–‹å§‹Intenté€ä¿¡æˆåŠŸ', result)
                intentCount++
                updateAllStats()
            } catch (error) {
                log(`âŒ ãƒˆãƒ¬ãƒ¼ã‚¹é–‹å§‹Intentå¤±æ•—: ${error.message}`)
            }
        }
        
        async function sendStateCaptureIntent() {
            try {
                const result = await voidFlowCore.sendIntent('voidflow.debug.state.capture')
                logPlugin('ğŸ“¸ çŠ¶æ…‹ã‚­ãƒ£ãƒ—ãƒãƒ£Intenté€ä¿¡æˆåŠŸ', result)
                intentCount++
                updateAllStats()
            } catch (error) {
                log(`âŒ çŠ¶æ…‹ã‚­ãƒ£ãƒ—ãƒãƒ£Intentå¤±æ•—: ${error.message}`)
            }
        }
        
        async function sendStatsIntent() {
            try {
                const result = await voidFlowCore.sendIntent('voidflow.debug.stats.get')
                logPlugin('ğŸ“Š çµ±è¨ˆIntenté€ä¿¡æˆåŠŸ', result)
                intentCount++
                updateAllStats()
            } catch (error) {
                log(`âŒ çµ±è¨ˆIntentå¤±æ•—: ${error.message}`)
            }
        }
        
        // ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
        function enableTracing() {
            const result = debugPlugin.enableTrace(['voidflow.*'], 'detailed')
            log(`ğŸ” ${result}`)
        }
        
        function disableTracing() {
            const result = debugPlugin.disableTrace()
            log(`ğŸ” ${result}`)
        }
        
        function getTraceHistory() {
            const history = debugPlugin.getTraceHistory()
            logPlugin('ğŸ“Š ãƒˆãƒ¬ãƒ¼ã‚¹å±¥æ­´', history)
        }
        
        function clearTraceHistory() {
            const result = debugPlugin.clearTraceHistory()
            log(`ğŸ§¹ ${result}`)
        }
        
        function captureSystemState() {
            const state = debugPlugin.captureState()
            logPlugin('ğŸ“¸ ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ã‚­ãƒ£ãƒ—ãƒãƒ£', state)
        }
        
        function dumpSystemState() {
            debugPlugin.dumpState('table')
        }
        
        function getStateHistory() {
            const history = debugPlugin.getStateHistory()
            logPlugin('ğŸ“Š çŠ¶æ…‹å±¥æ­´', history)
        }
        
        async function runPerformanceTests() {
            log('âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆé–‹å§‹...')
            
            const perfResult = debugPlugin.measurePerformance('test-calculation', () => {
                let sum = 0
                for (let i = 0; i < 10000; i++) sum += Math.random()
                return sum
            })
            
            logPlugin('âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨ˆæ¸¬å®Œäº†', perfResult)
        }
        
        async function runBenchmarkSuite() {
            log('ğŸƒ ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚¹ã‚¤ãƒ¼ãƒˆé–‹å§‹...')
            
            const benchmarks = ['system-state', 'ui-update', 'memory-test']
            
            for (const benchmark of benchmarks) {
                try {
                    const result = await debugPlugin.runBenchmark(benchmark, 50)
                    logPlugin(`ğŸ ${benchmark} ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯å®Œäº†`, result)
                } catch (error) {
                    log(`âŒ ${benchmark} ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯å¤±æ•—: ${error.message}`)
                }
            }
        }
        
        function getPerformanceStats() {
            const stats = debugPlugin.getPerformanceStats()
            logPlugin('ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çµ±è¨ˆ', stats)
        }
        
        // ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†æ©Ÿèƒ½
        function checkSystemStatus() {
            const status = voidFlowCore.getSystemStatus()
            logPlugin('ğŸ” ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹', status)
        }
        
        function getSystemStats() {
            const stats = debugPlugin.getSystemStats()
            logPlugin('ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ çµ±è¨ˆ', stats)
        }
        
        function updateAllStats() {
            if (voidFlowCore) {
                document.getElementById('core-status').textContent = voidFlowCore.isInitialized ? 'initialized' : 'not initialized'
            }
            if (debugPlugin) {
                document.getElementById('plugin-status').textContent = debugPlugin.status
            }
            document.getElementById('intent-count').textContent = intentCount
            document.getElementById('test-count').textContent = testCount
        }
        
        function exportDebugData() {
            if (debugPlugin) {
                const result = debugPlugin.exportDebugData()
                log(`ğŸ’¾ ${result}`)
            }
        }
        
        function resetAllDebugData() {
            if (debugPlugin) {
                const result = debugPlugin.resetAllData()
                log(`ğŸ”„ ${result}`)
                testCount = 0
                intentCount = 0
                updateAllStats()
            }
        }
        
        // ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ç®¡ç†
        async function testPluginLifecycle() {
            log('ğŸ”„ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒ†ã‚¹ãƒˆé–‹å§‹...')
            
            try {
                await debugPlugin.onDeactivated()
                log('âœ… ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ç„¡åŠ¹åŒ–æˆåŠŸ')
                
                await debugPlugin.onActivated()
                log('âœ… ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æœ‰åŠ¹åŒ–æˆåŠŸ')
                
                updateAllStats()
                
            } catch (error) {
                log(`âŒ ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`)
            }
        }
        
        function testVoidCoreRegistration() {
            const plugins = voidFlowCore.voidCore.getPlugins()
            const found = plugins.find(p => p.id === debugPlugin.id)
            
            if (found) {
                logPlugin('âœ… VoidCoreç™»éŒ²ç¢ºèª', found.getSummary())
            } else {
                log('âŒ VoidCoreç™»éŒ²ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“')
            }
        }
        
        function getRegisteredPlugins() {
            const plugins = voidFlowCore.voidCore.getPlugins()
            logPlugin('ğŸ§© ç™»éŒ²ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ä¸€è¦§', plugins.map(p => p.getSummary()))
        }
        
        // ãƒ†ã‚¹ãƒˆãƒ˜ãƒ«ãƒ‘ãƒ¼
        async function runAllTests() {
            await runInitializationTests()
            await runPluginIntegrationTests()
            await testDebugIntents()
            await runPerformanceTests()
        }
        
        function getTestResults() {
            return {
                testCount,
                intentCount,
                systemStatus: voidFlowCore ? voidFlowCore.getSystemStatus() : null,
                pluginStatus: debugPlugin ? debugPlugin.getSystemStats() : null
            }
        }
        
        function getSystemAnalysis() {
            return {
                voidFlowCore: voidFlowCore ? {
                    initialized: voidFlowCore.isInitialized,
                    features: voidFlowCore.getAvailableFeatures(),
                    status: voidFlowCore.getSystemStatus()
                } : null,
                debugPlugin: debugPlugin ? {
                    id: debugPlugin.id,
                    type: debugPlugin.type,
                    status: debugPlugin.status,
                    stats: debugPlugin.getSystemStats()
                } : null,
                testResults: getTestResults()
            }
        }
        
        // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
        function log(message) {
            console.log(message)
            const output = document.getElementById('console-output')
            const timestamp = new Date().toLocaleTimeString()
            output.textContent += `[${timestamp}] ${message}\n`
            output.scrollTop = output.scrollHeight
        }
        
        function logPlugin(message, data) {
            const output = document.getElementById('console-output')
            const timestamp = new Date().toLocaleTimeString()
            output.textContent += `[${timestamp}] ${message}\n${JSON.stringify(data, null, 2)}\n\n`
            output.scrollTop = output.scrollHeight
        }
        
        function updateTestResult(elementId, message, status) {
            const element = document.getElementById(elementId)
            element.innerHTML = `<div class="test-result ${status}">${message}</div>`
        }
        
        function clearConsole() {
            document.getElementById('console-output').textContent = ''
            log('ğŸ§¹ ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚¯ãƒªã‚¢å®Œäº†')
        }
        
        function exportConsoleLog() {
            const consoleContent = document.getElementById('console-output').textContent
            const blob = new Blob([consoleContent], { type: 'text/plain' })
            const url = URL.createObjectURL(blob)
            
            const a = document.createElement('a')
            a.href = url
            a.download = `voidflow-phase4-log-${Date.now()}.txt`
            a.click()
            
            URL.revokeObjectURL(url)
            log('ğŸ’¾ ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå®Œäº†')
        }
    </script>
</body>
</html>