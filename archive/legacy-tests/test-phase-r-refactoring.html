<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”§ Phase R: VoidCore ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°</title>
    <style>
        body {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            color: #ffffff;
            padding: 20px;
            min-height: 100vh;
            margin: 0;
        }
        
        .test-container {
            max-width: 1600px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .test-section {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid #555;
            border-radius: 8px;
            padding: 20px;
        }
        
        .test-title {
            color: #4a90e2;
            font-size: 16px;
            margin-bottom: 15px;
            border-bottom: 2px solid #4a90e2;
            padding-bottom: 5px;
        }
        
        .button {
            background: #4a90e2;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 10px 15px;
            cursor: pointer;
            margin: 5px;
            font-family: inherit;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        
        .button:hover {
            background: #357abd;
            transform: translateY(-2px);
        }
        
        .button.success {
            background: #27ae60;
        }
        
        .button.warning {
            background: #f39c12;
        }
        
        .button.danger {
            background: #e74c3c;
        }
        
        .log-area {
            background: #0a0a0a;
            border: 1px solid #333;
            border-radius: 6px;
            padding: 15px;
            height: 300px;
            overflow-y: auto;
            font-size: 11px;
            line-height: 1.4;
            margin: 10px 0;
        }
        
        .stats-panel {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .stats-item {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            font-size: 12px;
        }
        
        .stats-label {
            color: #bbb;
        }
        
        .stats-value {
            color: #4a90e2;
            font-weight: bold;
        }
        
        .header {
            grid-column: 1 / -1;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .header h1 {
            color: #4a90e2;
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .phase-indicator {
            background: linear-gradient(45deg, #4a90e2, #27ae60, #f39c12);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            display: inline-block;
        }
        
        .test-result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            border-left: 4px solid;
        }
        
        .test-result.success {
            background: rgba(39, 174, 96, 0.2);
            border-color: #27ae60;
        }
        
        .test-result.error {
            background: rgba(231, 76, 60, 0.2);
            border-color: #e74c3c;
        }
        
        .test-result.info {
            background: rgba(74, 144, 226, 0.2);
            border-color: #4a90e2;
        }

        .comparison-table {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
            font-size: 11px;
        }

        .comparison-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .comparison-table th,
        .comparison-table td {
            border: 1px solid #333;
            padding: 8px;
            text-align: left;
        }

        .comparison-table th {
            background: #2a2a2a;
            color: #4a90e2;
        }

        .old-way {
            color: #e74c3c;
        }

        .new-way {
            color: #27ae60;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="header">
            <h1>ğŸ”§ Phase R: VoidCore ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°</h1>
            <div class="phase-indicator">ChatGPTçµ±ä¸€Intentã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…</div>
        </div>
        
        <div class="test-section">
            <div class="test-title">ğŸ¯ çµ±ä¸€Intentã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ</div>
            
            <button class="button" onclick="testSendIntentAPI()">sendIntent APIåŸºæœ¬ãƒ†ã‚¹ãƒˆ</button>
            <button class="button" onclick="testSystemIntents()">ã‚·ã‚¹ãƒ†ãƒ Intentãƒ†ã‚¹ãƒˆ</button>
            <button class="button success" onclick="testPluginIntents()">ãƒ—ãƒ©ã‚°ã‚¤ãƒ³Intentãƒ†ã‚¹ãƒˆ</button>
            <button class="button warning" onclick="testErrorHandling()">ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°</button>
            
            <div class="log-area" id="intentLog"></div>
            
            <div class="stats-panel">
                <div class="test-title">Intentçµ±è¨ˆ</div>
                <div class="stats-item">
                    <span class="stats-label">é€ä¿¡æ¸ˆã¿Intent:</span>
                    <span class="stats-value" id="sentIntents">0</span>
                </div>
                <div class="stats-item">
                    <span class="stats-label">æˆåŠŸå‡¦ç†:</span>
                    <span class="stats-value" id="successfulIntents">0</span>
                </div>
                <div class="stats-item">
                    <span class="stats-label">ã‚¨ãƒ©ãƒ¼å‡¦ç†:</span>
                    <span class="stats-value" id="errorIntents">0</span>
                </div>
                <div class="stats-item">
                    <span class="stats-label">å¹³å‡å‡¦ç†æ™‚é–“:</span>
                    <span class="stats-value" id="avgProcessTime">0ms</span>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <div class="test-title">ğŸ§© IPlugin ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ</div>
            
            <button class="button" onclick="testIPluginInterface()">IPluginåŸºæœ¬æ©Ÿèƒ½</button>
            <button class="button" onclick="testICorePlugin()">ICorePluginæ©Ÿèƒ½</button>
            <button class="button" onclick="testPluginTypeGuards()">å‹åˆ¤å®šæ©Ÿèƒ½</button>
            <button class="button success" onclick="testPluginCreation()">ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ä½œæˆ</button>
            
            <div class="log-area" id="pluginLog"></div>
            
            <div class="stats-panel">
                <div class="test-title">ãƒ—ãƒ©ã‚°ã‚¤ãƒ³çµ±è¨ˆ</div>
                <div class="stats-item">
                    <span class="stats-label">ä½œæˆæ¸ˆã¿ãƒ—ãƒ©ã‚°ã‚¤ãƒ³:</span>
                    <span class="stats-value" id="createdPlugins">0</span>
                </div>
                <div class="stats-item">
                    <span class="stats-label">ã‚³ã‚¢ãƒ—ãƒ©ã‚°ã‚¤ãƒ³:</span>
                    <span class="stats-value" id="corePlugins">0</span>
                </div>
                <div class="stats-item">
                    <span class="stats-label">ä¸€èˆ¬ãƒ—ãƒ©ã‚°ã‚¤ãƒ³:</span>
                    <span class="stats-value" id="regularPlugins">0</span>
                </div>
                <div class="stats-item">
                    <span class="stats-label">å‡¦ç†æ¸ˆã¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:</span>
                    <span class="stats-value" id="processedMessages">0</span>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <div class="test-title">ğŸ”„ Before/Afteræ¯”è¼ƒãƒ†ã‚¹ãƒˆ</div>
            
            <button class="button" onclick="testOldVsNewAPI()">æ—§API vs æ–°APIæ¯”è¼ƒ</button>
            <button class="button warning" onclick="testMigrationPath()">ç§»è¡Œãƒ‘ã‚¹ãƒ†ã‚¹ãƒˆ</button>
            <button class="button success" onclick="testBackwardCompatibility()">ä¸‹ä½äº’æ›æ€§ç¢ºèª</button>
            
            <div class="comparison-table">
                <table>
                    <thead>
                        <tr>
                            <th>æ“ä½œ</th>
                            <th class="old-way">Before (æ—§æ–¹å¼)</th>
                            <th class="new-way">After (Intentçµ±ä¸€)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ä½œæˆ</td>
                            <td class="old-way">system.createPlugin(config)</td>
                            <td class="new-way">sendIntent('system.createPlugin', config)</td>
                        </tr>
                        <tr>
                            <td>è¦ªå­é–¢ä¿‚å¤‰æ›´</td>
                            <td class="old-way">system.reparentPlugin(child, parent)</td>
                            <td class="new-way">sendIntent('system.reparentPlugin', {childId, newParentId})</td>
                        </tr>
                        <tr>
                            <td>ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å‰Šé™¤</td>
                            <td class="old-way">system.destroyPlugin(id)</td>
                            <td class="new-way">sendIntent('system.destroyPlugin', {pluginId})</td>
                        </tr>
                        <tr>
                            <td>çµ±è¨ˆå–å¾—</td>
                            <td class="old-way">getStats()</td>
                            <td class="new-way">sendIntent('system.getStats')</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="log-area" id="comparisonLog"></div>
        </div>
        
        <div class="test-section">
            <div class="test-title">ğŸ“Š ç·åˆãƒ†ã‚¹ãƒˆçµæœ</div>
            
            <button class="button" onclick="runFullPhaseRSuite()">Phase R å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <button class="button" onclick="updateAllStats()">çµ±è¨ˆæ›´æ–°</button>
            <button class="button success" onclick="exportResults()">çµæœã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
            <button class="button danger" onclick="clearAllTests()">ãƒ†ã‚¹ãƒˆã‚¯ãƒªã‚¢</button>
            
            <div id="testResults"></div>
            
            <div class="stats-panel">
                <div class="test-title">Phase Rçµ±åˆçŠ¶æ³</div>
                <div class="stats-item">
                    <span class="stats-label">å®Ÿè¡Œãƒ†ã‚¹ãƒˆæ•°:</span>
                    <span class="stats-value" id="totalTests">0</span>
                </div>
                <div class="stats-item">
                    <span class="stats-label">æˆåŠŸãƒ†ã‚¹ãƒˆ:</span>
                    <span class="stats-value" id="successfulTests">0</span>
                </div>
                <div class="stats-item">
                    <span class="stats-label">ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°é€²æ—:</span>
                    <span class="stats-value" id="refactoringProgress">0%</span>
                </div>
                <div class="stats-item">
                    <span class="stats-label">Intentçµ±ä¸€ç‡:</span>
                    <span class="stats-value" id="intentUnificationRate">0%</span>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { voidCore } from './src/voidcore.js';
        import { IPlugin, ICorePlugin, isCorePlugin, createPlugin } from './src/plugin-interface.js';
        import { Message } from './src/message.js';

        // ãƒ†ã‚¹ãƒˆçŠ¶æ…‹
        let testStats = {
            totalTests: 0,
            successfulTests: 0,
            sentIntents: 0,
            successfulIntents: 0,
            errorIntents: 0,
            createdPlugins: 0,
            corePlugins: 0,
            regularPlugins: 0,
            processedMessages: 0,
            processingTimes: []
        };

        let testPlugins = [];

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°å®šç¾©
        window.testSendIntentAPI = testSendIntentAPI;
        window.testSystemIntents = testSystemIntents;
        window.testPluginIntents = testPluginIntents;
        window.testErrorHandling = testErrorHandling;
        window.testIPluginInterface = testIPluginInterface;
        window.testICorePlugin = testICorePlugin;
        window.testPluginTypeGuards = testPluginTypeGuards;
        window.testPluginCreation = testPluginCreation;
        window.testOldVsNewAPI = testOldVsNewAPI;
        window.testMigrationPath = testMigrationPath;
        window.testBackwardCompatibility = testBackwardCompatibility;
        window.runFullPhaseRSuite = runFullPhaseRSuite;
        window.updateAllStats = updateAllStats;
        window.exportResults = exportResults;
        window.clearAllTests = clearAllTests;

        // ==========================================
        // ğŸ¯ çµ±ä¸€Intentã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ
        // ==========================================

        async function testSendIntentAPI() {
            logToArea('intentLog', 'ğŸ¯ sendIntent APIåŸºæœ¬ãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            try {
                const startTime = Date.now();
                
                // åŸºæœ¬çš„ãªIntenté€ä¿¡ãƒ†ã‚¹ãƒˆ
                const result = await voidCore.sendIntent('system.getStats');
                
                const processingTime = Date.now() - startTime;
                testStats.processingTimes.push(processingTime);
                
                logToArea('intentLog', `âœ… sendIntentæˆåŠŸ: ${JSON.stringify(result)}`);
                logToArea('intentLog', `â±ï¸ å‡¦ç†æ™‚é–“: ${processingTime}ms`);
                
                testStats.sentIntents++;
                testStats.successfulIntents++;
                testStats.totalTests++;
                testStats.successfulTests++;
                addTestResult('success', 'sendIntent APIåŸºæœ¬ãƒ†ã‚¹ãƒˆæˆåŠŸ');
                
            } catch (error) {
                testStats.sentIntents++;
                testStats.errorIntents++;
                testStats.totalTests++;
                logToArea('intentLog', `âŒ sendIntentå¤±æ•—: ${error.message}`);
                addTestResult('error', `sendIntent APIåŸºæœ¬ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`);
            }
            
            updateAllStats();
        }

        async function testSystemIntents() {
            logToArea('intentLog', 'ğŸ”§ ã‚·ã‚¹ãƒ†ãƒ Intentãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            const systemIntents = [
                {
                    intent: 'system.createPlugin',
                    data: { type: 'test.plugin', displayName: 'Test Plugin via Intent' }
                },
                {
                    intent: 'system.reparentPlugin',
                    data: { childId: 'plugin-123', newParentId: 'core-root' }
                },
                {
                    intent: 'system.destroyPlugin',
                    data: { pluginId: 'plugin-123' }
                }
            ];
            
            let successCount = 0;
            
            for (const testCase of systemIntents) {
                try {
                    const startTime = Date.now();
                    const result = await voidCore.sendIntent(testCase.intent, testCase.data);
                    const processingTime = Date.now() - startTime;
                    
                    testStats.processingTimes.push(processingTime);
                    testStats.sentIntents++;
                    testStats.successfulIntents++;
                    
                    logToArea('intentLog', `âœ… ${testCase.intent}: ${result.status} (${processingTime}ms)`);
                    successCount++;
                    
                } catch (error) {
                    testStats.sentIntents++;
                    testStats.errorIntents++;
                    logToArea('intentLog', `âŒ ${testCase.intent}: ${error.message}`);
                }
            }
            
            testStats.totalTests++;
            if (successCount === systemIntents.length) {
                testStats.successfulTests++;
                addTestResult('success', `ã‚·ã‚¹ãƒ†ãƒ Intentå…¨ãƒ†ã‚¹ãƒˆæˆåŠŸ (${successCount}/${systemIntents.length})`);
            } else {
                addTestResult('warning', `ã‚·ã‚¹ãƒ†ãƒ Intentãƒ†ã‚¹ãƒˆéƒ¨åˆ†æˆåŠŸ (${successCount}/${systemIntents.length})`);
            }
            
            updateAllStats();
        }

        async function testPluginIntents() {
            logToArea('intentLog', 'ğŸ§© ãƒ—ãƒ©ã‚°ã‚¤ãƒ³Intentãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            try {
                // ãƒ—ãƒ©ã‚°ã‚¤ãƒ³Intentã®ãƒ†ã‚¹ãƒˆ
                const pluginIntents = [
                    'plugin.getInfo',
                    'plugin.updateConfig',
                    'plugin.restart'
                ];
                
                let successCount = 0;
                
                for (const intent of pluginIntents) {
                    try {
                        const result = await voidCore.sendIntent(intent, {
                            pluginId: 'test-plugin',
                            data: { test: true }
                        });
                        
                        testStats.sentIntents++;
                        testStats.successfulIntents++;
                        
                        logToArea('intentLog', `âœ… ${intent}: ${result.status}`);
                        successCount++;
                        
                    } catch (error) {
                        testStats.sentIntents++;
                        testStats.errorIntents++;
                        logToArea('intentLog', `âŒ ${intent}: ${error.message}`);
                    }
                }
                
                testStats.totalTests++;
                testStats.successfulTests++;
                addTestResult('success', `ãƒ—ãƒ©ã‚°ã‚¤ãƒ³Intentãƒ†ã‚¹ãƒˆå®Œäº† (${successCount}/${pluginIntents.length})`);
                
            } catch (error) {
                testStats.totalTests++;
                logToArea('intentLog', `âŒ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³Intentãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`);
                addTestResult('error', `ãƒ—ãƒ©ã‚°ã‚¤ãƒ³Intentãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`);
            }
            
            updateAllStats();
        }

        async function testErrorHandling() {
            logToArea('intentLog', 'âš ï¸ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            const errorTests = [
                {
                    intent: 'system.invalidIntent',
                    data: {},
                    expectedError: 'Unknown system intent'
                },
                {
                    intent: 'plugin.nonexistentAction',
                    data: {},
                    expectedError: 'forwarded'
                }
            ];
            
            let successCount = 0;
            
            for (const test of errorTests) {
                try {
                    const result = await voidCore.sendIntent(test.intent, test.data);
                    
                    testStats.sentIntents++;
                    
                    if (result.status === test.expectedError || test.expectedError === 'forwarded') {
                        testStats.successfulIntents++;
                        logToArea('intentLog', `âœ… ${test.intent}: æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ (${result.status})`);
                        successCount++;
                    } else {
                        testStats.errorIntents++;
                        logToArea('intentLog', `âš ï¸ ${test.intent}: äºˆæœŸã›ã¬çµæœ ${result.status}`);
                    }
                    
                } catch (error) {
                    testStats.sentIntents++;
                    
                    if (error.message.includes(test.expectedError)) {
                        testStats.successfulIntents++;
                        logToArea('intentLog', `âœ… ${test.intent}: æœŸå¾…ã•ã‚Œã‚‹ã‚¨ãƒ©ãƒ¼`);
                        successCount++;
                    } else {
                        testStats.errorIntents++;
                        logToArea('intentLog', `âŒ ${test.intent}: äºˆæœŸã›ã¬ã‚¨ãƒ©ãƒ¼ - ${error.message}`);
                    }
                }
            }
            
            testStats.totalTests++;
            testStats.successfulTests++;
            addTestResult('success', `ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆå®Œäº† (${successCount}/${errorTests.length})`);
            
            updateAllStats();
        }

        // ==========================================
        // ğŸ§© IPlugin ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ
        // ==========================================

        async function testIPluginInterface() {
            logToArea('pluginLog', 'ğŸ§© IPluginåŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            try {
                // åŸºæœ¬ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ä½œæˆ
                const plugin = new IPlugin({
                    id: 'test-plugin-001',
                    type: 'test.basic',
                    displayName: 'Basic Test Plugin',
                    parent: null
                });
                
                testPlugins.push(plugin);
                testStats.createdPlugins++;
                testStats.regularPlugins++;
                
                logToArea('pluginLog', `âœ… ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ä½œæˆæˆåŠŸ: ${plugin.displayName}`);
                logToArea('pluginLog', `   ID: ${plugin.id}, Type: ${plugin.type}`);
                logToArea('pluginLog', `   isCore: ${plugin.isCore}`);
                
                // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç†ãƒ†ã‚¹ãƒˆ
                const testMessage = Message.notice('test.message', { test: 'data' });
                await plugin.handleMessage(testMessage);
                testStats.processedMessages++;
                
                logToArea('pluginLog', `âœ… ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç†æˆåŠŸ`);
                
                // ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æƒ…å ±å–å¾—ãƒ†ã‚¹ãƒˆ
                const info = await plugin.handleGetInfo(testMessage);
                logToArea('pluginLog', `âœ… ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æƒ…å ±å–å¾—: ${info.displayName}`);
                
                testStats.totalTests++;
                testStats.successfulTests++;
                addTestResult('success', 'IPluginåŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆæˆåŠŸ');
                
            } catch (error) {
                testStats.totalTests++;
                logToArea('pluginLog', `âŒ IPluginåŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`);
                addTestResult('error', `IPluginåŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`);
            }
            
            updateAllStats();
        }

        async function testICorePlugin() {
            logToArea('pluginLog', 'ğŸ”· ICorePluginæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            try {
                // ã‚³ã‚¢ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ä½œæˆ
                const corePlugin = new ICorePlugin({
                    id: 'core-test-001',
                    type: 'core.test',
                    displayName: 'Test Core Plugin',
                    parent: null
                });
                
                testPlugins.push(corePlugin);
                testStats.createdPlugins++;
                testStats.corePlugins++;
                
                logToArea('pluginLog', `âœ… ã‚³ã‚¢ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ä½œæˆæˆåŠŸ: ${corePlugin.displayName}`);
                logToArea('pluginLog', `   isCore: ${corePlugin.isCore} (å¿…ãštrue)`);
                logToArea('pluginLog', `   å­ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æ•°: ${corePlugin.getChildCount()}`);
                
                // ã‚·ã‚¹ãƒ†ãƒ Intentå‡¦ç†ãƒ†ã‚¹ãƒˆ
                const createIntent = Message.intent('system.createPlugin', {
                    type: 'test.child',
                    config: { displayName: 'Child Plugin' }
                });
                
                const newPlugin = await corePlugin.handleCreatePlugin(createIntent);
                logToArea('pluginLog', `âœ… ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ç”ŸæˆæˆåŠŸ: ${newPlugin.displayName}`);
                
                // æˆ¸ç±ç•°å‹•å±Šãƒ†ã‚¹ãƒˆ
                const reparentIntent = Message.intent('system.reparentPlugin', {
                    childId: newPlugin.id,
                    newParentId: 'core-test-002'
                });
                
                await corePlugin.handleReparentPlugin(reparentIntent);
                logToArea('pluginLog', `âœ… æˆ¸ç±ç•°å‹•å±Šå‡¦ç†æˆåŠŸ`);
                
                testStats.totalTests++;
                testStats.successfulTests++;
                addTestResult('success', 'ICorePluginæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆæˆåŠŸ');
                
            } catch (error) {
                testStats.totalTests++;
                logToArea('pluginLog', `âŒ ICorePluginæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`);
                addTestResult('error', `ICorePluginæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`);
            }
            
            updateAllStats();
        }

        async function testPluginTypeGuards() {
            logToArea('pluginLog', 'ğŸ” å‹åˆ¤å®šæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            try {
                // å‹åˆ¤å®šãƒ†ã‚¹ãƒˆ
                const regularPlugin = createPlugin({
                    type: 'test.regular',
                    isCore: false
                });
                
                const corePlugin = createPlugin({
                    type: 'test.core',
                    isCore: true
                });
                
                testStats.createdPlugins += 2;
                testStats.regularPlugins++;
                testStats.corePlugins++;
                
                // å‹åˆ¤å®šç¢ºèª
                const regularIsCore = isCorePlugin(regularPlugin);
                const coreIsCore = isCorePlugin(corePlugin);
                
                logToArea('pluginLog', `âœ… ä¸€èˆ¬ãƒ—ãƒ©ã‚°ã‚¤ãƒ³åˆ¤å®š: ${!regularIsCore ? 'æ­£å¸¸' : 'ã‚¨ãƒ©ãƒ¼'}`);
                logToArea('pluginLog', `âœ… ã‚³ã‚¢ãƒ—ãƒ©ã‚°ã‚¤ãƒ³åˆ¤å®š: ${coreIsCore ? 'æ­£å¸¸' : 'ã‚¨ãƒ©ãƒ¼'}`);
                
                // ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼ãƒ†ã‚¹ãƒˆ
                logToArea('pluginLog', `âœ… ä¸€èˆ¬ãƒ—ãƒ©ã‚°ã‚¤ãƒ³: ${regularPlugin.constructor.name}`);
                logToArea('pluginLog', `âœ… ã‚³ã‚¢ãƒ—ãƒ©ã‚°ã‚¤ãƒ³: ${corePlugin.constructor.name}`);
                
                testStats.totalTests++;
                testStats.successfulTests++;
                addTestResult('success', 'å‹åˆ¤å®šæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆæˆåŠŸ');
                
            } catch (error) {
                testStats.totalTests++;
                logToArea('pluginLog', `âŒ å‹åˆ¤å®šæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`);
                addTestResult('error', `å‹åˆ¤å®šæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`);
            }
            
            updateAllStats();
        }

        async function testPluginCreation() {
            logToArea('pluginLog', 'ğŸ¨ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ä½œæˆãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            try {
                // å„ç¨®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ä½œæˆ
                const pluginTypes = [
                    { type: 'ui.editor', isCore: false },
                    { type: 'core.stage', isCore: true },
                    { type: 'data.processor', isCore: false },
                    { type: 'core.router', isCore: true }
                ];
                
                let createdCount = 0;
                
                for (const config of pluginTypes) {
                    const plugin = createPlugin({
                        ...config,
                        displayName: `Test ${config.type}`,
                        metadata: { createdInTest: true }
                    });
                    
                    testPlugins.push(plugin);
                    testStats.createdPlugins++;
                    
                    if (plugin.isCore) {
                        testStats.corePlugins++;
                    } else {
                        testStats.regularPlugins++;
                    }
                    
                    logToArea('pluginLog', `âœ… ${config.type}: ${plugin.constructor.name} (isCore: ${plugin.isCore})`);
                    createdCount++;
                }
                
                logToArea('pluginLog', `ğŸ“Š ä½œæˆå®Œäº†: ${createdCount}å€‹ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³`);
                
                testStats.totalTests++;
                testStats.successfulTests++;
                addTestResult('success', `ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ä½œæˆãƒ†ã‚¹ãƒˆæˆåŠŸ (${createdCount}å€‹)`);
                
            } catch (error) {
                testStats.totalTests++;
                logToArea('pluginLog', `âŒ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ä½œæˆãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`);
                addTestResult('error', `ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ä½œæˆãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`);
            }
            
            updateAllStats();
        }

        // ==========================================
        // ğŸ”„ Before/Afteræ¯”è¼ƒãƒ†ã‚¹ãƒˆ
        // ==========================================

        async function testOldVsNewAPI() {
            logToArea('comparisonLog', 'ğŸ”„ æ—§API vs æ–°APIæ¯”è¼ƒãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            try {
                // æ–°æ–¹å¼ï¼ˆIntentçµ±ä¸€ï¼‰ã®ãƒ†ã‚¹ãƒˆ
                const newWayResults = [];
                
                const startTimeNew = Date.now();
                const result1 = await voidCore.sendIntent('system.createPlugin', {
                    type: 'comparison.test',
                    displayName: 'New Way Plugin'
                });
                newWayResults.push(result1);
                
                const result2 = await voidCore.sendIntent('system.getStats');
                newWayResults.push(result2);
                
                const newWayTime = Date.now() - startTimeNew;
                
                logToArea('comparisonLog', `âœ… æ–°æ–¹å¼ï¼ˆIntentçµ±ä¸€ï¼‰: ${newWayTime}ms`);
                logToArea('comparisonLog', `   - ã™ã¹ã¦ã®æ“ä½œãŒsendIntent()ã§çµ±ä¸€`);
                logToArea('comparisonLog', `   - ä¸€è²«ã—ãŸã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°`);
                logToArea('comparisonLog', `   - å› æœé–¢ä¿‚è¿½è·¡å¯¾å¿œ`);
                
                testStats.totalTests++;
                testStats.successfulTests++;
                addTestResult('success', 'æ–°APIæ–¹å¼ãƒ†ã‚¹ãƒˆæˆåŠŸ');
                
            } catch (error) {
                testStats.totalTests++;
                logToArea('comparisonLog', `âŒ APIæ¯”è¼ƒãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`);
                addTestResult('error', `APIæ¯”è¼ƒãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`);
            }
            
            updateAllStats();
        }

        async function testMigrationPath() {
            logToArea('comparisonLog', 'ğŸ›¤ï¸ ç§»è¡Œãƒ‘ã‚¹ãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            try {
                // ç§»è¡Œã®å„æ®µéšã‚’ãƒ†ã‚¹ãƒˆ
                const migrationSteps = [
                    { name: '1. æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ å‹•ä½œç¢ºèª', action: () => voidCore.getStats() },
                    { name: '2. Intent APIè¿½åŠ ', action: () => voidCore.sendIntent('system.getStats') },
                    { name: '3. ä¸¦è¡Œé‹ç”¨', action: async () => {
                        const oldResult = voidCore.getStats();
                        const newResult = await voidCore.sendIntent('system.getStats');
                        return { old: oldResult, new: newResult };
                    }},
                    { name: '4. Intentç§»è¡Œå®Œäº†', action: () => voidCore.sendIntent('system.createPlugin', { type: 'migrated.plugin' }) }
                ];
                
                let completedSteps = 0;
                
                for (const step of migrationSteps) {
                    try {
                        const result = await step.action();
                        logToArea('comparisonLog', `âœ… ${step.name}: æˆåŠŸ`);
                        completedSteps++;
                    } catch (error) {
                        logToArea('comparisonLog', `âš ï¸ ${step.name}: ${error.message}`);
                    }
                }
                
                logToArea('comparisonLog', `ğŸ“Š ç§»è¡Œãƒ†ã‚¹ãƒˆå®Œäº†: ${completedSteps}/${migrationSteps.length} ã‚¹ãƒ†ãƒƒãƒ—æˆåŠŸ`);
                
                testStats.totalTests++;
                testStats.successfulTests++;
                addTestResult('success', `ç§»è¡Œãƒ‘ã‚¹ãƒ†ã‚¹ãƒˆæˆåŠŸ (${completedSteps}/${migrationSteps.length})`);
                
            } catch (error) {
                testStats.totalTests++;
                logToArea('comparisonLog', `âŒ ç§»è¡Œãƒ‘ã‚¹ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`);
                addTestResult('error', `ç§»è¡Œãƒ‘ã‚¹ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`);
            }
            
            updateAllStats();
        }

        async function testBackwardCompatibility() {
            logToArea('comparisonLog', 'ğŸ›ï¸ ä¸‹ä½äº’æ›æ€§ç¢ºèªãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            try {
                // æ—¢å­˜APIãŒå¼•ãç¶šãå‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª
                const compatibilityTests = [
                    { name: 'getStats()', test: () => voidCore.getStats() },
                    { name: 'subscribe()', test: () => voidCore.subscribe('test', () => {}) },
                    { name: 'publish()', test: () => voidCore.publish(Message.notice('test', {})) }
                ];
                
                let passedTests = 0;
                
                for (const test of compatibilityTests) {
                    try {
                        await test.test();
                        logToArea('comparisonLog', `âœ… ${test.name}: äº’æ›æ€§OK`);
                        passedTests++;
                    } catch (error) {
                        logToArea('comparisonLog', `âŒ ${test.name}: äº’æ›æ€§å•é¡Œ - ${error.message}`);
                    }
                }
                
                const compatibilityRate = (passedTests / compatibilityTests.length) * 100;
                logToArea('comparisonLog', `ğŸ“Š ä¸‹ä½äº’æ›æ€§: ${compatibilityRate}%`);
                
                testStats.totalTests++;
                testStats.successfulTests++;
                addTestResult('success', `ä¸‹ä½äº’æ›æ€§ç¢ºèªæˆåŠŸ (${compatibilityRate}%)`);
                
            } catch (error) {
                testStats.totalTests++;
                logToArea('comparisonLog', `âŒ ä¸‹ä½äº’æ›æ€§ç¢ºèªå¤±æ•—: ${error.message}`);
                addTestResult('error', `ä¸‹ä½äº’æ›æ€§ç¢ºèªå¤±æ•—: ${error.message}`);
            }
            
            updateAllStats();
        }

        // ==========================================
        // ğŸ› ï¸ ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
        // ==========================================

        function logToArea(areaId, message) {
            const area = document.getElementById(areaId);
            const timestamp = new Date().toLocaleTimeString();
            area.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            area.scrollTop = area.scrollHeight;
        }

        function addTestResult(type, message) {
            const resultsArea = document.getElementById('testResults');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${type}`;
            resultDiv.textContent = message;
            resultsArea.appendChild(resultDiv);
        }

        function updateAllStats() {
            // Intentçµ±è¨ˆ
            document.getElementById('sentIntents').textContent = testStats.sentIntents;
            document.getElementById('successfulIntents').textContent = testStats.successfulIntents;
            document.getElementById('errorIntents').textContent = testStats.errorIntents;
            
            const avgTime = testStats.processingTimes.length > 0 ? 
                (testStats.processingTimes.reduce((a, b) => a + b, 0) / testStats.processingTimes.length).toFixed(1) : 0;
            document.getElementById('avgProcessTime').textContent = avgTime + 'ms';
            
            // ãƒ—ãƒ©ã‚°ã‚¤ãƒ³çµ±è¨ˆ
            document.getElementById('createdPlugins').textContent = testStats.createdPlugins;
            document.getElementById('corePlugins').textContent = testStats.corePlugins;
            document.getElementById('regularPlugins').textContent = testStats.regularPlugins;
            document.getElementById('processedMessages').textContent = testStats.processedMessages;
            
            // ç·åˆçµ±è¨ˆ
            document.getElementById('totalTests').textContent = testStats.totalTests;
            document.getElementById('successfulTests').textContent = testStats.successfulTests;
            
            const successRate = testStats.totalTests > 0 ? (testStats.successfulTests / testStats.totalTests) * 100 : 0;
            document.getElementById('refactoringProgress').textContent = Math.round(successRate) + '%';
            
            const intentRate = testStats.sentIntents > 0 ? (testStats.successfulIntents / testStats.sentIntents) * 100 : 0;
            document.getElementById('intentUnificationRate').textContent = Math.round(intentRate) + '%';
        }

        async function runFullPhaseRSuite() {
            addTestResult('info', 'ğŸš€ Phase R å…¨ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆé–‹å§‹');
            
            // é †æ¬¡å®Ÿè¡Œ
            await testSendIntentAPI();
            await new Promise(resolve => setTimeout(resolve, 200));
            
            await testSystemIntents();
            await new Promise(resolve => setTimeout(resolve, 200));
            
            await testPluginIntents();
            await new Promise(resolve => setTimeout(resolve, 200));
            
            await testErrorHandling();
            await new Promise(resolve => setTimeout(resolve, 300));
            
            await testIPluginInterface();
            await new Promise(resolve => setTimeout(resolve, 200));
            
            await testICorePlugin();
            await new Promise(resolve => setTimeout(resolve, 200));
            
            await testPluginTypeGuards();
            await new Promise(resolve => setTimeout(resolve, 200));
            
            await testPluginCreation();
            await new Promise(resolve => setTimeout(resolve, 300));
            
            await testOldVsNewAPI();
            await new Promise(resolve => setTimeout(resolve, 200));
            
            await testMigrationPath();
            await new Promise(resolve => setTimeout(resolve, 200));
            
            await testBackwardCompatibility();
            await new Promise(resolve => setTimeout(resolve, 300));
            
            addTestResult('success', 'ğŸ‰ Phase R å…¨ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆå®Œäº†');
            updateAllStats();
        }

        function clearAllTests() {
            document.getElementById('intentLog').innerHTML = '';
            document.getElementById('pluginLog').innerHTML = '';
            document.getElementById('comparisonLog').innerHTML = '';
            document.getElementById('testResults').innerHTML = '';
            
            testStats = {
                totalTests: 0,
                successfulTests: 0,
                sentIntents: 0,
                successfulIntents: 0,
                errorIntents: 0,
                createdPlugins: 0,
                corePlugins: 0,
                regularPlugins: 0,
                processedMessages: 0,
                processingTimes: []
            };
            
            testPlugins = [];
            
            updateAllStats();
            addTestResult('info', 'ğŸ§¹ å…¨ãƒ†ã‚¹ãƒˆã‚¯ãƒªã‚¢å®Œäº†');
        }

        function exportResults() {
            const results = {
                phase: 'Phase R: VoidCoreã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°',
                timestamp: new Date().toISOString(),
                testStats: testStats,
                pluginStats: {
                    totalPlugins: testPlugins.length,
                    pluginTypes: testPlugins.map(p => ({ id: p.id, type: p.type, isCore: p.isCore }))
                },
                intentUnificationStatus: {
                    successRate: testStats.totalTests > 0 ? (testStats.successfulTests / testStats.totalTests) * 100 : 0,
                    intentSuccessRate: testStats.sentIntents > 0 ? (testStats.successfulIntents / testStats.sentIntents) * 100 : 0,
                    avgProcessingTime: testStats.processingTimes.length > 0 ? 
                        testStats.processingTimes.reduce((a, b) => a + b, 0) / testStats.processingTimes.length : 0
                }
            };
            
            const blob = new Blob([JSON.stringify(results, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `phase-r-refactoring-results-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            addTestResult('success', 'ğŸ“„ Phase R ãƒ†ã‚¹ãƒˆçµæœã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå®Œäº†');
        }

        // åˆæœŸåŒ–
        updateAllStats();
        logToArea('intentLog', 'ğŸ”§ Phase R: VoidCore ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚° ãƒ†ã‚¹ãƒˆç’°å¢ƒæº–å‚™å®Œäº†');
        logToArea('pluginLog', 'ğŸ§© IPlugin ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ ãƒ†ã‚¹ãƒˆæº–å‚™å®Œäº†');
        logToArea('comparisonLog', 'ğŸ”„ Before/Afteræ¯”è¼ƒãƒ†ã‚¹ãƒˆæº–å‚™å®Œäº†');
        
        addTestResult('info', 'ğŸš€ Phase R ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚° ãƒ†ã‚¹ãƒˆç’°å¢ƒæº–å‚™å®Œäº†');
    </script>
</body>
</html>