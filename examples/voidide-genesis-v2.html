<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåü VoidIDE Genesis v2.0 - Complete Self-Creating IDE</title>
    
    <!-- Monaco Editor CDN -->
    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.44.0/min/vs/loader.js"></script>
    
    <!-- JSZip Library (AMDÁ´∂ÂêàÂõûÈÅø„ÅÆ„Åü„ÇÅ‰∫ãÂâçË™≠„ÅøËæº„Åø) -->
    <script>
        // AMDÁ´∂Âêà„Çí‰∏ÄÊôÇÁöÑ„Å´ÂõûÈÅø
        const originalDefine = window.define;
        window.define = undefined;
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script>
        // define„ÇíÂæ©ÂÖÉ
        window.define = originalDefine;
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #1e1e1e;
            color: #d4d4d4;
            height: 100vh;
            overflow: hidden;
        }

        .ide-container {
            display: grid;
            grid-template-columns: 250px 1fr 300px;
            grid-template-rows: 40px 1fr 250px;
            height: 100vh;
            gap: 1px;
            background: #3e3e42;
        }

        .title-bar {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            align-items: center;
            padding: 0 15px;
            font-weight: bold;
            font-size: 14px;
        }

        .title-bar .version {
            margin-left: auto;
            font-size: 12px;
            opacity: 0.8;
        }

        .sidebar {
            background: #252526;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .main-editor {
            background: #1e1e1e;
            display: flex;
            flex-direction: column;
        }

        .right-panel {
            background: #252526;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .bottom-panel {
            grid-column: 1 / -1;
            background: #1e1e1e;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 1px;
            background: #3e3e42;
        }

        .toolbar {
            height: 40px;
            background: #2d2d30;
            border-bottom: 1px solid #3e3e42;
            display: flex;
            align-items: center;
            padding: 0 15px;
            gap: 10px;
        }

        .toolbar button {
            background: #0e639c;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .toolbar button:hover {
            background: #1177bb;
            transform: translateY(-1px);
        }

        .toolbar button:disabled {
            background: #5a5a5a;
            cursor: not-allowed;
            transform: none;
        }

        .toolbar .status {
            margin-left: auto;
            font-size: 12px;
            color: #cccccc;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #888;
        }

        .status-indicator.running {
            background: #73c991;
            animation: pulse 1s infinite;
        }

        .status-indicator.error {
            background: #f48771;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .editor-container {
            flex: 1;
            position: relative;
        }

        .monaco-editor-container {
            width: 100%;
            height: 100%;
        }

        .panel {
            background: #252526;
            overflow-y: auto;
            padding: 15px;
        }

        .panel h3 {
            margin: 0 0 15px 0;
            font-size: 14px;
            color: #cccccc;
            border-bottom: 1px solid #3e3e42;
            padding-bottom: 8px;
        }

        .file-tree {
            list-style: none;
        }

        .file-item {
            padding: 4px 8px;
            cursor: pointer;
            border-radius: 3px;
            font-size: 13px;
            transition: background 0.2s;
        }

        .file-item:hover {
            background: #2a2d2e;
        }

        .file-item.active {
            background: #094771;
            color: #4fc1ff;
        }

        .plugin-list {
            list-style: none;
        }

        .plugin-item {
            background: #2d2d30;
            margin: 5px 0;
            padding: 10px;
            border-radius: 4px;
            font-size: 12px;
            border-left: 3px solid #4fc1ff;
        }

        .plugin-item.error {
            border-left-color: #f48771;
        }

        .plugin-item.warning {
            border-left-color: #dcdcaa;
        }

        .plugin-name {
            font-weight: bold;
            color: #4fc1ff;
            margin-bottom: 4px;
        }

        .plugin-status {
            color: #cccccc;
            font-size: 11px;
        }

        .tab-container {
            display: flex;
            background: #2d2d30;
            border-bottom: 1px solid #3e3e42;
        }

        .tab {
            padding: 8px 16px;
            cursor: pointer;
            border-right: 1px solid #3e3e42;
            font-size: 12px;
            color: #cccccc;
            transition: all 0.2s;
        }

        .tab:hover {
            background: #3e3e42;
        }

        .tab.active {
            background: #094771;
            color: #4fc1ff;
        }

        .tab-content {
            flex: 1;
            overflow: hidden;
        }

        .visualization-container {
            height: 100%;
            position: relative;
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100px;
            color: #888;
            font-size: 14px;
        }

        .welcome-panel {
            padding: 20px;
            text-align: center;
            background: linear-gradient(135deg, #0e639c, #1177bb);
            color: white;
            margin: 15px;
            border-radius: 8px;
        }

        .welcome-panel h2 {
            margin: 0 0 10px 0;
            font-size: 18px;
        }

        .welcome-panel p {
            margin: 0;
            opacity: 0.9;
            font-size: 13px;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin: 15px;
        }

        .quick-action {
            background: #2d2d30;
            border: 1px solid #3e3e42;
            color: #cccccc;
            padding: 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
            text-align: center;
        }

        .quick-action:hover {
            background: #3e3e42;
            border-color: #4fc1ff;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px;
        }

        .stat-card {
            background: #2d2d30;
            padding: 12px;
            border-radius: 4px;
            text-align: center;
        }

        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: #4fc1ff;
        }

        .stat-label {
            font-size: 11px;
            color: #cccccc;
            text-transform: uppercase;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #2d2d30;
            color: #cccccc;
            padding: 12px 16px;
            border-radius: 6px;
            border-left: 3px solid #4fc1ff;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1000;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
        }

        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }

        .notification.error {
            border-left-color: #f48771;
        }

        .notification.success {
            border-left-color: #73c991;
        }

        .scrollbar-thin {
            scrollbar-width: thin;
            scrollbar-color: #3e3e42 #252526;
        }

        .scrollbar-thin::-webkit-scrollbar {
            width: 6px;
        }

        .scrollbar-thin::-webkit-scrollbar-track {
            background: #252526;
        }

        .scrollbar-thin::-webkit-scrollbar-thumb {
            background: #3e3e42;
            border-radius: 3px;
        }

        .scrollbar-thin::-webkit-scrollbar-thumb:hover {
            background: #4e4e52;
        }
    </style>
</head>
<body>
    <div class="ide-container">
        <!-- „Çø„Ç§„Éà„É´„Éê„Éº -->
        <div class="title-bar">
            üåü VoidIDE Genesis v2.0 - Self-Creating IDE with Advanced Analytics
            <div class="version">Phase 2 Complete | Build 2025.07.06</div>
        </div>

        <!-- Â∑¶„Çµ„Ç§„Éâ„Éê„Éº -->
        <div class="sidebar scrollbar-thin">
            <div class="welcome-panel">
                <h2>üß† Genesis v2.0</h2>
                <p>Ëá™Â∑±ÂâµÈÄ†„Ç∑„Çπ„ÉÜ„É† + È´òÂ∫¶Ëß£Êûê</p>
            </div>

            <div class="panel">
                <h3>üìÅ Project Explorer</h3>
                <ul class="file-tree">
                    <li class="file-item active" data-file="main.js" onclick="selectFile('main.js')">
                        üìÑ main.js
                    </li>
                    <li class="file-item" data-file="template" onclick="selectFile('template')">
                        üìã Plugin Template
                    </li>
                    <li class="file-item" data-file="advanced" onclick="selectFile('advanced')">
                        üöÄ Advanced Template
                    </li>
                </ul>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="pluginCount">0</div>
                    <div class="stat-label">Plugins</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="messageCount">0</div>
                    <div class="stat-label">Messages</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="uptime">0s</div>
                    <div class="stat-label">Uptime</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="performance">100%</div>
                    <div class="stat-label">Performance</div>
                </div>
            </div>

            <div class="quick-actions">
                <button class="quick-action" onclick="loadBasicTemplate()">
                    üìã Basic Template
                </button>
                <button class="quick-action" onclick="loadAdvancedTemplate()">
                    üöÄ Advanced Template
                </button>
                <button class="quick-action" onclick="showCodeHelper()">
                    üí° Code Helper
                </button>
                <button class="quick-action" onclick="openSettings()">
                    ‚öôÔ∏è Settings
                </button>
            </div>
        </div>

        <!-- „É°„Ç§„É≥„Ç®„Éá„Ç£„Çø -->
        <div class="main-editor">
            <div class="toolbar">
                <button id="runButton" onclick="executeCode()">
                    ‚ñ∂Ô∏è Run (Ctrl+Enter)
                </button>
                <button id="stopButton" onclick="stopExecution()" disabled>
                    ‚èπÔ∏è Stop
                </button>
                <button onclick="saveCode()" title="Save project to localStorage (use Projects‚ÜíExport ZIP for file)">
                    üíæ Save
                </button>
                <button onclick="loadProject()" title="Load project from ZIP file">
                    üìÇ Load
                </button>
                <button onclick="formatCode()">
                    üé® Format
                </button>
                <button onclick="toggleAnalytics()">
                    üìä Analytics
                </button>
                <div class="status">
                    <span class="status-indicator" id="statusIndicator"></span>
                    <span id="statusText">Ready</span>
                </div>
            </div>
            <div class="editor-container">
                <div id="monaco-editor" class="monaco-editor-container"></div>
            </div>
        </div>

        <!-- Âè≥„Éë„Éç„É´ -->
        <div class="right-panel scrollbar-thin">
            <div class="tab-container">
                <div class="tab active" data-tab="plugins">üîß Plugins</div>
                <div class="tab" data-tab="analytics">üìä Analytics</div>
                <div class="tab" data-tab="projects">üóÇÔ∏è Projects</div>
            </div>
            
            <div class="tab-content">
                <div id="pluginsTab" class="panel">
                    <h3>üîß Active Plugins</h3>
                    <ul class="plugin-list" id="pluginsList">
                        <li class="plugin-item">
                            <div class="plugin-name">VoidIDE Genesis</div>
                            <div class="plugin-status">‚úÖ System Plugin - Always Active</div>
                        </li>
                    </ul>
                </div>
                
                <div id="analyticsTab" class="panel" style="display: none;">
                    <h3>üìä Real-time Analytics</h3>
                    <div id="analyticsContent">
                        <div class="loading">Loading analytics...</div>
                    </div>
                </div>
                
                <div id="projectsTab" class="panel" style="display: none;">
                    <h3>üóÇÔ∏è Project Manager</h3>
                    <div id="projectManagerContainer" class="visualization-container">
                        <div class="loading">Loading project manager...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- „Éú„Éà„É†„Éë„Éç„É´ -->
        <div class="bottom-panel">
            <!-- Âá∫Âäõ„Éª„É≠„Ç∞ -->
            <div class="panel">
                <h3>üìù Output & Logs</h3>
                <div id="output" class="scrollbar-thin" style="height: 180px; overflow-y: auto; font-family: monospace; font-size: 12px; line-height: 1.4;"></div>
            </div>
            
            <!-- „É°„ÉÉ„Çª„Éº„Ç∏„Éï„É≠„ÉºÂèØË¶ñÂåñ -->
            <div class="panel">
                <h3>üåä Message Flow</h3>
                <div id="messageVisualization" class="visualization-container">
                    <div class="loading">Initializing visualization...</div>
                </div>
            </div>
            
            <!-- „Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÁõ£Ë¶ñ -->
            <div class="panel">
                <h3>‚ö° Performance Monitor</h3>
                <div id="performanceMonitor" class="visualization-container">
                    <div class="loading">Starting performance monitoring...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ÈÄöÁü•„Ç∑„Çπ„ÉÜ„É† -->
    <div id="notification" class="notification"></div>

    <script type="module">
        import { voidCore, createPlugin, Message } from '../src/index.js';
        import { MessageFlowVisualizer } from '../src/message-flow-visualizer.js';
        import { PluginMonitorDashboard } from '../src/plugin-monitor-dashboard.js';
        import { PerformanceMetricsSystem } from '../src/performance-metrics-system.js';
        import { ProjectManager } from '../src/project-manager.js';

        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        let monacoEditor = null;
        let voidIDEPlugin = null;
        let messageVisualizer = null;
        let pluginMonitor = null;
        let performanceMonitor = null;
        let projectManager = null;
        let startTime = Date.now();
        let executionCount = 0;
        let pluginCount = 0;
        let messageCount = 0;
        let isExecuting = false;
        let currentExecutionAbortController = null;
        let runningPlugins = new Map(); // ÂÆüË°å‰∏≠„ÅÆ„Éó„É©„Ç∞„Ç§„É≥„ÇíËøΩË∑°

        // Monaco Editor„ÅÆÂàùÊúüÂåñ
        require.config({ paths: { vs: 'https://cdn.jsdelivr.net/npm/monaco-editor@0.44.0/min/vs' }});
        
        require(['vs/editor/editor.main'], function() {
            initializeVoidIDE();
        });

        async function initializeVoidIDE() {
            try {
                showNotification('üöÄ Initializing VoidIDE Genesis v2.0...', 'info');

                // VoidIDE„Éó„É©„Ç∞„Ç§„É≥„Çí‰ΩúÊàê
                voidIDEPlugin = createPlugin({
                    pluginId: 'void-ide-genesis-v2',
                    name: 'VoidIDE Genesis v2.0',
                    version: '2.0.0',
                    capabilities: ['code-editor', 'plugin-builder', 'runtime-eval', 'analytics', 'visualization']
                }, {
                    async run() {
                        await this.initialize();
                        this.log('üåü VoidIDE Genesis v2.0 initialized!');

                        // È´òÂ∫¶„Å™„É°„ÉÉ„Çª„Éº„Ç∏Áõ£Ë¶ñ
                        this.on('Notice', '*', (message) => {
                            messageCount++;
                            updateStats();
                        });

                        this.on('Notice', 'plugin.created', (message) => {
                            updatePluginsList();
                            showNotification(`üîß Plugin created: ${message.payload.pluginId}`, 'success');
                        });
                    }
                });

                // VoidCore„Å´ÁôªÈå≤„Åó„Å¶ÂÆüË°å
                voidCore.registerPlugin(voidIDEPlugin);
                await voidIDEPlugin.run();

                // Monaco Editor„ÇíÂàùÊúüÂåñ
                await initializeMonacoEditor();

                // È´òÂ∫¶„Å™ÂèØË¶ñÂåñ„Ç∑„Çπ„ÉÜ„É†„ÇíÂàùÊúüÂåñ
                await initializeVisualizationSystems();

                // UI „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆö
                setupUIEventListeners();

                showNotification('‚úÖ VoidIDE Genesis v2.0 ready!', 'success');
                updateStatus('Ready', 'idle');

                // Áµ±Ë®àÊõ¥Êñ∞ÈñãÂßã
                setInterval(updateStats, 1000);

            } catch (error) {
                log(`‚ùå Initialization error: ${error.message}`, 'error');
                showNotification(`Initialization failed: ${error.message}`, 'error');
            }
        }

        async function initializeMonacoEditor() {
            monacoEditor = monaco.editor.create(document.getElementById('monaco-editor'), {
                value: getAdvancedTemplate(),
                language: 'javascript',
                theme: 'vs-dark',
                fontSize: 14,
                automaticLayout: true,
                minimap: { enabled: true },
                wordWrap: 'on',
                bracketPairColorization: { enabled: true },
                guides: { bracketPairs: true, indentation: true }
            });
            
            // „Ç∞„É≠„Éº„Éê„É´„Ç¢„ÇØ„Çª„ÇπÁî®„Å´ window „Å´‰ª£ÂÖ•
            window.monacoEditor = monacoEditor;
            console.log('üé® Monaco Editor assigned to window.monacoEditor');

            // È´òÂ∫¶„Å™„Ç≥„Éº„ÉâË£úÂÆåË®≠ÂÆö
            setupAdvancedCodeCompletion();

            // „Ç®„Éá„Ç£„Çø„Ç§„Éô„É≥„Éà
            monacoEditor.onDidChangeModelContent(() => {
                updateStatus('Modified', 'idle');
            });

            // „Ç≠„Éº„Éú„Éº„Éâ„Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„Éà
            monacoEditor.addCommand(monaco.KeyMod.CtrlCmd | monaco.KeyCode.Enter, () => {
                executeCode();
            });

            monacoEditor.addCommand(monaco.KeyMod.CtrlCmd | monaco.KeyCode.KEY_S, () => {
                saveCode();
            });
        }

        async function initializeVisualizationSystems() {
            try {
                // „É°„ÉÉ„Çª„Éº„Ç∏„Éï„É≠„ÉºÂèØË¶ñÂåñ
                messageVisualizer = new MessageFlowVisualizer(
                    document.getElementById('messageVisualization'),
                    voidCore
                );
                await messageVisualizer.initialize();
                messageVisualizer.start();

                // „Éó„É©„Ç∞„Ç§„É≥Áõ£Ë¶ñ„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ
                pluginMonitor = new PluginMonitorDashboard(
                    document.getElementById('analyticsContent'),
                    voidCore
                );
                await pluginMonitor.initialize();

                // „Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÁõ£Ë¶ñ„Ç∑„Çπ„ÉÜ„É†
                performanceMonitor = new PerformanceMetricsSystem(voidCore);
                await performanceMonitor.initialize(document.getElementById('performanceMonitor'));

                // „Éó„É≠„Ç∏„Çß„ÇØ„ÉàÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†
                projectManager = new ProjectManager(voidCore);
                console.log('üîß Initializing ProjectManager...');
                const projectManagerInit = await projectManager.initialize(document.getElementById('projectManagerContainer'));
                console.log('üîß ProjectManager initialized:', projectManagerInit);
                console.log('üîß ProjectManager currentProject:', projectManager.currentProject);
                
                // ÂàùÊúüÂåñ„ÅåÂ§±Êïó„Åó„ÅüÂ†¥Âêà„ÄÅÊâãÂãï„Åß currentProject „ÇíË®≠ÂÆö
                if (!projectManager.currentProject) {
                    console.log('‚ö†Ô∏è Manual currentProject initialization...');
                    projectManager.currentProject = { ...projectManager.defaultProject };
                    console.log('üîß Manual currentProject set:', projectManager.currentProject);
                }

                log('üé® Advanced visualization systems initialized', 'success');

            } catch (error) {
                log(`‚ùå Visualization initialization error: ${error.message}`, 'error');
            }
        }

        function setupAdvancedCodeCompletion() {
            monaco.languages.registerCompletionItemProvider('javascript', {
                provideCompletionItems: (model, position) => {
                    const word = model.getWordUntilPosition(position);
                    const range = {
                        startLineNumber: position.lineNumber,
                        endLineNumber: position.lineNumber,
                        startColumn: word.startColumn,
                        endColumn: word.endColumn
                    };
                    
                    const suggestions = [
                        {
                            label: 'voidcore-analytics-plugin',
                            kind: monaco.languages.CompletionItemKind.Snippet,
                            insertText: getAnalyticsPluginTemplate(),
                            documentation: 'Advanced analytics plugin template',
                            range: range
                        },
                        {
                            label: 'voidcore-visualizer-plugin',
                            kind: monaco.languages.CompletionItemKind.Snippet,
                            insertText: getVisualizerPluginTemplate(),
                            documentation: 'Visualization plugin template',
                            range: range
                        },
                        {
                            label: 'voidcore-monitor-plugin',
                            kind: monaco.languages.CompletionItemKind.Snippet,
                            insertText: getMonitorPluginTemplate(),
                            documentation: 'Monitoring plugin template',
                            range: range
                        }
                    ];
                    
                    return { suggestions };
                }
            });
        }

        async function executeCode() {
            const runButton = document.getElementById('runButton');
            const stopButton = document.getElementById('stopButton');
            let skipStopButtonUpdate = false;
            
            if (isExecuting) {
                showNotification('Code is already executing...', 'warning');
                return;
            }
            
            // ÈÄ£ÊâìÈò≤Ê≠¢„ÅÆ„Åü„ÇÅ„ÄÅÁü≠ÊôÇÈñì„Å†„ÅëRun„Éú„Çø„É≥„ÇíÁÑ°Âäπ„Å´
            runButton.disabled = true;
            setTimeout(() => {
                runButton.disabled = false;
            }, 1000); // 1ÁßíÂæå„Å´ÂÜçÊúâÂäπÂåñ
            
            try {
                isExecuting = true;
                updateStatus('Executing...', 'running');
                
                // AbortController for cancellation
                currentExecutionAbortController = new AbortController();
                
                const code = monacoEditor.getValue();
                log('üöÄ Executing advanced code...', 'info');
                
                const result = await safeExecuteCode(code, currentExecutionAbortController.signal);
                
                if (result.success) {
                    log('‚úÖ Code executed successfully!', 'success');
                    
                    if (result.plugin) {
                        pluginCount++;
                        
                        // Âêå„ÅòID„ÅÆ„Éó„É©„Ç∞„Ç§„É≥„ÅåË§áÊï∞ÂÆüË°å„Åï„Çå„ÇãÂ†¥Âêà„ÄÅ„É¶„Éã„Éº„ÇØID„Çí‰ΩúÊàê
                        let uniquePluginId = result.plugin.pluginId;
                        let counter = 1;
                        while (runningPlugins.has(uniquePluginId)) {
                            uniquePluginId = `${result.plugin.pluginId}-${counter}`;
                            counter++;
                        }
                        
                        // „É¶„Éã„Éº„ÇØID„ÇíË®≠ÂÆö
                        result.plugin.uniqueId = uniquePluginId;
                        
                        // ÂÆüË°å‰∏≠„Éó„É©„Ç∞„Ç§„É≥„Å®„Åó„Å¶ËøΩË∑°
                        runningPlugins.set(uniquePluginId, result.plugin);
                        log(`üîß Plugin created: ${result.plugin.pluginId} (unique: ${uniquePluginId})`, 'success');
                        updatePluginsList();
                        showNotification(`Plugin ${result.plugin.pluginId} created successfully!`, 'success');
                        
                        // „Éó„É©„Ç∞„Ç§„É≥„ÅåÂÆüË°åÈñãÂßã„Åï„Çå„ÇãÊôÇ„Å´Stop„Éú„Çø„É≥„ÇíÊúâÂäπ„Å´
                        updateStatus('Plugin Running', 'running');
                        stopButton.disabled = false;
                        
                        // „Éó„É©„Ç∞„Ç§„É≥„ÅåÂÆüË°å‰∏≠„ÅÆÂ†¥Âêà„ÄÅfinally„ÅßStop„Éú„Çø„É≥Áä∂ÊÖã„ÇíÂ§âÊõ¥„Åó„Å™„ÅÑ
                        if (result.plugin.running) {
                            log('üéØ Plugin is running, Skip stop button update in finally', 'info');
                            skipStopButtonUpdate = true;
                        }
                    }
                    
                    updateStatus('Success', 'idle');
                } else if (result.aborted) {
                    log('‚èπÔ∏è Execution stopped by user', 'warn');
                    updateStatus('Stopped', 'idle');
                    showNotification('Execution stopped', 'info');
                } else {
                    log(`‚ùå Execution error: ${result.error}`, 'error');
                    updateStatus('Error', 'error');
                    showNotification(`Execution failed: ${result.error}`, 'error');
                }
                
                executionCount++;
                
            } catch (error) {
                if (error.name === 'AbortError') {
                    log('‚èπÔ∏è Execution aborted', 'warn');
                    updateStatus('Stopped', 'idle');
                    showNotification('Execution stopped', 'info');
                } else {
                    log(`‚ùå Execution failed: ${error.message}`, 'error');
                    updateStatus('Error', 'error');
                    showNotification(`Execution failed: ${error.message}`, 'error');
                }
            } finally {
                // ÂÆüË°åÁä∂ÊÖã„Çí„É™„Çª„ÉÉ„Éà
                isExecuting = false;
                
                // „Éó„É©„Ç∞„Ç§„É≥„ÅåÂÆüË°å‰∏≠„ÅÆÂ†¥Âêà„ÅØStop„Éú„Çø„É≥Áä∂ÊÖã„ÇíÂ§âÊõ¥„Åó„Å™„ÅÑ
                if (!skipStopButtonUpdate) {
                    setTimeout(() => {
                        updateStopButtonState();
                    }, 100);
                } else {
                    log('‚è≠Ô∏è Skipping stop button update (plugin still running)', 'info');
                }
            }
        }
        
        function updateStopButtonState() {
            const stopButton = document.getElementById('stopButton');
            
            // „Éá„Éê„ÉÉ„Ç∞: ÁèæÂú®„ÅÆÂÆüË°å‰∏≠„Éó„É©„Ç∞„Ç§„É≥„ÇíË°®Á§∫
            const runningPluginsList = Array.from(runningPlugins.keys());
            log(`üîç Current running plugins: [${runningPluginsList.join(', ')}] (${runningPluginsList.length} total)`, 'info');
            
            // „Éó„É©„Ç∞„Ç§„É≥„ÅåÂÆüË°å‰∏≠„Åã„Å©„ÅÜ„Åã„ÉÅ„Çß„ÉÉ„ÇØ
            const hasRunningPlugins = Array.from(runningPlugins.values()).some(plugin => plugin.running);
            
            if (hasRunningPlugins) {
                // „Éó„É©„Ç∞„Ç§„É≥„ÅåÂÆüË°å‰∏≠„ÅÆÂ†¥Âêà„ÄÅStop„Éú„Çø„É≥„ÅØÊúâÂäπ
                stopButton.disabled = false;
                log('üîÑ Plugin(s) still running, Stop button remains active', 'info');
            } else {
                // „Éó„É©„Ç∞„Ç§„É≥„ÅåÂÆüË°å‰∏≠„Åß„Å™„ÅÑÂ†¥Âêà„ÄÅStop„Éú„Çø„É≥„ÇíÁÑ°Âäπ„Å´
                stopButton.disabled = true;
                currentExecutionAbortController = null;
                log('‚è∏Ô∏è No running plugins, Stop button disabled', 'info');
            }
        }

        async function stopExecution() {
            log('‚èπÔ∏è Stop button pressed...', 'warn');
            
            // ÁèæÂú®„ÅÆÂÆüË°å„Çí‰∏≠Ê≠¢
            if (currentExecutionAbortController) {
                currentExecutionAbortController.abort();
                log('üö´ Current execution aborted', 'warn');
            }
            
            // ÂÆüË°å‰∏≠„ÅÆ„Éó„É©„Ç∞„Ç§„É≥„ÇíÂÅúÊ≠¢
            const runningCount = runningPlugins.size;
            if (runningCount > 0) {
                log(`üõë Stopping ${runningCount} running plugin(s)...`, 'warn');
                await stopRunningPlugins();
            } else {
                log('‚ÑπÔ∏è No running plugins to stop', 'info');
            }
            
            // „Éú„Çø„É≥Áä∂ÊÖã„ÇíÊõ¥Êñ∞
            document.getElementById('stopButton').disabled = true;
            updateStatus('Stopped', 'idle');
            showNotification('All plugins stopped', 'success');
        }

        async function stopRunningPlugins() {
            const pluginsToStop = Array.from(runningPlugins.values());
            
            for (const plugin of pluginsToStop) {
                try {
                    // „Éó„É©„Ç∞„Ç§„É≥„Å´ÂÅúÊ≠¢ÈÄöÁü•„ÇíÈÄÅ‰ø°
                    if (typeof plugin.shutdown === 'function') {
                        await plugin.shutdown('User requested stop');
                        log(`üõë Plugin stopped: ${plugin.pluginId} (${plugin.uniqueId || plugin.pluginId})`, 'info');
                    }
                    
                    // VoidCore„Åã„ÇâÂâäÈô§
                    if (voidCore.unregisterPlugin) {
                        voidCore.unregisterPlugin(plugin.pluginId);
                    }
                    
                    // ËøΩË∑°„É™„Çπ„Éà„Åã„ÇâÂâäÈô§ÔºàuniqueId„Çí‰ΩøÁî®Ôºâ
                    const uniqueId = plugin.uniqueId || plugin.pluginId;
                    runningPlugins.delete(uniqueId);
                    
                } catch (error) {
                    log(`‚ùå Error stopping plugin ${plugin.pluginId}: ${error.message}`, 'error');
                }
            }
            
            // „Éó„É©„Ç∞„Ç§„É≥„É™„Çπ„ÉàÊõ¥Êñ∞
            updatePluginsList();
            pluginCount = Math.max(0, pluginCount - pluginsToStop.length);
        }

        async function stopSpecificPlugin(pluginId) {
            const plugin = runningPlugins.get(pluginId);
            if (!plugin) {
                showNotification(`Plugin ${pluginId} not found`, 'error');
                return;
            }
            
            try {
                if (typeof plugin.shutdown === 'function') {
                    await plugin.shutdown('Manual stop');
                }
                
                if (voidCore.unregisterPlugin) {
                    voidCore.unregisterPlugin(pluginId);
                }
                
                runningPlugins.delete(pluginId);
                updatePluginsList();
                pluginCount--;
                
                log(`üõë Plugin stopped: ${pluginId}`, 'success');
                showNotification(`Plugin ${pluginId} stopped`, 'success');
                
            } catch (error) {
                log(`‚ùå Error stopping plugin ${pluginId}: ${error.message}`, 'error');
                showNotification(`Failed to stop plugin: ${error.message}`, 'error');
            }
        }

        async function safeExecuteCode(code, abortSignal = null) {
            try {
                // ‰∏≠Êñ≠„ÉÅ„Çß„ÉÉ„ÇØ
                if (abortSignal && abortSignal.aborted) {
                    return { success: false, aborted: true };
                }
                
                const wrappedCode = `
                    const { createPlugin, voidCore, Message } = voidcoreAPI;
                    
                    const result = (function() {
                        ${code}
                    })();
                    
                    return result;
                `;
                
                const sandboxGlobals = {
                    console: {
                        log: (...args) => log(`[User] ${args.join(' ')}`, 'info'),
                        warn: (...args) => log(`[User] ${args.join(' ')}`, 'warn'),
                        error: (...args) => log(`[User] ${args.join(' ')}`, 'error')
                    },
                    voidcoreAPI: {
                        createPlugin,
                        voidCore,
                        Message
                    },
                    setTimeout,
                    setInterval,
                    clearTimeout,
                    clearInterval,
                    Date,
                    Math,
                    JSON
                };
                
                // ‰∏≠Êñ≠„ÉÅ„Çß„ÉÉ„ÇØ
                if (abortSignal && abortSignal.aborted) {
                    return { success: false, aborted: true };
                }
                
                const executor = new Function(
                    ...Object.keys(sandboxGlobals),
                    wrappedCode
                );
                
                const result = executor(...Object.values(sandboxGlobals));
                
                // ‰∏≠Êñ≠„ÉÅ„Çß„ÉÉ„ÇØ
                if (abortSignal && abortSignal.aborted) {
                    return { success: false, aborted: true };
                }
                
                if (result && typeof result === 'object' && result.pluginId) {
                    const registered = voidCore.registerPlugin(result);
                    
                    if (registered && typeof result.run === 'function') {
                        // „Éó„É©„Ç∞„Ç§„É≥ÂÆüË°åÂâç„ÅÆ‰∏≠Êñ≠„ÉÅ„Çß„ÉÉ„ÇØ
                        if (abortSignal && abortSignal.aborted) {
                            return { success: false, aborted: true };
                        }
                        
                        await result.run();
                    }
                    
                    return { success: true, plugin: result };
                } else {
                    return { success: true, value: result };
                }
                
            } catch (error) {
                if (error.name === 'AbortError' || (abortSignal && abortSignal.aborted)) {
                    return { success: false, aborted: true };
                }
                return { success: false, error: error.message };
            }
        }

        function setupUIEventListeners() {
            // „Çø„ÉñÂàá„ÇäÊõø„Åà
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => switchTab(tab.dataset.tab));
            });

            // „Éï„Ç°„Ç§„É´„ÉÑ„É™„Éº
            document.querySelectorAll('.file-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    console.log('File item clicked:', item.dataset.file);
                    selectFile(item.dataset.file);
                });
            });
        }

        function switchTab(tabName) {
            // „Çø„ÉñÁä∂ÊÖãÊõ¥Êñ∞
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

            // „Ç≥„É≥„ÉÜ„É≥„ÉÑÂàá„ÇäÊõø„Åà
            document.getElementById('pluginsTab').style.display = tabName === 'plugins' ? 'block' : 'none';
            document.getElementById('analyticsTab').style.display = tabName === 'analytics' ? 'block' : 'none';
            document.getElementById('projectsTab').style.display = tabName === 'projects' ? 'block' : 'none';
        }

        function selectFile(filename) {
            if (!monacoEditor) {
                showNotification('Editor not ready', 'warning');
                return;
            }
            
            // „Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„ÇíÊõ¥Êñ∞
            document.querySelectorAll('.file-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.file === filename) {
                    item.classList.add('active');
                }
            });

            switch(filename) {
                case 'main.js':
                    monacoEditor.setValue(getAdvancedTemplate());
                    break;
                case 'template':
                    monacoEditor.setValue(getBasicTemplate());
                    break;
                case 'advanced':
                    monacoEditor.setValue(getAnalyticsPluginTemplate());
                    break;
            }

            log(`üìÅ Loaded ${filename}`, 'info');
            showNotification(`Loaded ${filename}`, 'success');
        }

        function getAdvancedTemplate() {
            return `// üåü VoidIDE Genesis v2.0 - Advanced Plugin Template
// Self-creating system with analytics and visualization

const analyticsPlugin = createPlugin({
  pluginId: 'advanced-analytics-plugin',
  name: 'Advanced Analytics Plugin',
  version: '2.0.0',
  capabilities: ['analytics', 'monitoring', 'visualization', 'ai-insights']
}, {
  async run() {
    await this.initialize();
    
    this.log('üß† Advanced Analytics Plugin starting...');
    
    // ÁÑ°Èôê„É´„Éº„Éó„ÅÆ‰æãÔºàStop„Éú„Çø„É≥„ÉÜ„Çπ„ÉàÁî®Ôºâ
    let counter = 0;
    this.running = true;
    
    // setInterval„Çí‰Ωø„Å£„Å¶ÂÅúÊ≠¢ÂèØËÉΩ„Å´„Åô„Çã
    this.intervalId = setInterval(async () => {
      if (!this.running) {
        clearInterval(this.intervalId);
        this.log('üõë Processing stopped');
        return;
      }
      
      this.log(\`üí´ Processing... \${counter++}\`);
      
      // 10Âõû„Åî„Å®„Å´„É°„ÉÉ„Çª„Éº„Ç∏ÈÄÅ‰ø°
      if (counter % 10 === 0) {
        await this.notice('analytics.update', {
          count: counter,
          timestamp: Date.now()
        });
      }
    }, 1000);
    
    // È´òÂ∫¶„Å™„É°„ÉÉ„Çª„Éº„Ç∏ÂàÜÊûê
    this.messageAnalytics = {
      patterns: new Map(),
      anomalies: [],
      predictions: []
    };
    
    // „Åô„Åπ„Å¶„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÁõ£Ë¶ñ„ÉªÂàÜÊûê
    this.on('Notice', '*', (message) => {
      this.analyzeMessage(message);
    });
    
    // „Ç∑„Çπ„ÉÜ„É†ÂÅ•Â∫∑Áä∂ÊÖã„ÅÆÁõ£Ë¶ñ
    this.on('Notice', 'plugin.health', (message) => {
      this.assessSystemHealth(message);
    });
    
    // „Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÁï∞Â∏∏Ê§úÂá∫
    setInterval(() => {
      this.detectPerformanceAnomalies();
    }, 5000);
    
    // AI‰∫àÊ∏¨ÂàÜÊûêÔºàÁ∞°ÊòìÁâàÔºâ
    setInterval(() => {
      this.generatePredictions();
    }, 10000);
    
    this.log('üéØ Advanced analytics initialized!');
    
    // „Ç∑„Çπ„ÉÜ„É†ÂàÜÊûêÈñãÂßã„ÅÆÈÄöÁü•
    await this.notice('analytics.started', {
      pluginId: this.pluginId,
      capabilities: this.capabilities,
      analysisMode: 'real-time',
      features: ['pattern-detection', 'anomaly-detection', 'predictive-analytics']
    });
  },
  
  // „É°„ÉÉ„Çª„Éº„Ç∏„Éë„Çø„Éº„É≥ÂàÜÊûê
  analyzeMessage(message) {
    const pattern = this.extractPattern(message);
    
    if (this.messageAnalytics.patterns.has(pattern)) {
      this.messageAnalytics.patterns.set(pattern, 
        this.messageAnalytics.patterns.get(pattern) + 1);
    } else {
      this.messageAnalytics.patterns.set(pattern, 1);
    }
    
    // Áï∞Â∏∏„Éë„Çø„Éº„É≥Ê§úÂá∫
    if (this.isAnomalousPattern(pattern)) {
      this.detectAnomaly(message, pattern);
    }
  },
  
  extractPattern(message) {
    return \`\${message.type}:\${message.event_name || message.action || 'unknown'}\`;
  },
  
  isAnomalousPattern(pattern) {
    // Á∞°ÊòìÁï∞Â∏∏Ê§úÂá∫„É≠„Ç∏„ÉÉ„ÇØ
    const count = this.messageAnalytics.patterns.get(pattern) || 0;
    return count === 1 || count % 100 === 0; // ÂàùÂõû„Åæ„Åü„ÅØ100„ÅÆÂÄçÊï∞„ÅßÁï∞Â∏∏„Å®„Åø„Å™„Åô
  },
  
  async detectAnomaly(message, pattern) {
    const anomaly = {
      timestamp: Date.now(),
      pattern: pattern,
      message: message,
      severity: this.calculateSeverity(pattern),
      description: \`Unusual pattern detected: \${pattern}\`
    };
    
    this.messageAnalytics.anomalies.push(anomaly);
    
    // ÈáçË¶Å„Å™Áï∞Â∏∏„ÅØÂç≥Â∫ß„Å´ÈÄöÁü•
    if (anomaly.severity === 'high') {
      await this.notice('analytics.anomaly.critical', anomaly);
      this.log(\`üö® Critical anomaly detected: \${pattern}\`, 'error');
    }
  },
  
  calculateSeverity(pattern) {
    // „Éë„Çø„Éº„É≥„Éô„Éº„Çπ„ÅÆÈáçË¶ÅÂ∫¶Âà§ÂÆö
    if (pattern.includes('error') || pattern.includes('failed')) return 'high';
    if (pattern.includes('warning') || pattern.includes('timeout')) return 'medium';
    return 'low';
  },
  
  assessSystemHealth(message) {
    // „Ç∑„Çπ„ÉÜ„É†ÂÅ•Â∫∑Áä∂ÊÖã„ÅÆÁ∑èÂêàË©ï‰æ°
    const health = {
      timestamp: Date.now(),
      overall: 'healthy',
      components: {
        messageFlow: this.assessMessageFlow(),
        pluginStatus: this.assessPluginStatus(),
        performance: this.assessPerformance()
      }
    };
    
    this.log(\`üíä System health: \${health.overall}\`);
  },
  
  assessMessageFlow() {
    const recentPatterns = Array.from(this.messageAnalytics.patterns.entries())
      .filter(([pattern, count]) => count > 0);
    
    return recentPatterns.length > 0 ? 'active' : 'idle';
  },
  
  assessPluginStatus() {
    // Á∞°Êòì„Éó„É©„Ç∞„Ç§„É≥Áä∂ÊÖãË©ï‰æ°
    return 'stable';
  },
  
  assessPerformance() {
    const anomalyCount = this.messageAnalytics.anomalies.length;
    if (anomalyCount > 10) return 'degraded';
    if (anomalyCount > 5) return 'warning';
    return 'optimal';
  },
  
  detectPerformanceAnomalies() {
    // „Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÁï∞Â∏∏„ÅÆÊ§úÂá∫
    const now = Date.now();
    const recentAnomalies = this.messageAnalytics.anomalies
      .filter(a => now - a.timestamp < 60000); // 1ÂàÜ‰ª•ÂÜÖ
    
    if (recentAnomalies.length > 5) {
      this.log('‚ö†Ô∏è High anomaly rate detected', 'warn');
    }
  },
  
  async generatePredictions() {
    // AI‰∫àÊ∏¨ÂàÜÊûêÔºàÁ∞°ÊòìÁâàÔºâ
    const topPatterns = Array.from(this.messageAnalytics.patterns.entries())
      .sort(([,a], [,b]) => b - a)
      .slice(0, 5);
    
    const prediction = {
      timestamp: Date.now(),
      nextLikelyEvents: topPatterns.map(([pattern, count]) => ({
        pattern,
        probability: Math.min(count / 100, 1),
        confidence: 'medium'
      })),
      systemLoad: this.predictSystemLoad(),
      recommendations: this.generateRecommendations()
    };
    
    this.messageAnalytics.predictions.push(prediction);
    
    // ÈáçË¶Å„Å™‰∫àÊ∏¨„ÅØÈÄöÁü•
    await this.notice('analytics.prediction', prediction);
  },
  
  predictSystemLoad() {
    const patternCount = this.messageAnalytics.patterns.size;
    if (patternCount > 50) return 'high';
    if (patternCount > 20) return 'medium';
    return 'low';
  },
  
  generateRecommendations() {
    const recommendations = [];
    
    if (this.messageAnalytics.patterns.size > 30) {
      recommendations.push('Consider implementing message batching for better performance');
    }
    
    if (this.messageAnalytics.anomalies.length > 10) {
      recommendations.push('Review error handling and implement circuit breakers');
    }
    
    return recommendations;
  },
  
  // Stop„Éú„Çø„É≥Áî®„ÅÆ„Ç∑„É£„ÉÉ„Éà„ÉÄ„Ç¶„É≥„É°„ÇΩ„ÉÉ„Éâ
  async shutdown(reason) {
    this.log(\`üõë Shutting down: \${reason}\`);
    this.running = false;
    
    // „Ç§„É≥„Çø„Éº„Éê„É´„Çí„ÇØ„É™„Ç¢
    if (this.intervalId) {
      clearInterval(this.intervalId);
    }
    
    // „ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó
    this.messageAnalytics = null;
    this.analytics = null;
  }
});

// „Éó„É©„Ç∞„Ç§„É≥„ÇíËøî„Åó„Å¶VoidIDE„Å´Ëá™ÂãïÁôªÈå≤
return analyticsPlugin;`;
        }

        function getBasicTemplate() {
            return `// üåü VoidCore Plugin - Basic Template
const myPlugin = createPlugin({
  pluginId: 'my-basic-plugin',
  name: 'My Basic Plugin',
  version: '1.0.0'
}, {
  async run() {
    await this.initialize();
    
    this.log('üéâ Hello from VoidIDE Genesis!');
    
    // „É°„ÉÉ„Çª„Éº„Ç∏„ÇíÁõ£Ë¶ñ
    this.on('Notice', 'user.hello', (message) => {
      this.log('üëã Received:', message.payload);
    });
    
    // Ê≠ìËøé„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÈÄÅ‰ø°
    await this.notice('plugin.ready', {
      pluginId: this.pluginId,
      timestamp: Date.now()
    });
    
    this.log('‚úÖ Plugin ready!');
  }
});

return myPlugin;`;
        }

        function getAnalyticsPluginTemplate() {
            return `// üìä Analytics Plugin Template
const analyticsPlugin = createPlugin({
  pluginId: 'analytics-plugin',
  name: 'Analytics Plugin',
  capabilities: ['analytics', 'monitoring']
}, {
  async run() {
    await this.initialize();
    
    this.analytics = {
      events: [],
      metrics: new Map()
    };
    
    // „Åô„Åπ„Å¶„ÅÆ„Ç§„Éô„É≥„Éà„ÇíË®òÈå≤
    this.on('Notice', '*', (message) => {
      this.recordEvent(message);
    });
    
    this.log('üìä Analytics plugin ready!');
  },
  
  recordEvent(message) {
    this.analytics.events.push({
      timestamp: Date.now(),
      type: message.type,
      event: message.event_name || message.action
    });
    
    // Áµ±Ë®àÊõ¥Êñ∞
    const key = message.type;
    this.analytics.metrics.set(key, 
      (this.analytics.metrics.get(key) || 0) + 1);
  }
});

return analyticsPlugin;`;
        }

        function getVisualizerPluginTemplate() {
            return `// üé® Visualizer Plugin Template
const visualizerPlugin = createPlugin({
  pluginId: 'visualizer-plugin',
  name: 'Visualizer Plugin',
  capabilities: ['visualization', 'graphics']
}, {
  async run() {
    await this.initialize();
    
    this.canvas = document.createElement('canvas');
    this.ctx = this.canvas.getContext('2d');
    
    // „É°„ÉÉ„Çª„Éº„Ç∏„ÅÆÂèØË¶ñÂåñ
    this.on('Notice', '*', (message) => {
      this.visualizeMessage(message);
    });
    
    this.log('üé® Visualizer ready!');
  },
  
  visualizeMessage(message) {
    // Á∞°Âçò„Å™ÂèØË¶ñÂåñ
    this.log(\`üé® Visualizing: \${message.type}\`);
  }
});

return visualizerPlugin;`;
        }

        function getMonitorPluginTemplate() {
            return `// üîç Monitor Plugin Template
const monitorPlugin = createPlugin({
  pluginId: 'monitor-plugin',
  name: 'Monitor Plugin',
  capabilities: ['monitoring', 'health-check']
}, {
  async run() {
    await this.initialize();
    
    this.stats = {
      messages: 0,
      errors: 0,
      uptime: Date.now()
    };
    
    // „Ç∑„Çπ„ÉÜ„É†Áõ£Ë¶ñ
    setInterval(() => {
      this.checkSystemHealth();
    }, 5000);
    
    this.log('üîç Monitor ready!');
  },
  
  async checkSystemHealth() {
    this.stats.messages++;
    
    await this.notice('system.health', {
      uptime: Date.now() - this.stats.uptime,
      messages: this.stats.messages,
      status: 'healthy'
    });
  }
});

return monitorPlugin;`;
        }

        function log(message, type = 'info') {
            const output = document.getElementById('output');
            const entry = document.createElement('div');
            entry.style.marginBottom = '4px';
            
            const timestamp = new Date().toLocaleTimeString();
            const icons = { info: 'üìù', success: '‚úÖ', error: '‚ùå', warn: '‚ö†Ô∏è' };
            const colors = { info: '#d4d4d4', success: '#73c991', error: '#f48771', warn: '#dcdcaa' };
            
            entry.style.color = colors[type] || colors.info;
            entry.textContent = `[${timestamp}] ${icons[type] || 'üìù'} ${message}`;
            
            output.appendChild(entry);
            output.scrollTop = output.scrollHeight;
        }

        function updateStatus(text, status) {
            document.getElementById('statusText').textContent = text;
            const indicator = document.getElementById('statusIndicator');
            indicator.className = `status-indicator ${status}`;
        }

        function updateStats() {
            const uptime = Math.floor((Date.now() - startTime) / 1000);
            document.getElementById('uptime').textContent = `${uptime}s`;
            document.getElementById('pluginCount').textContent = pluginCount;
            document.getElementById('messageCount').textContent = messageCount;
            
            // „Éë„Éï„Ç©„Éº„Éû„É≥„ÇπË®àÁÆó
            const performance = Math.max(0, 100 - (executionCount * 2));
            document.getElementById('performance').textContent = `${performance}%`;
        }

        function updatePluginsList() {
            const pluginsList = document.getElementById('pluginsList');
            const plugins = voidCore.getAllPlugins ? voidCore.getAllPlugins() : [];
            
            // „Ç∑„Çπ„ÉÜ„É†„Éó„É©„Ç∞„Ç§„É≥„ÇíÈô§„Åè
            const userPlugins = plugins.filter(p => !p.pluginId.includes('void-ide-genesis'));
            
            // „É¶„Éº„Ç∂„Éº„Éó„É©„Ç∞„Ç§„É≥„ÅÆ„ÅøË°®Á§∫
            const userPluginItems = userPlugins.map(plugin => `
                <li class="plugin-item">
                    <div class="plugin-name">${plugin.name || plugin.pluginId}</div>
                    <div class="plugin-status">‚úÖ Active | v${plugin.version || '1.0.0'}</div>
                </li>
            `).join('');
            
            const systemPlugin = `
                <li class="plugin-item">
                    <div class="plugin-name">VoidIDE Genesis v2.0</div>
                    <div class="plugin-status">‚úÖ System Plugin - Always Active</div>
                </li>
            `;
            
            pluginsList.innerHTML = systemPlugin + userPluginItems;
        }

        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // „Ç´„Çπ„Çø„É†Á¢∫Ë™ç„ÉÄ„Ç§„Ç¢„É≠„Ç∞
        function showCustomConfirm(message) {
            return new Promise((resolve) => {
                // Êó¢Â≠ò„ÅÆ„ÉÄ„Ç§„Ç¢„É≠„Ç∞„Åå„ÅÇ„Çå„Å∞ÂâäÈô§
                const existingDialog = document.getElementById('customConfirmDialog');
                if (existingDialog) {
                    existingDialog.remove();
                }
                
                // „ÉÄ„Ç§„Ç¢„É≠„Ç∞„Çí‰ΩúÊàê
                const dialog = document.createElement('div');
                dialog.id = 'customConfirmDialog';
                dialog.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.8);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 10000;
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
                `;
                
                const content = document.createElement('div');
                content.style.cssText = `
                    background: #2d2d30;
                    color: #d4d4d4;
                    padding: 30px;
                    border-radius: 8px;
                    max-width: 400px;
                    text-align: center;
                    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
                `;
                
                const messageEl = document.createElement('p');
                messageEl.textContent = message;
                messageEl.style.cssText = `
                    margin: 0 0 20px 0;
                    line-height: 1.5;
                    white-space: pre-line;
                `;
                
                const buttonContainer = document.createElement('div');
                buttonContainer.style.cssText = `
                    display: flex;
                    gap: 10px;
                    justify-content: center;
                `;
                
                const yesButton = document.createElement('button');
                yesButton.textContent = 'Yes, Export ZIP';
                yesButton.style.cssText = `
                    background: #0e639c;
                    color: white;
                    border: none;
                    padding: 10px 20px;
                    border-radius: 4px;
                    cursor: pointer;
                    font-size: 14px;
                `;
                
                const noButton = document.createElement('button');
                noButton.textContent = 'No, Just Save';
                noButton.style.cssText = `
                    background: #6c6c6c;
                    color: white;
                    border: none;
                    padding: 10px 20px;
                    border-radius: 4px;
                    cursor: pointer;
                    font-size: 14px;
                `;
                
                yesButton.onclick = () => {
                    dialog.remove();
                    resolve(true);
                };
                
                noButton.onclick = () => {
                    dialog.remove();
                    resolve(false);
                };
                
                // Escape„Ç≠„Éº„ÅßÈñâ„Åò„Çã
                dialog.onkeydown = (e) => {
                    if (e.key === 'Escape') {
                        dialog.remove();
                        resolve(false);
                    }
                };
                
                buttonContainer.appendChild(yesButton);
                buttonContainer.appendChild(noButton);
                content.appendChild(messageEl);
                content.appendChild(buttonContainer);
                dialog.appendChild(content);
                document.body.appendChild(dialog);
                
                // „Éï„Ç©„Éº„Ç´„Çπ„ÇíË®≠ÂÆö
                yesButton.focus();
            });
        }

        // „Ç∞„É≠„Éº„Éê„É´Èñ¢Êï∞
        window.executeCode = executeCode;
        window.stopExecution = stopExecution;
        window.saveCode = async () => {
            console.log('üíæ Save button clicked, projectManager:', projectManager);
            if (projectManager) {
                log('üíæ Saving project to localStorage...', 'info');
                
                // ÁèæÂú®„ÅÆ„Ç≥„Éº„Éâ„Çí„Éó„É≠„Ç∏„Çß„ÇØ„Éà„Å´ËøΩÂä†
                try {
                    // ProjectManager„ÅÆÁä∂ÊÖã„ÇíÁ¢∫Ë™ç
                    if (!projectManager.currentProject) {
                        log('‚ö†Ô∏è ProjectManager currentProject is null, reinitializing...', 'warn');
                        projectManager.currentProject = { ...projectManager.defaultProject };
                        log('üîß ProjectManager reinitialized with default project', 'info');
                    }
                    
                    projectManager.addCurrentPlugin();
                    log(`üîß Current plugins in project: ${projectManager.currentProject.plugins.length}`, 'info');
                } catch (error) {
                    log(`‚ùå Failed to add current plugin: ${error.message}`, 'error');
                    
                    // ÂÜçË©¶Ë°å„ÅÆ„Åü„ÇÅ„ÅÆ‰øÆÂæ©
                    if (error.message.includes('currentProject is null')) {
                        log('üîß Attempting to fix currentProject...', 'info');
                        try {
                            projectManager.currentProject = { ...projectManager.defaultProject };
                            log('üîß Fixed currentProject, retrying...', 'info');
                            projectManager.addCurrentPlugin();
                            log('‚úÖ Plugin added successfully after fix', 'success');
                        } catch (retryError) {
                            log(`‚ùå Retry failed: ${retryError.message}`, 'error');
                        }
                    }
                }
                
                // LocalStorage„Å´‰øùÂ≠ò
                projectManager.saveProject();
                
                // ÂøÖ„ÅöÁ¢∫Ë™ç„ÉÄ„Ç§„Ç¢„É≠„Ç∞„ÇíË°®Á§∫
                log('üí¨ Showing export confirmation dialog...', 'info');
                
                // „Ç´„Çπ„Çø„É†„ÉÄ„Ç§„Ç¢„É≠„Ç∞„Çí‰ΩúÊàê
                const exportZip = await showCustomConfirm('Project saved to localStorage!\n\nDo you want to export as ZIP file for download?');
                log(`üí¨ User selected: ${exportZip ? 'Yes' : 'No'}`, 'info');
                
                if (exportZip) {
                    log('üì¶ Exporting project as ZIP...', 'info');
                    log(`üîç Project state: ${projectManager.currentProject.plugins.length} plugins, name: "${projectManager.currentProject.metadata.name}"`, 'info');
                    
                    // „Éó„É©„Ç∞„Ç§„É≥„Åå0ÂÄã„ÅÆÂ†¥Âêà„ÄÅÂº∑Âà∂ÁöÑ„Å´ÁèæÂú®„ÅÆ„Ç®„Éá„Ç£„Çø„Ç≥„Éº„Éâ„ÇíËøΩÂä†
                    if (projectManager.currentProject.plugins.length === 0) {
                        log('‚ö†Ô∏è No plugins in project, adding current editor content...', 'warn');
                        try {
                            await projectManager.addCurrentEditorPlugin();
                            log(`üîß After adding editor plugin: ${projectManager.currentProject.plugins.length} plugins`, 'info');
                        } catch (error) {
                            log(`‚ùå Failed to add editor plugin: ${error.message}`, 'error');
                        }
                    }
                    
                    try {
                        await projectManager.exportProjectZip();
                        log('‚úÖ ZIP export completed', 'success');
                    } catch (error) {
                        log(`‚ùå ZIP export failed: ${error.message}`, 'error');
                    }
                }
            } else {
                log('üíæ ProjectManager not available, saving to localStorage fallback', 'warn');
                
                // Âü∫Êú¨ÁöÑ„Å™LocalStorage‰øùÂ≠ò
                const currentCode = monacoEditor ? monacoEditor.getValue() : '';
                const saveData = {
                    code: currentCode,
                    timestamp: Date.now(),
                    version: '2.0'
                };
                
                localStorage.setItem('voidide-current-code', JSON.stringify(saveData));
                log('üíæ Code saved to localStorage', 'success');
                showNotification('Code saved to localStorage', 'success');
            }
        };
        
        window.loadProject = async () => {
            log('üìÇ Load project button clicked', 'info');
            
            // „Éï„Ç°„Ç§„É´ÈÅ∏Êäû„ÉÄ„Ç§„Ç¢„É≠„Ç∞„Çí‰ΩúÊàê
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.zip,.voidproj.json';
            input.style.display = 'none';
            
            input.onchange = async (event) => {
                const file = event.target.files[0];
                if (!file) return;
                
                log(`üìÇ Loading file: ${file.name}`, 'info');
                
                try {
                    if (file.name.endsWith('.zip')) {
                        await loadZipProject(file);
                    } else if (file.name.endsWith('.voidproj.json')) {
                        await loadJsonProject(file);
                    } else {
                        throw new Error('Unsupported file format');
                    }
                } catch (error) {
                    log(`‚ùå Failed to load project: ${error.message}`, 'error');
                    showNotification(`Load failed: ${error.message}`, 'error');
                }
            };
            
            document.body.appendChild(input);
            input.click();
            document.body.removeChild(input);
        };
        
        // ZIP „Éó„É≠„Ç∏„Çß„ÇØ„ÉàË™≠„ÅøËæº„Åø
        async function loadZipProject(file) {
            if (!window.JSZip) {
                throw new Error('JSZip not available');
            }
            
            log('üì¶ Parsing ZIP file...', 'info');
            const zip = new JSZip();
            const zipData = await zip.loadAsync(file);
            
            // „Éó„É≠„Ç∏„Çß„ÇØ„Éà„É°„Çø„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø
            const projectFile = zipData.file('voidcore.project.json');
            if (!projectFile) {
                throw new Error('Invalid project file: missing voidcore.project.json');
            }
            
            const projectMeta = JSON.parse(await projectFile.async('string'));
            log(`üì¶ Loading project: ${projectMeta.projectName}`, 'info');
            
            // „Éó„É©„Ç∞„Ç§„É≥„Éï„Ç°„Ç§„É´„ÇíË™≠„ÅøËæº„Åø
            const plugins = [];
            for (const pluginFileName of projectMeta.plugins || []) {
                const pluginJsonFile = zipData.file(pluginFileName);
                const pluginJsFile = zipData.file(pluginFileName.replace('.plugin.json', '.plugin.js'));
                
                if (pluginJsonFile && pluginJsFile) {
                    const pluginMeta = JSON.parse(await pluginJsonFile.async('string'));
                    const pluginSource = await pluginJsFile.async('string');
                    
                    // „Éï„Ç°„Ç§„É´Âêç„Åã„Çâ„Éó„É©„Ç∞„Ç§„É≥ID„ÇíÊäΩÂá∫
                    const pluginId = pluginFileName.replace('.plugin.json', '');
                    
                    plugins.push({
                        id: pluginId, // „Éï„Ç°„Ç§„É´Âêç„Éô„Éº„Çπ„ÅÆID„Çí‰ΩøÁî®
                        name: pluginMeta.name || pluginId,
                        version: pluginMeta.version,
                        sourceCode: pluginSource,
                        messageTypes: pluginMeta.messageTypes || { subscribes: [], publishes: [] },
                        dependencies: pluginMeta.dependencies || [],
                        settings: pluginMeta.settings || {},
                        capabilities: pluginMeta.capabilities || [],
                        author: pluginMeta.author,
                        created: pluginMeta.created
                    });
                }
            }
            
            log(`üì¶ Loaded ${plugins.length} plugins`, 'info');
            
            // „Éó„É≠„Ç∏„Çß„ÇØ„Éà„ÇíProjectManager„Å´Ë®≠ÂÆö
            if (projectManager) {
                projectManager.currentProject = {
                    metadata: {
                        name: projectMeta.projectName,
                        description: projectMeta.description || '',
                        createdWith: projectMeta.voidcoreVersion || '14.0',
                        created: projectMeta.created || Date.now(),
                        lastModified: Date.now(),
                        author: projectMeta.author || 'Unknown',
                        version: projectMeta.version || '1.0.0'
                    },
                    plugins: plugins,
                    messageFlow: {},
                    settings: {
                        autoSave: true,
                        autoRun: false,
                        format: 'zip-separated'
                    }
                };
                
                // ÊúÄÂàù„ÅÆ„Éó„É©„Ç∞„Ç§„É≥„Çí„Ç®„Éá„Ç£„Çø„Å´Ë™≠„ÅøËæº„Åø
                if (plugins.length > 0) {
                    const firstPlugin = plugins[0];
                    if (window.monacoEditor) {
                        window.monacoEditor.setValue(firstPlugin.sourceCode);
                        log(`üìù Loaded ${firstPlugin.name} into editor`, 'info');
                    }
                }
                
                log('‚úÖ Project loaded successfully', 'success');
                showNotification(`Project "${projectMeta.projectName}" loaded successfully!`, 'success');
            } else {
                throw new Error('ProjectManager not available');
            }
        }
        
        // JSON „Éó„É≠„Ç∏„Çß„ÇØ„ÉàË™≠„ÅøËæº„Åø („Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ)
        async function loadJsonProject(file) {
            log('üìÑ Parsing JSON file...', 'info');
            const text = await file.text();
            const projectData = JSON.parse(text);
            
            if (projectManager) {
                projectManager.currentProject = projectData;
                
                // ÊúÄÂàù„ÅÆ„Éó„É©„Ç∞„Ç§„É≥„Çí„Ç®„Éá„Ç£„Çø„Å´Ë™≠„ÅøËæº„Åø
                if (projectData.plugins && projectData.plugins.length > 0) {
                    const firstPlugin = projectData.plugins[0];
                    if (window.monacoEditor && firstPlugin.sourceCode) {
                        window.monacoEditor.setValue(firstPlugin.sourceCode);
                        log(`üìù Loaded ${firstPlugin.name || firstPlugin.id} into editor`, 'info');
                    }
                }
                
                log('‚úÖ JSON project loaded successfully', 'success');
                showNotification(`Project "${projectData.metadata?.name || 'Unnamed'}" loaded successfully!`, 'success');
            } else {
                throw new Error('ProjectManager not available');
            }
        }
        
        window.formatCode = () => {
            monacoEditor.getAction('editor.action.formatDocument').run();
            log('üé® Code formatted', 'info');
        };
        window.toggleAnalytics = () => {
            switchTab('analytics');
            showNotification('Analytics panel opened', 'info');
        };
        window.loadBasicTemplate = () => {
            if (monacoEditor) {
                monacoEditor.setValue(getBasicTemplate());
                log('üìã Basic template loaded', 'info');
                showNotification('Basic template loaded', 'success');
            } else {
                showNotification('Editor not ready', 'warning');
            }
        };
        window.loadAdvancedTemplate = () => {
            if (monacoEditor) {
                monacoEditor.setValue(getAdvancedTemplate());
                log('üöÄ Advanced template loaded', 'info');
                showNotification('Advanced template loaded', 'success');
            } else {
                showNotification('Editor not ready', 'warning');
            }
        };
        window.showCodeHelper = () => {
            showNotification('Code helper: Use Ctrl+Space for suggestions', 'info');
        };
        window.openSettings = () => {
            showNotification('Settings panel coming in Phase 3', 'info');
        };
        
        // „Éï„Ç°„Ç§„É´ÈÅ∏ÊäûÈñ¢Êï∞„ÇÇ„Ç∞„É≠„Éº„Éê„É´„Å´
        window.selectFile = selectFile;

    </script>
</body>
</html>