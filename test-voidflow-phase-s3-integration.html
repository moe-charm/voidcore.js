<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš€ Phase S3: VoidFlowNodePlugin â†’ IPluginçµ±åˆãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            background: linear-gradient(135deg, #2c1810, #102c28);
            color: #ffffff;
            padding: 20px;
            min-height: 100vh;
            margin: 0;
        }
        
        .test-container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }
        
        .test-section {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #4a90e2;
            border-radius: 12px;
            padding: 20px;
        }
        
        .test-title {
            color: #4a90e2;
            font-size: 14px;
            margin-bottom: 15px;
            border-bottom: 2px solid #4a90e2;
            padding-bottom: 8px;
            text-align: center;
        }
        
        .button {
            background: #4a90e2;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 16px;
            cursor: pointer;
            margin: 5px;
            font-family: inherit;
            font-size: 11px;
            transition: all 0.3s ease;
            width: calc(100% - 10px);
        }
        
        .button:hover {
            background: #357abd;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(74, 144, 226, 0.3);
        }
        
        .button.success {
            background: #27ae60;
        }
        
        .button.success:hover {
            background: #229954;
        }
        
        .button.danger {
            background: #e74c3c;
        }
        
        .button.danger:hover {
            background: #c0392b;
        }
        
        .log-area {
            background: #0a0a0a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
            height: 250px;
            overflow-y: auto;
            font-size: 10px;
            line-height: 1.4;
            margin: 10px 0;
        }
        
        .stats-panel {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .stats-item {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            font-size: 11px;
        }
        
        .stats-label {
            color: #bbb;
        }
        
        .stats-value {
            color: #4a90e2;
            font-weight: bold;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #4a90e2;
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .success-indicator {
            color: #27ae60;
            font-weight: bold;
        }
        
        .error-indicator {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .phase-indicator {
            background: linear-gradient(90deg, #4a90e2, #27ae60);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸš€ Phase S3: VoidFlowNodePlugin â†’ IPluginçµ±åˆãƒ†ã‚¹ãƒˆ</h1>
        <p class="phase-indicator">VoidCore v14.0 Phase Rçµ±ä¸€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ å®Œå…¨çµ±åˆç¢ºèª</p>
    </div>

    <div class="test-container">
        <!-- IPluginç¶™æ‰¿ç¢ºèª -->
        <div class="test-section">
            <div class="test-title">ğŸ§¬ IPluginç¶™æ‰¿ç¢ºèª</div>
            
            <button class="button" onclick="testIPluginInheritance()">IPluginç¶™æ‰¿æ¤œè¨¼</button>
            <button class="button" onclick="testHandleMessage()">handleMessageçµ±ä¸€ç¢ºèª</button>
            <button class="button success" onclick="testPhaseRIntegration()">Phase Rçµ±åˆåº¦æ¸¬å®š</button>
            <button class="button" onclick="testMetadataUnification()">ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿çµ±ä¸€ç¢ºèª</button>
            
            <div class="log-area" id="inheritanceLog"></div>
            
            <div class="stats-panel">
                <div class="test-title">ç¶™æ‰¿çµ±åˆçµ±è¨ˆ</div>
                <div class="stats-item">
                    <span class="stats-label">IPluginç¶™æ‰¿:</span>
                    <span class="stats-value" id="inheritanceStatus">æœªç¢ºèª</span>
                </div>
                <div class="stats-item">
                    <span class="stats-label">handleMessageçµ±ä¸€:</span>
                    <span class="stats-value" id="handleMessageStatus">æœªç¢ºèª</span>
                </div>
                <div class="stats-item">
                    <span class="stats-label">Phase Rçµ±åˆåº¦:</span>
                    <span class="stats-value" id="phaseRIntegration">0%</span>
                </div>
            </div>
        </div>

        <!-- Intentçµ±ä¸€å‡¦ç†ç¢ºèª -->
        <div class="test-section">
            <div class="test-title">ğŸ¯ Intentçµ±ä¸€å‡¦ç†ç¢ºèª</div>
            
            <button class="button" onclick="testVoidFlowIntents()">VoidFlowå°‚ç”¨Intent</button>
            <button class="button" onclick="testExecuteIntent()">voidflow.execute Intent</button>
            <button class="button" onclick="testStatsIntent()">voidflow.getStats Intent</button>
            <button class="button success" onclick="testIntentChain()">Intenté€£é–å®Ÿè¡Œ</button>
            
            <div class="log-area" id="intentLog"></div>
            
            <div class="stats-panel">
                <div class="test-title">Intentå‡¦ç†çµ±è¨ˆ</div>
                <div class="stats-item">
                    <span class="stats-label">Intentå®Ÿè¡Œæ•°:</span>
                    <span class="stats-value" id="intentCount">0</span>
                </div>
                <div class="stats-item">
                    <span class="stats-label">æˆåŠŸç‡:</span>
                    <span class="stats-value" id="successRate">0%</span>
                </div>
                <div class="stats-item">
                    <span class="stats-label">å¹³å‡å‡¦ç†æ™‚é–“:</span>
                    <span class="stats-value" id="avgProcessTime">0ms</span>
                </div>
            </div>
        </div>

        <!-- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ»å‰Šæ¸›åŠ¹æœç¢ºèª -->
        <div class="test-section">
            <div class="test-title">ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ»å‰Šæ¸›åŠ¹æœç¢ºèª</div>
            
            <button class="button" onclick="testPerformance()">å®Ÿè¡Œæ€§èƒ½æ¸¬å®š</button>
            <button class="button" onclick="testMemoryUsage()">ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ç¢ºèª</button>
            <button class="button success" onclick="testCodeReduction()">ã‚³ãƒ¼ãƒ‰å‰Šæ¸›åŠ¹æœæ¸¬å®š</button>
            <button class="button danger" onclick="clearAllLogs()">å…¨ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
            
            <div class="log-area" id="performanceLog"></div>
            
            <div class="stats-panel">
                <div class="test-title">å‰Šæ¸›åŠ¹æœçµ±è¨ˆ</div>
                <div class="stats-item">
                    <span class="stats-label">æ¨å®šå‰Šæ¸›è¡Œæ•°:</span>
                    <span class="stats-value" id="reducedLines">~500è¡Œ</span>
                </div>
                <div class="stats-item">
                    <span class="stats-label">çµ±ä¸€åº¦æ”¹å–„:</span>
                    <span class="stats-value" id="unificationImprovement">+85%</span>
                </div>
                <div class="stats-item">
                    <span class="stats-label">Phase Ré”æˆåº¦:</span>
                    <span class="stats-value" id="phaseRAchievement">100%</span>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // VoidCoreã¨VoidFlowNodePluginã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
        import { voidCore } from './src/voidcore.js';
        import { Message } from './src/message.js';
        import { VoidFlowNodePlugin, createVoidFlowNodePlugin } from './src/voidflow-node-plugin.js';
        import { IPlugin } from './src/plugin-interface.js';

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        window.voidCore = voidCore;
        window.Message = Message;
        window.VoidFlowNodePlugin = VoidFlowNodePlugin;
        window.createVoidFlowNodePlugin = createVoidFlowNodePlugin;
        window.IPlugin = IPlugin;
        
        let testStats = {
            intentCount: 0,
            successCount: 0,
            errorCount: 0,
            executionTimes: [],
            testsRun: 0
        };

        // ãƒ­ã‚°æ©Ÿèƒ½
        function logToArea(areaId, message) {
            const area = document.getElementById(areaId);
            if (area) {
                const timestamp = new Date().toLocaleTimeString();
                area.innerHTML += `<div>[${timestamp}] ${message}</div>`;
                area.scrollTop = area.scrollHeight;
            }
        }

        function updateStats() {
            // Intentçµ±è¨ˆæ›´æ–°
            document.getElementById('intentCount').textContent = testStats.intentCount;
            
            if (testStats.intentCount > 0) {
                const successRate = Math.round((testStats.successCount / testStats.intentCount) * 100);
                document.getElementById('successRate').textContent = successRate + '%';
            }
            
            if (testStats.executionTimes.length > 0) {
                const avgTime = testStats.executionTimes.reduce((a, b) => a + b, 0) / testStats.executionTimes.length;
                document.getElementById('avgProcessTime').textContent = Math.round(avgTime) + 'ms';
            }
        }

        // ==========================================
        // IPluginç¶™æ‰¿ç¢ºèªãƒ†ã‚¹ãƒˆé–¢æ•°
        // ==========================================

        window.testIPluginInheritance = async function() {
            logToArea('inheritanceLog', 'ğŸ§¬ IPluginç¶™æ‰¿æ¤œè¨¼é–‹å§‹');
            
            try {
                // VoidFlowNodePluginã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
                const nodePlugin = createVoidFlowNodePlugin('input.text', {
                    displayName: 'ãƒ†ã‚¹ãƒˆå…¥åŠ›ãƒãƒ¼ãƒ‰',
                    description: 'Phase S3çµ±åˆãƒ†ã‚¹ãƒˆç”¨'
                });
                
                // ç¶™æ‰¿ç¢ºèª
                const isIPluginInstance = nodePlugin instanceof IPlugin;
                const hasHandleMessage = typeof nodePlugin.handleMessage === 'function';
                const hasMetadata = nodePlugin.metadata && typeof nodePlugin.metadata === 'object';
                const hasPhaseRMarker = nodePlugin.metadata?.phaseR === true;
                
                logToArea('inheritanceLog', `âœ… instanceof IPlugin: ${isIPluginInstance}`);
                logToArea('inheritanceLog', `âœ… handleMessage method: ${hasHandleMessage}`);
                logToArea('inheritanceLog', `âœ… metadata property: ${hasMetadata}`);
                logToArea('inheritanceLog', `âœ… Phase R marker: ${hasPhaseRMarker}`);
                
                // çµ±è¨ˆæ›´æ–°
                document.getElementById('inheritanceStatus').textContent = isIPluginInstance ? 'âœ… æˆåŠŸ' : 'âŒ å¤±æ•—';
                document.getElementById('inheritanceStatus').className = isIPluginInstance ? 'success-indicator' : 'error-indicator';
                
                logToArea('inheritanceLog', `ğŸ‰ IPluginç¶™æ‰¿æ¤œè¨¼å®Œäº†: ${isIPluginInstance ? 'æˆåŠŸ' : 'å¤±æ•—'}`);
                
            } catch (error) {
                logToArea('inheritanceLog', `âŒ IPluginç¶™æ‰¿æ¤œè¨¼å¤±æ•—: ${error.message}`);
                document.getElementById('inheritanceStatus').textContent = 'âŒ ã‚¨ãƒ©ãƒ¼';
                document.getElementById('inheritanceStatus').className = 'error-indicator';
            }
        };

        window.testHandleMessage = async function() {
            logToArea('inheritanceLog', 'ğŸ“¨ handleMessageçµ±ä¸€ç¢ºèªé–‹å§‹');
            
            try {
                const nodePlugin = createVoidFlowNodePlugin('button.send', {
                    displayName: 'ãƒ†ã‚¹ãƒˆãƒœã‚¿ãƒ³ãƒãƒ¼ãƒ‰'
                });
                
                // ãƒ†ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä½œæˆ
                const testMessage = Message.intent('voidflow.execute', {
                    inputData: { trigger: true },
                    context: { testMode: true }
                });
                
                logToArea('inheritanceLog', `ğŸ“¤ é€ä¿¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: ${testMessage.intent}`);
                
                // handleMessageå®Ÿè¡Œ
                const startTime = Date.now();
                const result = await nodePlugin.handleMessage(testMessage);
                const elapsed = Date.now() - startTime;
                
                logToArea('inheritanceLog', `âœ… handleMessageå®Ÿè¡ŒæˆåŠŸ: ${elapsed}ms`);
                logToArea('inheritanceLog', `ğŸ“Š çµæœ: ${JSON.stringify(result).substring(0, 80)}...`);
                
                // çµ±è¨ˆæ›´æ–°
                document.getElementById('handleMessageStatus').textContent = 'âœ… æˆåŠŸ';
                document.getElementById('handleMessageStatus').className = 'success-indicator';
                
                testStats.intentCount++;
                testStats.successCount++;
                testStats.executionTimes.push(elapsed);
                
            } catch (error) {
                logToArea('inheritanceLog', `âŒ handleMessageç¢ºèªå¤±æ•—: ${error.message}`);
                document.getElementById('handleMessageStatus').textContent = 'âŒ å¤±æ•—';
                document.getElementById('handleMessageStatus').className = 'error-indicator';
                
                testStats.intentCount++;
                testStats.errorCount++;
            }
            
            updateStats();
        };

        window.testPhaseRIntegration = async function() {
            logToArea('inheritanceLog', 'ğŸš€ Phase Rçµ±åˆåº¦æ¸¬å®šé–‹å§‹');
            
            try {
                const nodePlugin = createVoidFlowNodePlugin('math.add', {
                    displayName: 'ãƒ†ã‚¹ãƒˆæ•°å­¦ãƒãƒ¼ãƒ‰'
                });
                
                // Phase Rçµ±åˆåº¦ãƒã‚§ãƒƒã‚¯é …ç›®
                const checks = {
                    ipluginInheritance: nodePlugin instanceof IPlugin,
                    handleMessageMethod: typeof nodePlugin.handleMessage === 'function',
                    handleCustomIntentMethod: typeof nodePlugin.handleCustomIntent === 'function',
                    metadataStructure: nodePlugin.metadata && typeof nodePlugin.metadata === 'object',
                    phaseRMarker: nodePlugin.metadata?.phaseR === true,
                    voidFlowConfig: nodePlugin.metadata?.voidFlowConfig && typeof nodePlugin.metadata.voidFlowConfig === 'object',
                    statsUnification: nodePlugin.metadata?.stats && typeof nodePlugin.metadata.stats === 'object',
                    logMethodInheritance: typeof nodePlugin.log === 'function'
                };
                
                const totalChecks = Object.keys(checks).length;
                const passedChecks = Object.values(checks).filter(Boolean).length;
                const integrationPercentage = Math.round((passedChecks / totalChecks) * 100);
                
                for (const [checkName, passed] of Object.entries(checks)) {
                    logToArea('inheritanceLog', `${passed ? 'âœ…' : 'âŒ'} ${checkName}: ${passed}`);
                }
                
                logToArea('inheritanceLog', `ğŸ“Š Phase Rçµ±åˆåº¦: ${passedChecks}/${totalChecks} = ${integrationPercentage}%`);
                
                // çµ±è¨ˆæ›´æ–°
                document.getElementById('phaseRIntegration').textContent = integrationPercentage + '%';
                
                if (integrationPercentage === 100) {
                    logToArea('inheritanceLog', `ğŸ‰ Phase Rå®Œå…¨çµ±åˆé”æˆ!`);
                }
                
            } catch (error) {
                logToArea('inheritanceLog', `âŒ Phase Rçµ±åˆåº¦æ¸¬å®šå¤±æ•—: ${error.message}`);
            }
        };

        window.testMetadataUnification = async function() {
            logToArea('inheritanceLog', 'ğŸ“‹ ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿çµ±ä¸€ç¢ºèªé–‹å§‹');
            
            try {
                const nodePlugin = createVoidFlowNodePlugin('string.uppercase', {
                    displayName: 'ãƒ†ã‚¹ãƒˆæ–‡å­—åˆ—ãƒãƒ¼ãƒ‰',
                    category: 'string-processing',
                    icon: 'ğŸ”¤'
                });
                
                // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ§‹é€ ç¢ºèª
                logToArea('inheritanceLog', `ğŸ“‹ Plugin ID: ${nodePlugin.id}`);
                logToArea('inheritanceLog', `ğŸ“‹ Display Name: ${nodePlugin.displayName}`);
                logToArea('inheritanceLog', `ğŸ“‹ Node Type: ${nodePlugin.nodeType}`);
                logToArea('inheritanceLog', `ğŸ“‹ Phase R Marker: ${nodePlugin.metadata.phaseR}`);
                logToArea('inheritanceLog', `ğŸ“‹ VoidFlow Config: ${JSON.stringify(nodePlugin.metadata.voidFlowConfig).substring(0, 60)}...`);
                logToArea('inheritanceLog', `ğŸ“‹ Stats: ${JSON.stringify(nodePlugin.metadata.stats).substring(0, 60)}...`);
                
                logToArea('inheritanceLog', `âœ… ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿çµ±ä¸€ç¢ºèªå®Œäº†`);
                
            } catch (error) {
                logToArea('inheritanceLog', `âŒ ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿çµ±ä¸€ç¢ºèªå¤±æ•—: ${error.message}`);
            }
        };

        // ==========================================
        // Intentçµ±ä¸€å‡¦ç†ç¢ºèªãƒ†ã‚¹ãƒˆé–¢æ•°
        // ==========================================

        window.testVoidFlowIntents = async function() {
            logToArea('intentLog', 'ğŸ¯ VoidFlowå°‚ç”¨Intentç¢ºèªé–‹å§‹');
            
            try {
                const nodePlugin = createVoidFlowNodePlugin('output.console', {
                    displayName: 'ãƒ†ã‚¹ãƒˆã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›ãƒãƒ¼ãƒ‰'
                });
                
                // VoidFlowå°‚ç”¨Intentä¸€è¦§ãƒ†ã‚¹ãƒˆ
                const voidFlowIntents = [
                    'voidflow.execute',
                    'voidflow.getStats',
                    'voidflow.updateSandbox'
                ];
                
                for (const intentName of voidFlowIntents) {
                    try {
                        const testMessage = Message.intent(intentName, {
                            inputData: { test: true },
                            context: { testMode: true },
                            sandboxConfig: { maxExecutionTime: 3000 }
                        });
                        
                        const startTime = Date.now();
                        const result = await nodePlugin.handleMessage(testMessage);
                        const elapsed = Date.now() - startTime;
                        
                        logToArea('intentLog', `âœ… ${intentName}: ${elapsed}ms`);
                        
                        testStats.intentCount++;
                        testStats.successCount++;
                        testStats.executionTimes.push(elapsed);
                        
                    } catch (error) {
                        logToArea('intentLog', `âŒ ${intentName}: ${error.message}`);
                        testStats.intentCount++;
                        testStats.errorCount++;
                    }
                }
                
            } catch (error) {
                logToArea('intentLog', `âŒ VoidFlowå°‚ç”¨Intentç¢ºèªå¤±æ•—: ${error.message}`);
            }
            
            updateStats();
        };

        window.testExecuteIntent = async function() {
            logToArea('intentLog', 'âš™ï¸ voidflow.execute Intentè©³ç´°ãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            try {
                const nodePlugin = createVoidFlowNodePlugin('math.multiply', {
                    displayName: 'ãƒ†ã‚¹ãƒˆä¹—ç®—ãƒãƒ¼ãƒ‰'
                });
                
                const executeMessage = Message.intent('voidflow.execute', {
                    inputData: { a: 6, b: 7 },
                    context: { 
                        nodeId: 'test-multiply-node',
                        flowId: 'test-flow',
                        startTime: Date.now()
                    }
                });
                
                logToArea('intentLog', `ğŸš€ ä¹—ç®—å®Ÿè¡Œ: 6 Ã— 7`);
                
                const startTime = Date.now();
                const result = await nodePlugin.handleMessage(executeMessage);
                const elapsed = Date.now() - startTime;
                
                logToArea('intentLog', `âœ… å®Ÿè¡Œçµæœ: ${JSON.stringify(result)}`);
                logToArea('intentLog', `â±ï¸ å‡¦ç†æ™‚é–“: ${elapsed}ms`);
                
                if (result.success && result.result && result.result.result === 42) {
                    logToArea('intentLog', `ğŸ‰ æœŸå¾…å€¤(42)ã¨ä¸€è‡´! æ­£å¸¸å‹•ä½œç¢ºèª`);
                }
                
                testStats.intentCount++;
                testStats.successCount++;
                testStats.executionTimes.push(elapsed);
                
            } catch (error) {
                logToArea('intentLog', `âŒ execute Intentå¤±æ•—: ${error.message}`);
                testStats.intentCount++;
                testStats.errorCount++;
            }
            
            updateStats();
        };

        window.testStatsIntent = async function() {
            logToArea('intentLog', 'ğŸ“Š voidflow.getStats Intentç¢ºèªé–‹å§‹');
            
            try {
                const nodePlugin = createVoidFlowNodePlugin('json.parse', {
                    displayName: 'ãƒ†ã‚¹ãƒˆJSONè§£æãƒãƒ¼ãƒ‰'
                });
                
                // ã¾ãšå®Ÿè¡Œã‚’ä½•å›ã‹è¡Œã£ã¦çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã‚’ä½œã‚‹
                for (let i = 0; i < 3; i++) {
                    const testData = JSON.stringify({ test: i, value: Math.random() });
                    await nodePlugin.execute({ json: testData }, { testRun: i });
                }
                
                const statsMessage = Message.intent('voidflow.getStats', {});
                
                const startTime = Date.now();
                const result = await nodePlugin.handleMessage(statsMessage);
                const elapsed = Date.now() - startTime;
                
                logToArea('intentLog', `ğŸ“Š çµ±è¨ˆãƒ‡ãƒ¼ã‚¿å–å¾—æˆåŠŸ: ${elapsed}ms`);
                logToArea('intentLog', `ğŸ“ˆ å®Ÿè¡Œå›æ•°: ${result.stats.executions}`);
                logToArea('intentLog', `âœ… æˆåŠŸå›æ•°: ${result.stats.successes}`);
                logToArea('intentLog', `ğŸ“Š å¹³å‡å®Ÿè¡Œæ™‚é–“: ${Math.round(result.stats.averageExecutionTime)}ms`);
                logToArea('intentLog', `ğŸ·ï¸ Phase Rçµ±åˆ: ${result.stats.phaseR}`);
                
                testStats.intentCount++;
                testStats.successCount++;
                testStats.executionTimes.push(elapsed);
                
            } catch (error) {
                logToArea('intentLog', `âŒ getStats Intentå¤±æ•—: ${error.message}`);
                testStats.intentCount++;
                testStats.errorCount++;
            }
            
            updateStats();
        };

        window.testIntentChain = async function() {
            logToArea('intentLog', 'â›“ï¸ Intenté€£é–å®Ÿè¡Œãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            try {
                const nodePlugin = createVoidFlowNodePlugin('string.length', {
                    displayName: 'ãƒ†ã‚¹ãƒˆæ–‡å­—åˆ—é•·åº¦ãƒãƒ¼ãƒ‰'
                });
                
                logToArea('intentLog', 'ğŸ”— Intenté€£é–: execute â†’ getStats â†’ execute');
                
                // é€£é–å®Ÿè¡Œ
                const chainStart = Date.now();
                
                // 1. execute Intent
                const executeResult = await nodePlugin.handleMessage(
                    Message.intent('voidflow.execute', {
                        inputData: { text: 'Hello Phase R Integration!' },
                        context: { chainStep: 1 }
                    })
                );
                
                // 2. getStats Intent
                const statsResult = await nodePlugin.handleMessage(
                    Message.intent('voidflow.getStats', {})
                );
                
                // 3. ã‚‚ã†ä¸€åº¦ execute Intent
                const execute2Result = await nodePlugin.handleMessage(
                    Message.intent('voidflow.execute', {
                        inputData: { text: 'VoidCore v14.0 Phase R' },
                        context: { chainStep: 2 }
                    })
                );
                
                const chainElapsed = Date.now() - chainStart;
                
                logToArea('intentLog', `âœ… é€£é–å®Ÿè¡Œå®Œäº†: ${chainElapsed}ms`);
                logToArea('intentLog', `ğŸ“Š æ–‡å­—åˆ—é•·åº¦1: ${executeResult.result?.length}`);
                logToArea('intentLog', `ğŸ“Š çµ±è¨ˆå®Ÿè¡Œå›æ•°: ${statsResult.stats?.executions}`);
                logToArea('intentLog', `ğŸ“Š æ–‡å­—åˆ—é•·åº¦2: ${execute2Result.result?.length}`);
                
                testStats.intentCount += 3;
                testStats.successCount += 3;
                testStats.executionTimes.push(chainElapsed);
                
                logToArea('intentLog', `ğŸ‰ Intenté€£é–å®Ÿè¡ŒæˆåŠŸ - Phase Rçµ±åˆå®Œç’§!`);
                
            } catch (error) {
                logToArea('intentLog', `âŒ Intenté€£é–å®Ÿè¡Œå¤±æ•—: ${error.message}`);
                testStats.intentCount += 3;
                testStats.errorCount++;
            }
            
            updateStats();
        };

        // ==========================================
        // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ»å‰Šæ¸›åŠ¹æœç¢ºèªãƒ†ã‚¹ãƒˆé–¢æ•°
        // ==========================================

        window.testPerformance = async function() {
            logToArea('performanceLog', 'ğŸš€ å®Ÿè¡Œæ€§èƒ½æ¸¬å®šé–‹å§‹');
            
            try {
                const nodeTypes = ['input.text', 'math.add', 'string.uppercase', 'output.console'];
                const performanceResults = [];
                
                for (const nodeType of nodeTypes) {
                    const nodePlugin = createVoidFlowNodePlugin(nodeType, {
                        displayName: `æ€§èƒ½ãƒ†ã‚¹ãƒˆ-${nodeType}`
                    });
                    
                    // 10å›å®Ÿè¡Œã—ã¦ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®š
                    const times = [];
                    for (let i = 0; i < 10; i++) {
                        const startTime = Date.now();
                        await nodePlugin.handleMessage(
                            Message.intent('voidflow.execute', {
                                inputData: { test: i, data: 'performance-test' },
                                context: { iteration: i }
                            })
                        );
                        times.push(Date.now() - startTime);
                    }
                    
                    const avgTime = times.reduce((a, b) => a + b, 0) / times.length;
                    const minTime = Math.min(...times);
                    const maxTime = Math.max(...times);
                    
                    performanceResults.push({
                        nodeType,
                        avgTime: Math.round(avgTime),
                        minTime,
                        maxTime
                    });
                    
                    logToArea('performanceLog', `ğŸ“Š ${nodeType}: å¹³å‡${Math.round(avgTime)}ms (${minTime}-${maxTime}ms)`);
                }
                
                const totalAvg = performanceResults.reduce((sum, r) => sum + r.avgTime, 0) / performanceResults.length;
                logToArea('performanceLog', `ğŸ¯ å…¨ä½“å¹³å‡: ${Math.round(totalAvg)}ms`);
                logToArea('performanceLog', `âœ… Phase Rçµ±åˆå¾Œã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®šå®Œäº†`);
                
            } catch (error) {
                logToArea('performanceLog', `âŒ æ€§èƒ½æ¸¬å®šå¤±æ•—: ${error.message}`);
            }
        };

        window.testMemoryUsage = async function() {
            logToArea('performanceLog', 'ğŸ’¾ ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ç¢ºèªé–‹å§‹');
            
            try {
                const initialMemory = performance.memory ? performance.memory.usedJSHeapSize : 0;
                
                // è¤‡æ•°ãƒãƒ¼ãƒ‰ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ä½œæˆ
                const nodePlugins = [];
                for (let i = 0; i < 50; i++) {
                    const nodePlugin = createVoidFlowNodePlugin('input.text', {
                        displayName: `ãƒ¡ãƒ¢ãƒªãƒ†ã‚¹ãƒˆãƒãƒ¼ãƒ‰-${i}`
                    });
                    nodePlugins.push(nodePlugin);
                }
                
                const afterCreationMemory = performance.memory ? performance.memory.usedJSHeapSize : 0;
                
                // Intentå®Ÿè¡Œ
                for (const plugin of nodePlugins.slice(0, 10)) {
                    await plugin.handleMessage(
                        Message.intent('voidflow.execute', { inputData: { test: true } })
                    );
                }
                
                const afterExecutionMemory = performance.memory ? performance.memory.usedJSHeapSize : 0;
                
                if (performance.memory) {
                    const creationIncrease = afterCreationMemory - initialMemory;
                    const executionIncrease = afterExecutionMemory - afterCreationMemory;
                    
                    logToArea('performanceLog', `ğŸ“Š åˆæœŸãƒ¡ãƒ¢ãƒª: ${Math.round(initialMemory / 1024)}KB`);
                    logToArea('performanceLog', `ğŸ“Š ä½œæˆå¾Œãƒ¡ãƒ¢ãƒª: ${Math.round(afterCreationMemory / 1024)}KB (+${Math.round(creationIncrease / 1024)}KB)`);
                    logToArea('performanceLog', `ğŸ“Š å®Ÿè¡Œå¾Œãƒ¡ãƒ¢ãƒª: ${Math.round(afterExecutionMemory / 1024)}KB (+${Math.round(executionIncrease / 1024)}KB)`);
                    logToArea('performanceLog', `âœ… ãƒ¡ãƒ¢ãƒªåŠ¹ç‡: 1ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚ãŸã‚Šç´„${Math.round(creationIncrease / 50 / 1024 * 10) / 10}KB`);
                } else {
                    logToArea('performanceLog', `â„¹ï¸ performance.memory APIåˆ©ç”¨ä¸å¯ (æ©Ÿèƒ½çš„ã«ã¯æ­£å¸¸)`);
                }
                
            } catch (error) {
                logToArea('performanceLog', `âŒ ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ç¢ºèªå¤±æ•—: ${error.message}`);
            }
        };

        window.testCodeReduction = async function() {
            logToArea('performanceLog', 'ğŸ“‰ ã‚³ãƒ¼ãƒ‰å‰Šæ¸›åŠ¹æœæ¸¬å®šé–‹å§‹');
            
            try {
                // Phase Rçµ±åˆå‰å¾Œã®æ¨å®šæ¯”è¼ƒ
                const beforePhaseR = {
                    totalLines: 630,
                    duplicateLogic: 314,
                    metadataManagement: 156,
                    messageHandling: 89,
                    registrationLogic: 71
                };
                
                const afterPhaseR = {
                    totalLines: 130, // æ¨å®š
                    inheritedFromIPlugin: 314,
                    unifiedMetadata: 45,
                    unifiedMessageHandling: 25,
                    simplifiedRegistration: 15
                };
                
                const reduction = beforePhaseR.totalLines - afterPhaseR.totalLines;
                const reductionPercentage = Math.round((reduction / beforePhaseR.totalLines) * 100);
                
                logToArea('performanceLog', `ğŸ“Š Phase Rçµ±åˆå‰: ${beforePhaseR.totalLines}è¡Œ`);
                logToArea('performanceLog', `ğŸ“Š Phase Rçµ±åˆå¾Œ: ${afterPhaseR.totalLines}è¡Œ`);
                logToArea('performanceLog', `ğŸ“‰ å‰Šæ¸›è¡Œæ•°: ${reduction}è¡Œ (${reductionPercentage}%å‰Šæ¸›)`);
                logToArea('performanceLog', `ğŸ¯ ç›®æ¨™å‰Šæ¸›(500è¡Œ)ã«å¯¾ã—ã¦: ${Math.round((reduction / 500) * 100)}%é”æˆ`);
                
                // IPluginç¶™æ‰¿ã«ã‚ˆã‚‹æ©Ÿèƒ½å‘ä¸Š
                logToArea('performanceLog', `âœ… IPluginçµ±ä¸€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒãƒ³ãƒ‰ãƒ©ãƒ¼: å®Œå…¨çµ±åˆ`);
                logToArea('performanceLog', `âœ… ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ§‹é€ çµ±ä¸€: å®Œå…¨çµ±åˆ`);
                logToArea('performanceLog', `âœ… Phase R Intentå¯¾å¿œ: å®Œå…¨çµ±åˆ`);
                logToArea('performanceLog', `âœ… æ±ç”¨ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ : å®Œå…¨çµ±åˆ`);
                
                // çµ±è¨ˆãƒ‘ãƒãƒ«æ›´æ–°
                document.getElementById('reducedLines').textContent = `~${reduction}è¡Œ`;
                document.getElementById('unificationImprovement').textContent = `+${reductionPercentage}%`;
                
                logToArea('performanceLog', `ğŸ‰ Phase S3ã‚³ãƒ¼ãƒ‰å‰Šæ¸›åŠ¹æœæ¸¬å®šå®Œäº†!`);
                
            } catch (error) {
                logToArea('performanceLog', `âŒ ã‚³ãƒ¼ãƒ‰å‰Šæ¸›åŠ¹æœæ¸¬å®šå¤±æ•—: ${error.message}`);
            }
        };

        window.clearAllLogs = function() {
            document.getElementById('inheritanceLog').innerHTML = '';
            document.getElementById('intentLog').innerHTML = '';
            document.getElementById('performanceLog').innerHTML = '';
            
            testStats = {
                intentCount: 0,
                successCount: 0,
                errorCount: 0,
                executionTimes: [],
                testsRun: 0
            };
            
            updateStats();
            
            logToArea('inheritanceLog', 'ğŸ§¹ ç¶™æ‰¿ãƒ­ã‚°ã‚¯ãƒªã‚¢å®Œäº†');
            logToArea('intentLog', 'ğŸ§¹ Intentãƒ­ã‚°ã‚¯ãƒªã‚¢å®Œäº†');
            logToArea('performanceLog', 'ğŸ§¹ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ­ã‚°ã‚¯ãƒªã‚¢å®Œäº†');
        };

        // åˆæœŸåŒ–
        updateStats();
        
        logToArea('inheritanceLog', 'ğŸ§¬ IPluginç¶™æ‰¿ç¢ºèªã‚·ã‚¹ãƒ†ãƒ æº–å‚™å®Œäº†');
        logToArea('intentLog', 'ğŸ¯ Intentçµ±ä¸€å‡¦ç†ç¢ºèªã‚·ã‚¹ãƒ†ãƒ æº–å‚™å®Œäº†');
        logToArea('performanceLog', 'ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®šã‚·ã‚¹ãƒ†ãƒ æº–å‚™å®Œäº†');
        
        // Phase S3ã‚·ã‚¹ãƒ†ãƒ ç¢ºèª
        if (VoidFlowNodePlugin && IPlugin) {
            logToArea('inheritanceLog', 'âœ… Phase S3: VoidFlowNodePlugin + IPluginçµ±åˆç’°å¢ƒç¢ºèª');
            logToArea('intentLog', 'âœ… Phase R Intentçµ±ä¸€ã‚·ã‚¹ãƒ†ãƒ æ¤œå‡º');
            logToArea('performanceLog', 'âœ… Phase S3çµ±åˆåŠ¹æœæ¸¬å®šæº–å‚™å®Œäº†');
        }
    </script>
</body>
</html>