# Message Classification Design Phase 2.0
## Intent/Notice/Proposal 3ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†é¡ã‚·ã‚¹ãƒ†ãƒ 

**Version**: 2.0  
**Date**: 2025-01-07  
**Philosophy**: å®Œå…¨è‡ªå¾‹å­˜åœ¨ãƒ¢ãƒ‡ãƒ«  

---

## ğŸŒŸ æ ¸å¿ƒ: ãŸã£ãŸ3ã¤ã®ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³

VoidCoreã®ä¸–ç•Œã§ã¯ã€ã™ã¹ã¦ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ä»¥ä¸‹ã®3ã¤ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã„ãšã‚Œã‹ã«åˆ†é¡ã•ã‚Œã¾ã™ã€‚

---

## ğŸ“¨ 1. Intent (æ„å›³) - ã€Œã€œã—ã¦ã»ã—ã„ã€

### æ¦‚è¦
ç‰¹å®šã®å½¹å‰²ã‚’æŒã¤ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã«å¯¾ã—ã¦ã€ä½•ã‹ã‚’ã—ã¦ã»ã—ã„ã¨ã„ã†**é¡˜ã„**ã‚’ä¼ãˆã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€‚

### ç‰¹å¾´
- **é€šä¿¡ãƒ‘ã‚¿ãƒ¼ãƒ³**: 1å¯¾1ï¼ˆå½¹å‰²æŒ‡å®šï¼‰
- **å¼·åˆ¶åŠ›**: ãªã—ï¼ˆç›¸æ‰‹ã®è‡ªç”±æ„å¿—ï¼‰
- **å¿œç­”**: æœŸå¾…ã™ã‚‹ãŒå¿…é ˆã§ã¯ãªã„

### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ§‹é€ 
```javascript
{
  type: "Intent",
  target_role: "file_explorer",  // å½¹å‰²ã‚’æŒ‡å®š
  action: "file.open",
  payload: {
    path: "/documents/report.txt",
    mode: "read"
  }
}
```

### ä½¿ç”¨ä¾‹
- ã€Œãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã„ã¦ã»ã—ã„ã€â†’ ãƒ•ã‚¡ã‚¤ãƒ«ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼ã¸
- ã€Œãƒ†ã‚­ã‚¹ãƒˆã‚’ä¿å­˜ã—ã¦ã»ã—ã„ã€â†’ ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚µãƒ¼ãƒ“ã‚¹ã¸
- ã€Œç”»åƒã‚’è¡¨ç¤ºã—ã¦ã»ã—ã„ã€â†’ ç”»åƒãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼ã¸

### å®Ÿè£…ã®ãƒã‚¤ãƒ³ãƒˆ
```javascript
// é€ä¿¡å´
core.publish({
  type: "Intent",
  target_role: "editor",
  action: "text.format",
  payload: { format: "markdown" }
})

// å—ä¿¡å´ï¼ˆroleãŒä¸€è‡´ã™ã‚‹å ´åˆã®ã¿å‡¦ç†ï¼‰
core.subscribe("Intent", (message) => {
  if (message.target_role === this.role) {
    this.handleIntent(message)
  }
})
```

---

## ğŸ“¢ 2. Notice (é€šçŸ¥) - ã€Œã€œãŒèµ·ããŸã€

### æ¦‚è¦
ä¸–ç•Œå…¨ä½“ã«å‘ã‘ã¦ã€èµ·ããŸå‡ºæ¥äº‹ã‚„çŠ¶æ…‹å¤‰åŒ–ã‚’**äº‹å®Ÿ**ã¨ã—ã¦æ”¾é€ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€‚

### ç‰¹å¾´
- **é€šä¿¡ãƒ‘ã‚¿ãƒ¼ãƒ³**: 1å¯¾å¤šï¼ˆãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆï¼‰
- **å¼·åˆ¶åŠ›**: ãªã—ï¼ˆèãå´ã®è‡ªç”±ï¼‰
- **å¿œç­”**: æœŸå¾…ã—ãªã„

### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ§‹é€ 
```javascript
{
  type: "Notice",
  event_name: "file.saved",
  payload: {
    path: "/documents/report.txt",
    size: 2048,
    timestamp: "2025-01-07T10:30:00Z"
  }
}
```

### ä½¿ç”¨ä¾‹
- ã€Œãƒ•ã‚¡ã‚¤ãƒ«ãŒä¿å­˜ã•ã‚ŒãŸã€â†’ å…¨ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¸é€šçŸ¥
- ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã€â†’ å…¨ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¸é€šçŸ¥
- ã€Œãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡ãŒ80%ã‚’è¶…ãˆãŸã€â†’ å…¨ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¸é€šçŸ¥

### å®Ÿè£…ã®ãƒã‚¤ãƒ³ãƒˆ
```javascript
// é€ä¿¡å´ï¼ˆèª°ãŒèã„ã¦ã„ã‚‹ã‹æ°—ã«ã—ãªã„ï¼‰
core.publish({
  type: "Notice",
  event_name: "user.action",
  payload: { action: "save", target: "document" }
})

// å—ä¿¡å´ï¼ˆèˆˆå‘³ãŒã‚ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã®ã¿è³¼èª­ï¼‰
core.subscribe("Notice", "file.saved", (message) => {
  this.updateFileList(message.payload)
})
```

---

## ğŸ’¡ 3. Proposal (ææ¡ˆ) - ã€Œã€œã—ã¾ã›ã‚“ã‹ã€

### æ¦‚è¦
ç‰¹å®šã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã«å¯¾ã—ã¦ã€è¡Œå‹•ã‚„çŠ¶æ…‹å¤‰æ›´ã‚’**ææ¡ˆ**ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€‚ç›¸æ‰‹ã¯è‡ªç”±ã«åˆ¤æ–­ã§ãã‚‹ã€‚

### ç‰¹å¾´
- **é€šä¿¡ãƒ‘ã‚¿ãƒ¼ãƒ³**: 1å¯¾1ï¼ˆãƒ—ãƒ©ã‚°ã‚¤ãƒ³æŒ‡å®šï¼‰
- **å¼·åˆ¶åŠ›**: ãªã—ï¼ˆã‚ãã¾ã§ææ¡ˆï¼‰
- **å¿œç­”**: ä»»æ„ï¼ˆæ‰¿è«¾/æ‹’å¦/ç„¡è¦–ï¼‰

### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ§‹é€ 
```javascript
{
  type: "Proposal",
  target_plugin: "VideoProcessor_001",  // ç‰¹å®šã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ID
  suggestion: "pause",
  payload: {
    reason: "ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒ¢ãƒªä¸è¶³",
    recommended_action: "ä¸€æ™‚åœæ­¢ã—ã¦5ç§’å¾Œã«å†é–‹"
  }
}
```

### ä½¿ç”¨ä¾‹
- ã€Œå‡¦ç†ã‚’ä¸€æ™‚åœæ­¢ã—ã¾ã›ã‚“ã‹ã€â†’ é‡ã„å‡¦ç†ã‚’ã—ã¦ã„ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¸
- ã€Œã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã›ã‚“ã‹ã€â†’ ãƒ¡ãƒ¢ãƒªã‚’å¤šãä½¿ã£ã¦ã„ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¸
- ã€Œè¨­å®šã‚’å¤‰æ›´ã—ã¾ã›ã‚“ã‹ã€â†’ ç‰¹å®šã®è¨­å®šã‚’æŒã¤ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¸

### å®Ÿè£…ã®ãƒã‚¤ãƒ³ãƒˆ
```javascript
// é€ä¿¡å´ï¼ˆç‰¹å®šã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¸ææ¡ˆï¼‰
core.publish({
  type: "Proposal",
  target_plugin: "HeavyProcessor_42",
  suggestion: "reduce_quality",
  payload: { 
    current_load: 95,
    suggested_quality: "medium"
  }
})

// å—ä¿¡å´ï¼ˆè‡ªåˆ†å®›ã®ææ¡ˆã®ã¿æ¤œè¨ï¼‰
core.subscribe("Proposal", (message) => {
  if (message.target_plugin === this.pluginId) {
    this.considerProposal(message)
  }
})
```

---

## ğŸ”„ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ‘ã‚¿ãƒ¼ãƒ³é¸æŠã‚¬ã‚¤ãƒ‰

### ã©ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½¿ã†ã¹ãã‹ï¼Ÿ

```mermaid
graph TD
    A[ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ã‚ŠãŸã„] --> B{å®›å…ˆã¯ï¼Ÿ}
    B -->|ç‰¹å®šã®å½¹å‰²| C{å†…å®¹ã¯ï¼Ÿ}
    B -->|å…¨å“¡| D[Notice]
    B -->|ç‰¹å®šã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³| E[Proposal]
    C -->|ä¾é ¼ãƒ»è¦æ±‚| F[Intent]
    C -->|ææ¡ˆãƒ»æ¨å¥¨| E[Proposal]
```

### åˆ¤æ–­åŸºæº–

1. **Intent ã‚’ä½¿ã†å ´åˆ**
   - ç‰¹å®šã®æ©Ÿèƒ½ã‚’æŒã¤ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã«ä½œæ¥­ã‚’ä¾é ¼ã—ãŸã„
   - å½¹å‰²ãƒ™ãƒ¼ã‚¹ã§å®›å…ˆã‚’æ±ºã‚ãŸã„
   - ä½•ã‹ã‚’å®Ÿè¡Œã—ã¦ã»ã—ã„

2. **Notice ã‚’ä½¿ã†å ´åˆ**
   - èµ·ããŸå‡ºæ¥äº‹ã‚’å…±æœ‰ã—ãŸã„
   - èª°ãŒèã„ã¦ã„ã‚‹ã‹åˆ†ã‹ã‚‰ãªã„/æ°—ã«ã—ãªã„
   - çŠ¶æ…‹å¤‰åŒ–ã‚’é€šçŸ¥ã—ãŸã„

3. **Proposal ã‚’ä½¿ã†å ´åˆ**
   - ç‰¹å®šã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã«è¡Œå‹•å¤‰æ›´ã‚’ä¿ƒã—ãŸã„
   - å¼·åˆ¶ã§ã¯ãªãææ¡ˆã¨ã—ã¦ä¼ãˆãŸã„
   - ç›¸æ‰‹ã®åˆ¤æ–­ã‚’å°Šé‡ã—ãŸã„

---

## ğŸ¯ å®Ÿè£…ä¾‹: å®Œå…¨ãª3ãƒ‘ã‚¿ãƒ¼ãƒ³å¯¾å¿œãƒ—ãƒ©ã‚°ã‚¤ãƒ³

```javascript
class SmartPlugin extends AutonomousPlugin {
  constructor(core) {
    super(core, "SmartService")
    this.role = "data_processor"
    this.pluginId = `SmartPlugin_${Date.now()}`
  }
  
  async observe() {
    // Intent: è‡ªåˆ†ã®å½¹å‰²å®›ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡¦ç†
    this.subscribe("Intent", (msg) => {
      if (msg.target_role === this.role) {
        this.handleIntent(msg)
      }
    })
    
    // Notice: èˆˆå‘³ã®ã‚ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã‚’è³¼èª­
    this.subscribe("Notice", "data.updated", (msg) => {
      this.onDataUpdate(msg.payload)
    })
    
    // Proposal: è‡ªåˆ†å®›ã®ææ¡ˆã‚’æ¤œè¨
    this.subscribe("Proposal", (msg) => {
      if (msg.target_plugin === this.pluginId) {
        this.considerProposal(msg)
      }
    })
  }
  
  async work() {
    // Notice: å‡¦ç†å®Œäº†ã‚’é€šçŸ¥
    this.publish({
      type: "Notice",
      event_name: "processing.completed",
      payload: { items: 100, duration: 5.2 }
    })
    
    // Intent: ä¿å­˜ã‚’ä¾é ¼
    this.publish({
      type: "Intent",
      target_role: "storage",
      action: "data.save",
      payload: { data: this.processedData }
    })
    
    // Proposal: ä»–ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã«æœ€é©åŒ–ã‚’ææ¡ˆ
    this.publish({
      type: "Proposal",
      target_plugin: "Visualizer_001",
      suggestion: "enable_cache",
      payload: { expected_speedup: "3x" }
    })
  }
}
```

---

## ğŸ“Š ãƒ‘ã‚¿ãƒ¼ãƒ³æ¯”è¼ƒè¡¨

| é …ç›® | Intent | Notice | Proposal |
|------|--------|--------|----------|
| æ—¥æœ¬èª | æ„å›³ãƒ»é¡˜ã„ | é€šçŸ¥ãƒ»å ±å‘Š | ææ¡ˆãƒ»æ¨å¥¨ |
| å®›å…ˆ | å½¹å‰²ï¼ˆroleï¼‰ | å…¨å“¡ | ç‰¹å®šãƒ—ãƒ©ã‚°ã‚¤ãƒ³ |
| é€šä¿¡ | 1å¯¾1 | 1å¯¾å¤š | 1å¯¾1 |
| ä¾‹æ–‡ | ã€Œé–‹ã„ã¦ãã ã•ã„ã€ | ã€Œé–‹ãã¾ã—ãŸã€ | ã€Œé–‰ã˜ã¾ã›ã‚“ã‹ï¼Ÿã€ |
| å¿œç­” | æœŸå¾…ã™ã‚‹ | æœŸå¾…ã—ãªã„ | ä»»æ„ |
| å¼·åˆ¶åŠ› | ãªã— | ãªã— | ãªã— |

---

## ğŸš€ ç§»è¡Œã‚¬ã‚¤ãƒ‰

### æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã‹ã‚‰ã®ç§»è¡Œ

```javascript
// æ—§: æ±ç”¨çš„ãªpublish
core.publish("some.event", data)

// æ–°: æ˜ç¢ºãªåˆ†é¡
// Intentç‰ˆ
core.publish({
  type: "Intent",
  target_role: "processor",
  action: "some.event",
  payload: data
})

// Noticeç‰ˆ
core.publish({
  type: "Notice",
  event_name: "some.event",
  payload: data
})

// Proposalç‰ˆ
core.publish({
  type: "Proposal",
  target_plugin: "Plugin_123",
  suggestion: "some.event",
  payload: data
})
```

---

## ğŸŒŸ ã¾ã¨ã‚

ã“ã®3ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†é¡ã«ã‚ˆã‚Šï¼š

1. **æ„å›³ãŒæ˜ç¢ºã«**: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ç›®çš„ãŒä¸€ç›®ã§åˆ†ã‹ã‚‹
2. **å®Ÿè£…ãŒç°¡å˜ã«**: ãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¾“ã†ã ã‘ã§é©åˆ‡ãªé€šä¿¡ãŒå¯èƒ½
3. **æ‹¡å¼µãŒè‡ªç”±ã«**: 3ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä¸­ã§ç„¡é™ã®ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³

**Remember**: ã™ã¹ã¦ã¯ã€Œé¡˜ã„ã€ã€Œäº‹å®Ÿã€ã€Œææ¡ˆã€ã®ã„ãšã‚Œã‹ã€‚å¼·åˆ¶ã‚„å‘½ä»¤ã¯å­˜åœ¨ã—ãªã„ï¼