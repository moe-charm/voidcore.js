# ğŸ”¥ ä»Šã™ãå®Ÿè¡Œï¼ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚¤ãƒ³ã‚¹ãƒšã‚¯ã‚¿å®Ÿè£…è¨ˆç”»

**ä½œæˆæ—¥**: 2025-07-11  
**å®Ÿè¡Œé–‹å§‹**: å³åº§  
**å®Œäº†ç›®æ¨™**: 2-3é€±é–“  
**å„ªå…ˆåº¦**: ğŸ”´ æœ€é«˜  

---

## ğŸ¯ **ä»Šæ—¥ã‹ã‚‰å§‹ã‚ã‚‹å…·ä½“çš„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**

### **ä»Šã™ãå®Ÿè¡Œãƒªã‚¹ãƒˆ**:
1. **intent-definitions.js** ä½œæˆ (30åˆ†)
2. **ui-components/** åŸºæœ¬ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ (2æ™‚é–“)
3. **ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚¤ãƒ³ã‚¹ãƒšã‚¯ã‚¿** ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—é–‹å§‹ (1æ—¥)

---

## ğŸ“‹ **Phase 1: åŸºç›¤ç¢ºç«‹ (ä»Šã™ãé–‹å§‹)**

### **ğŸ”§ Task 1.1: Intentå®šç¾©ã‚·ã‚¹ãƒ†ãƒ æ§‹ç¯‰** (30åˆ†)
**ãƒ•ã‚¡ã‚¤ãƒ«**: `charmflow/js/intent-definitions.js`

```javascript
/**
 * ğŸ¯ CharmFlow Intentå®šç¾© - ä¸€å…ƒç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
 * Geminiæˆ¦ç•¥: Intentä¹±ç«‹é˜²æ­¢ãƒ»ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®æ•´åˆæ€§ç¢ºä¿
 */

export const UI_INTENTS = {
  // ãƒãƒ¼ãƒ‰é¸æŠãƒ»æ“ä½œ
  NODE_SELECTED: 'ui.node.selected',
  NODE_DESELECTED: 'ui.node.deselected',
  UPDATE_NODE_PROPERTY: 'ui.node.property.update',
  
  // ã‚¨ãƒ‡ã‚£ã‚¿æ“ä½œ
  OPEN_EDITOR: 'ui.editor.open',
  CLOSE_EDITOR: 'ui.editor.close',
  EDITOR_CONTENT_CHANGED: 'ui.editor.content.changed',
  
  // ãƒ‡ãƒãƒƒã‚°ãƒ»ãƒ­ã‚°
  DEBUG_LOG: 'debug.log',
  SHOW_LOG_PANEL: 'ui.log.show',
  HIDE_LOG_PANEL: 'ui.log.hide',
  
  // UIçŠ¶æ…‹ç®¡ç†
  SHOW_PROPERTY_INSPECTOR: 'ui.inspector.show',
  HIDE_PROPERTY_INSPECTOR: 'ui.inspector.hide',
  UPDATE_UI_LAYOUT: 'ui.layout.update'
}

export const INTENT_SCHEMAS = {
  [UI_INTENTS.NODE_SELECTED]: {
    nodeId: 'string',
    nodeType: 'string',
    properties: 'object'
  },
  [UI_INTENTS.UPDATE_NODE_PROPERTY]: {
    nodeId: 'string',
    propertyName: 'string',
    newValue: 'any'
  },
  [UI_INTENTS.OPEN_EDITOR]: {
    editorId: 'string',
    content: 'string',
    language: 'string'
  }
}
```

### **ğŸ¨ Task 1.2: UIåŸºæœ¬ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä½œæˆ** (2æ™‚é–“)
**ãƒ•ã‚©ãƒ«ãƒ€**: `charmflow/js/ui-components/`

#### **Panel.js** - åŸºæœ¬ãƒ‘ãƒãƒ«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
```javascript
/**
 * ğŸ—ï¸ åŸºæœ¬UIãƒ‘ãƒãƒ« - å…¨UIãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®åŸºåº•
 */
export class Panel {
  constructor(config) {
    this.id = config.id
    this.title = config.title
    this.position = config.position || { x: 100, y: 100 }
    this.size = config.size || { width: 300, height: 400 }
    this.isResizable = config.isResizable !== false
    this.isDraggable = config.isDraggable !== false
    this.element = null
  }
  
  render() {
    // DOMæ§‹ç¯‰
    this.element = document.createElement('div')
    this.element.className = 'charm-panel'
    this.element.innerHTML = this.getTemplate()
    
    // ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼è¨­å®š
    this.setupEventHandlers()
    
    return this.element
  }
  
  getTemplate() {
    return `
      <div class="charm-panel-header">
        <span class="charm-panel-title">${this.title}</span>
        <div class="charm-panel-controls">
          <button class="charm-panel-minimize">âˆ’</button>
          <button class="charm-panel-close">Ã—</button>
        </div>
      </div>
      <div class="charm-panel-content">
        <!-- å­ã‚¯ãƒ©ã‚¹ã§ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ -->
      </div>
    `
  }
  
  setupEventHandlers() {
    // ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—
    if (this.isDraggable) this.setupDragging()
    // ãƒªã‚µã‚¤ã‚º
    if (this.isResizable) this.setupResizing()
    // æœ€å°åŒ–ãƒ»é–‰ã˜ã‚‹
    this.setupWindowControls()
  }
  
  show() { this.element.style.display = 'block' }
  hide() { this.element.style.display = 'none' }
  destroy() { this.element?.remove() }
}
```

#### **PropertyInspector.js** - ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚¤ãƒ³ã‚¹ãƒšã‚¯ã‚¿
```javascript
import { Panel } from './Panel.js'
import { UI_INTENTS } from '../intent-definitions.js'

/**
 * ğŸ” ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚¤ãƒ³ã‚¹ãƒšã‚¯ã‚¿ - Geminiæˆ¦ç•¥å®Ÿè£…
 * åŸºæœ¬ãƒ‘ã‚¿ãƒ¼ãƒ³: å—ä¿¡â†’è¡¨ç¤ºâ†’é€ä¿¡
 */
export class PropertyInspector extends Panel {
  constructor(config) {
    super({
      id: 'property-inspector',
      title: 'ğŸ” ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£',
      position: { x: 20, y: 100 },
      size: { width: 280, height: 400 },
      ...config
    })
    
    this.currentNode = null
    this.intentHandler = config.intentHandler
    this.setupIntentListeners()
  }
  
  setupIntentListeners() {
    // Geminiæˆ¦ç•¥: å—ä¿¡ - ãƒãƒ¼ãƒ‰é¸æŠã‚’ãƒªãƒƒã‚¹ãƒ³
    this.intentHandler.subscribe(UI_INTENTS.NODE_SELECTED, (data) => {
      this.showNodeProperties(data)
    })
    
    this.intentHandler.subscribe(UI_INTENTS.NODE_DESELECTED, () => {
      this.clearProperties()
    })
  }
  
  getTemplate() {
    return `
      <div class="charm-panel-header">
        <span class="charm-panel-title">${this.title}</span>
        <div class="charm-panel-controls">
          <button class="charm-panel-close">Ã—</button>
        </div>
      </div>
      <div class="charm-panel-content">
        <div id="property-content">
          <div class="no-selection">ãƒãƒ¼ãƒ‰ã‚’é¸æŠã—ã¦ãã ã•ã„</div>
        </div>
      </div>
    `
  }
  
  showNodeProperties(nodeData) {
    // Geminiæˆ¦ç•¥: è¡¨ç¤º - ãƒãƒ¼ãƒ‰ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’UIè¡¨ç¤º
    this.currentNode = nodeData
    const content = this.element.querySelector('#property-content')
    
    content.innerHTML = `
      <div class="property-group">
        <h3>åŸºæœ¬æƒ…å ±</h3>
        <div class="property-item">
          <label>ID:</label>
          <input type="text" value="${nodeData.nodeId}" readonly>
        </div>
        <div class="property-item">
          <label>ã‚¿ã‚¤ãƒ—:</label>
          <input type="text" value="${nodeData.nodeType}" readonly>
        </div>
      </div>
      
      <div class="property-group">
        <h3>è¨­å®š</h3>
        <div id="dynamic-properties">
          ${this.renderDynamicProperties(nodeData.properties)}
        </div>
      </div>
      
      <div class="property-actions">
        <button id="save-properties">ğŸ’¾ ä¿å­˜</button>
        <button id="reset-properties">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
      </div>
    `
    
    this.setupPropertyHandlers()
  }
  
  renderDynamicProperties(properties) {
    return Object.entries(properties || {}).map(([key, value]) => `
      <div class="property-item">
        <label>${key}:</label>
        <input type="text" 
               data-property="${key}" 
               value="${value}" 
               onchange="this.dispatchEvent(new CustomEvent('property-changed', {
                 detail: { property: '${key}', value: this.value }
               }))">
      </div>
    `).join('')
  }
  
  setupPropertyHandlers() {
    // Geminiæˆ¦ç•¥: é€ä¿¡ - ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å¤‰æ›´ã‚’Intentç™ºè¡Œ
    this.element.addEventListener('property-changed', (e) => {
      const { property, value } = e.detail
      
      this.intentHandler.publish(UI_INTENTS.UPDATE_NODE_PROPERTY, {
        nodeId: this.currentNode.nodeId,
        propertyName: property,
        newValue: value
      })
    })
    
    // ä¿å­˜ãƒœã‚¿ãƒ³
    const saveBtn = this.element.querySelector('#save-properties')
    saveBtn?.addEventListener('click', () => {
      this.saveAllProperties()
    })
  }
  
  saveAllProperties() {
    const inputs = this.element.querySelectorAll('[data-property]')
    const updates = Array.from(inputs).map(input => ({
      property: input.dataset.property,
      value: input.value
    }))
    
    updates.forEach(({ property, value }) => {
      this.intentHandler.publish(UI_INTENTS.UPDATE_NODE_PROPERTY, {
        nodeId: this.currentNode.nodeId,
        propertyName: property,
        newValue: value
      })
    })
  }
  
  clearProperties() {
    const content = this.element.querySelector('#property-content')
    content.innerHTML = '<div class="no-selection">ãƒãƒ¼ãƒ‰ã‚’é¸æŠã—ã¦ãã ã•ã„</div>'
    this.currentNode = null
  }
}
```

### **ğŸ”Œ Task 1.3: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³çµ±åˆã‚·ã‚¹ãƒ†ãƒ ** (1æ™‚é–“)
**ãƒ•ã‚¡ã‚¤ãƒ«**: `charmflow/js/property-inspector-plugin.js`

```javascript
import { PropertyInspector } from './ui-components/PropertyInspector.js'
import { UI_INTENTS } from './intent-definitions.js'

/**
 * ğŸ” ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚¤ãƒ³ã‚¹ãƒšã‚¯ã‚¿ãƒ—ãƒ©ã‚°ã‚¤ãƒ³
 * CharmFlowçµ±åˆãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ã—ã¦å®Ÿè£…
 */
export class PropertyInspectorPlugin {
  constructor() {
    this.id = 'property-inspector-plugin'
    this.displayName = 'ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚¤ãƒ³ã‚¹ãƒšã‚¯ã‚¿'
    this.version = '1.0.0'
    this.isCore = true
    
    this.inspector = null
    this.charmFlowCore = null
  }
  
  async onActivated() {
    // CharmFlowCoreå‚ç…§å–å¾—
    if (window.charmFlowCore) {
      this.charmFlowCore = window.charmFlowCore
    }
    
    // ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚¤ãƒ³ã‚¹ãƒšã‚¯ã‚¿åˆæœŸåŒ–
    this.inspector = new PropertyInspector({
      intentHandler: {
        subscribe: (intent, handler) => {
          return this.charmFlowCore.addIntentListener(`inspector-${intent}`, handler)
        },
        publish: (intent, data) => {
          return this.charmFlowCore.sendIntent(intent, data)
        }
      }
    })
    
    // DOMè¿½åŠ 
    const inspectorElement = this.inspector.render()
    document.body.appendChild(inspectorElement)
    
    console.log('ğŸ” PropertyInspectorPlugin activated')
  }
  
  async onDeactivated() {
    if (this.inspector) {
      this.inspector.destroy()
      this.inspector = null
    }
  }
  
  // Intentå—ä¿¡
  async handleIntent(intent, data) {
    if (intent === UI_INTENTS.SHOW_PROPERTY_INSPECTOR) {
      this.inspector?.show()
    } else if (intent === UI_INTENTS.HIDE_PROPERTY_INSPECTOR) {
      this.inspector?.hide()
    }
  }
}

// ã‚°ãƒ­ãƒ¼ãƒãƒ«å…¬é–‹
window.PropertyInspectorPlugin = PropertyInspectorPlugin
```

---

## ğŸ“… **ä»Šæ—¥ã®å®Ÿè¡Œã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«**

### **åˆå‰ (2-3æ™‚é–“)**:
- [ ] `intent-definitions.js` ä½œæˆãƒ»å®Ÿè£…
- [ ] `ui-components/Panel.js` åŸºæœ¬ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Ÿè£…

### **åˆå¾Œ (3-4æ™‚é–“)**:
- [ ] `PropertyInspector.js` å®Ÿè£…
- [ ] `property-inspector-plugin.js` çµ±åˆå®Ÿè£…
- [ ] åŸºæœ¬å‹•ä½œç¢ºèª

### **å¤•æ–¹ (1æ™‚é–“)**:
- [ ] CharmFlowã¸ã®çµ±åˆãƒ†ã‚¹ãƒˆ
- [ ] Intenté€šä¿¡å‹•ä½œç¢ºèª
- [ ] ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ç¢ºèª

---

## ğŸ§ª **å‹•ä½œç¢ºèªæ‰‹é †**

### **Step 1: Intentå®šç¾©ç¢ºèª**
```javascript
// ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§å®Ÿè¡Œ
import { UI_INTENTS } from './js/intent-definitions.js'
console.log('Intentå®šç¾©:', UI_INTENTS)
```

### **Step 2: ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚¤ãƒ³ã‚¹ãƒšã‚¯ã‚¿è¡¨ç¤º**
```javascript
// ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æœ‰åŠ¹åŒ–ç¢ºèª
const plugin = new PropertyInspectorPlugin()
await plugin.onActivated()
```

### **Step 3: Intenté€šä¿¡ãƒ†ã‚¹ãƒˆ**
```javascript
// ãƒãƒ¼ãƒ‰é¸æŠIntenté€ä¿¡
charmFlowCore.sendIntent(UI_INTENTS.NODE_SELECTED, {
  nodeId: 'test-node-1',
  nodeType: 'button.send',
  properties: {
    label: 'ãƒ†ã‚¹ãƒˆãƒœã‚¿ãƒ³',
    color: '#ff0000'
  }
})
```

---

## ğŸ¯ **æˆåŠŸæŒ‡æ¨™**

### **ä»Šæ—¥å®Œäº†æ™‚**:
- [ ] Intentå®šç¾©ã‚·ã‚¹ãƒ†ãƒ å‹•ä½œ
- [ ] ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚¤ãƒ³ã‚¹ãƒšã‚¯ã‚¿è¡¨ç¤º
- [ ] åŸºæœ¬çš„ãªå—ä¿¡â†’è¡¨ç¤ºâ†’é€ä¿¡ãƒ‘ã‚¿ãƒ¼ãƒ³ç¢ºèª

### **ä»Šé€±å®Œäº†æ™‚**:
- [ ] å®Ÿéš›ã®ãƒãƒ¼ãƒ‰é¸æŠã§ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£è¡¨ç¤º
- [ ] ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å¤‰æ›´ãŒã‚·ã‚¹ãƒ†ãƒ ã«åæ˜ 
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å®Ÿè£…

### **æ¥é€±å®Œäº†æ™‚**:
- [ ] å®Œå…¨ãªãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚¤ãƒ³ã‚¹ãƒšã‚¯ã‚¿æ©Ÿèƒ½
- [ ] ä»–ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ã®é€£æºç¢ºèª
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ»å®‰å®šæ€§ç¢ºèª

---

## ğŸ”„ **ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°**

### **ã‚ˆãã‚ã‚‹å•é¡Œã¨å¯¾ç­–**:

#### **Intenté€šä¿¡ã§ããªã„**
```javascript
// ãƒ‡ãƒãƒƒã‚°ç¢ºèª
console.log('CharmFlowCore:', window.charmFlowCore)
console.log('addIntentListener:', typeof window.charmFlowCore?.addIntentListener)
```

#### **ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£è¡¨ç¤ºã•ã‚Œãªã„**
```javascript
// ãƒãƒ¼ãƒ‰é¸æŠã‚¤ãƒ™ãƒ³ãƒˆç¢ºèª
document.addEventListener('click', (e) => {
  console.log('ã‚¯ãƒªãƒƒã‚¯å¯¾è±¡:', e.target)
  console.log('ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ID:', e.target.dataset?.pluginId)
})
```

#### **UIè¡¨ç¤ºãŒå´©ã‚Œã‚‹**
```css
/* ç·Šæ€¥æ™‚CSSè¿½åŠ  */
.charm-panel {
  position: fixed;
  z-index: 1000;
  background: white;
  border: 1px solid #ccc;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}
```

---

## ğŸ“š **å‚è€ƒãƒ•ã‚¡ã‚¤ãƒ«**

### **æ—¢å­˜å®Ÿè£…å‚è€ƒ**:
- `charmflow/js/monaco-plugin-editor.js` - ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å®Ÿè£…ä¾‹
- `charmflow/js/debug-file-logger.js` - Intenté€šä¿¡ä¾‹
- `charmflow/js/charmflow-core.js` - Intentå—ä¿¡å‡¦ç†

### **ãƒ†ã‚¹ãƒˆç’°å¢ƒ**:
- `charmflow/index.html` - çµ±åˆãƒ†ã‚¹ãƒˆç’°å¢ƒ
- ãƒ­ã‚°ã‚»ãƒ³ã‚¿ãƒ¼ - Intenté€šä¿¡ç¢ºèª
- ãƒ–ãƒ©ã‚¦ã‚¶é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ« - ãƒ‡ãƒãƒƒã‚°

---

## ğŸš€ **æ˜æ—¥ä»¥é™ã®å±•é–‹**

### **Day 2-3**: æ©Ÿèƒ½æ‹¡å¼µ
- è¤‡é›‘ãªãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚¿ã‚¤ãƒ—å¯¾å¿œï¼ˆcolor picker, range sliderç­‰ï¼‰
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½è¿½åŠ 
- Undo/Redoæ©Ÿèƒ½

### **Day 4-7**: å®‰å®šåŒ–ãƒ»æœ€é©åŒ–
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£æ”¹å–„

### **Week 2**: æ¬¡ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æº–å‚™
- ãƒãƒ¼ãƒ‰ãƒ‘ãƒ¬ãƒƒãƒˆå®Ÿè£…æº–å‚™
- åŸºæœ¬ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ–‡æ›¸åŒ–
- ä»–é–‹ç™ºè€…å‘ã‘ã‚¬ã‚¤ãƒ‰ä½œæˆ

---

**ä½œæˆè€…**: Claude Code  
**å®Ÿè¡Œè²¬ä»»è€…**: è¨­è¨ˆè€…ã•ã¾  
**é–‹å§‹äºˆå®š**: 2025-07-11 å³åº§  
**å®Œäº†ç›®æ¨™**: 2025-07-25